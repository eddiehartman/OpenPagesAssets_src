<?xml version="1.0" encoding="UTF-8"?><MetamergeConfig IDIversion="Created by SDI7.2 - 2019-07-08" created="Sun Apr 11 10:39:21 CEST 2021" createdBy="eddie" modified="Wed Apr 14 13:22:57 CEST 2021" modifiedBy="eddie" version="7.1.1">
    <Folder name="AssemblyLines">
        <AssemblyLine name="inventory_feed">
            <ModTime>1593009945001</ModTime>
            <Settings>
                <parameter name="ALPoolSettingsDialog">showALPoolSettings</parameter>
                <parameter name="automapattributes">false</parameter>
                <parameter name="createTombstones">false</parameter>
                <parameter name="includeGlobalPrologs">true</parameter>
                <parameter name="includePrologs">ScriptLib</parameter>
                <parameter name="nullBehaviorDialog">showNullBehavior</parameter>
            </Settings>
            <Hooks/>
            <CheckpointConfig/>
            <SandboxConfig/>
            <SimulationConfig>
                <SimulationStates>
                    <Component name="OpenPages Connector" state="Simulated"/>
                    <Component name="Read CSV" state="Enabled"/>
                </SimulationStates>
                <ProxySettings/>
            </SimulationConfig>
            <LogConfig/>
            <ContainerEF name="EntryFeedContainer">
                <Connector name="Read CSV">
                    <InheritFrom>system:/Connectors/ibmdi.FileSystem</InheritFrom>
                    <ModTime>1592684734995</ModTime>
                    <ConnectorMode>Iterator</ConnectorMode>
                    <ConnectorState>Enabled</ConnectorState>
                    <Configuration>
                        <InheritFrom>[parent]</InheritFrom>
                        <parameter name="filePath">POC_MVP/inventory_test.csv</parameter>
                    </Configuration>
                    <Parser>
                        <InheritFrom>system:/Parsers/ibmdi.CSV</InheritFrom>
                        <parameter name="csvColumnSeparator">,</parameter>
                    </Parser>
                    <AttributeMap name="Input">
                        <InheritFrom>[parent]</InheritFrom>
                        <AttributeMapItem>
                            <Name>$grcObjecType</Name>
                            <Type>simple</Type>
                            <Simple>$grcObjecType</Simple>
                        </AttributeMapItem>
                        <AttributeMapItem>
                            <Name>Description</Name>
                            <Type>simple</Type>
                            <Simple>Description</Simple>
                        </AttributeMapItem>
                        <AttributeMapItem>
                            <Name>GTS-Inventory-ActionPlan:Invisibility Root Cause</Name>
                            <Type>simple</Type>
                            <Simple>GTS-Inventory-ActionPlan:Invisibility Root Cause</Simple>
                        </AttributeMapItem>
                        <AttributeMapItem>
                            <Name>GTS-Inventory:CAR Checklist Created</Name>
                            <Type>simple</Type>
                            <Simple>GTS-Inventory:CAR Checklist Created</Simple>
                        </AttributeMapItem>
                        <AttributeMapItem>
                            <Name>GTS-Inventory:CAR Checklist Created_index</Name>
                            <Type>simple</Type>
                            <Simple>GTS-Inventory:CAR Checklist Created_index</Simple>
                        </AttributeMapItem>
                        <AttributeMapItem>
                            <Name>GTS-Inventory:Detection Date</Name>
                            <Type>simple</Type>
                            <Simple>GTS-Inventory:Detection Date</Simple>
                        </AttributeMapItem>
                        <AttributeMapItem>
                            <Name>GTS-Inventory:Hostname</Name>
                            <Type>simple</Type>
                            <Simple>GTS-Inventory:Hostname</Simple>
                        </AttributeMapItem>
                        <AttributeMapItem>
                            <Name>GTS-Inventory:IP Address</Name>
                            <Type>simple</Type>
                            <Simple>GTS-Inventory:IP Address</Simple>
                        </AttributeMapItem>
                        <AttributeMapItem>
                            <Name>GTS-Inventory:Invisibility Reason</Name>
                            <Type>simple</Type>
                            <Simple>GTS-Inventory:Invisibility Reason</Simple>
                        </AttributeMapItem>
                        <AttributeMapItem>
                            <Name>GTS-Inventory:Invisibility Reason_index</Name>
                            <Type>simple</Type>
                            <Simple>GTS-Inventory:Invisibility Reason_index</Simple>
                        </AttributeMapItem>
                        <AttributeMapItem>
                            <Name>GTS-Inventory:Operating System</Name>
                            <Type>simple</Type>
                            <Simple>GTS-Inventory:Operating System</Simple>
                        </AttributeMapItem>
                        <AttributeMapItem>
                            <Name>GTS-Inventory:Platform</Name>
                            <Type>simple</Type>
                            <Simple>GTS-Inventory:Platform</Simple>
                        </AttributeMapItem>
                        <AttributeMapItem>
                            <Name>GTS-Inventory:Release</Name>
                            <Type>simple</Type>
                            <Simple>GTS-Inventory:Release</Simple>
                        </AttributeMapItem>
                        <AttributeMapItem>
                            <Name>GTS-Inventory:Remediation Action</Name>
                            <Type>simple</Type>
                            <Simple>GTS-Inventory:Remediation Action</Simple>
                        </AttributeMapItem>
                        <AttributeMapItem>
                            <Name>GTS-Inventory:Remediation Action_index</Name>
                            <Type>simple</Type>
                            <Simple>GTS-Inventory:Remediation Action_index</Simple>
                        </AttributeMapItem>
                        <AttributeMapItem>
                            <Name>GTS-Inventory:Serial Number</Name>
                            <Type>simple</Type>
                            <Simple>GTS-Inventory:Serial Number</Simple>
                        </AttributeMapItem>
                        <AttributeMapItem>
                            <Name>GTS-Inventory:System Model</Name>
                            <Type>simple</Type>
                            <Simple>GTS-Inventory:System Model</Simple>
                        </AttributeMapItem>
                        <AttributeMapItem>
                            <Name>GTS-Inventory:Vendor</Name>
                            <Type>simple</Type>
                            <Simple>GTS-Inventory:Vendor</Simple>
                        </AttributeMapItem>
                        <AttributeMapItem>
                            <Name>GTS-Inventory:Version</Name>
                            <Type>simple</Type>
                            <Simple>GTS-Inventory:Version</Simple>
                        </AttributeMapItem>
                    </AttributeMap>
                    <AttributeMap name="Output">
                        <InheritFrom>[parent]</InheritFrom>
                    </AttributeMap>
                    <DeltaSettings>
                        <WhenToCommit>After every database operation</WhenToCommit>
                        <RowLocking>SERIALIZABLE</RowLocking>
                        <ChangeDetectionMode>DETECT_ALL</ChangeDetectionMode>
                    </DeltaSettings>
                    <Schema name="Input">
                        <InheritFrom>[parent]</InheritFrom>
                        <SchemaItem>
                            <Name>$grcObject</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>$grcObjectJSON</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Created By</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Creation Date</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Description</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory-ActionPlan:Invisibility Root Cause</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:CAR Checklist Created</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:CAR Checklist Created_index</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Detection Date</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Hostname</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:IP Address</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Invisibility Reason</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Invisibility Reason_index</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Operating System</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Platform</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Release</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Remediation Action</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Remediation Action_index</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Serial Number</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:System Model</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Vendor</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Version</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Last Modification Date</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Last Modified By</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Location</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Orphan</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Resource ID</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                    </Schema>
                    <Schema name="Output">
                        <InheritFrom>[parent]</InheritFrom>
                        <SchemaItem>
                            <Name>$grcObject</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>$grcObjectJSON</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Created By</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Creation Date</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Description</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory-ActionPlan:Invisibility Root Cause</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:CAR Checklist Created</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:CAR Checklist Created_index</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Detection Date</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Hostname</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:IP Address</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Invisibility Reason</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Invisibility Reason_index</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Operating System</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Platform</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Release</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Remediation Action</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Remediation Action_index</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Serial Number</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Serial Number,Location,GTS-Inventory:System Model,GTS-Inventory:Invisibility Reason_index,GTS-Inventory:CAR Checklist Created,GTS-Inventory:Platform,GTS-Inventory-ActionPlan:Invisibility Root Cause,$grcObjectJSON,GTS-Inventory:Vendor,GTS-Inventory:Operating System,GTS-Inventory:Remediation Action_index,GTS-Inventory:Release,Last Modified By,Creation Date,GTS-Inventory:Detection Date,Last Modification Date,GTS-Inventory:CAR Checklist Created_index,GTS-Inventory:Hostname,Resource ID,$grcObject,Orphan,GTS-Inventory:IP Address,GTS-Inventory:Version,GTS-Inventory:Invisibility Reason,Description,Created By,GTS-Inventory:Remediation Action</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:System Model</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Vendor</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Version</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Last Modification Date</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Last Modified By</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Location</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Orphan</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Resource ID</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                    </Schema>
                    <LinkCriteria>
                        <InheritFrom>[parent]</InheritFrom>
                    </LinkCriteria>
                    <Hooks>
                        <InheritFrom>[parent]</InheritFrom>
                    </Hooks>
                    <CheckpointConfig/>
                    <SandboxConfig/>
                    <Reconnect>
                        <InheritFrom>[parent]</InheritFrom>
                        <ReconnectRules/>
                    </Reconnect>
                    <Operations/>
                    <PoolDefinition>
                        <InheritFrom>[parent]</InheritFrom>
                    </PoolDefinition>
                    <PoolInstance/>
                    <LookupLimit>1</LookupLimit>
                </Connector>
            </ContainerEF>
            <ContainerDF name="DataFlowContainer">
                <Connector name="OpenPages Connector">
                    <InheritFrom>/Connectors/OpenPages Connector</InheritFrom>
                    <ModTime>1593009906904</ModTime>
                    <ConnectorMode>Update</ConnectorMode>
                    <ConnectorState>Enabled</ConnectorState>
                    <Configuration>
                        <InheritFrom>[parent]</InheritFrom>
                        <parameter name="object">Assertion</parameter>
                        <parameter encrypted="true" name="password"/>
                        <parameter name="url">http://gts11.fyre.ibm.com:10108</parameter>
                    </Configuration>
                    <Parser>
                        <InheritFrom>[parent]</InheritFrom>
                    </Parser>
                    <AttributeMap name="Input">
                        <InheritFrom>[parent]</InheritFrom>
                    </AttributeMap>
                    <AttributeMap name="Output">
                        <InheritFrom>[parent]</InheritFrom>
                        <AttributeMapItem>
                            <Name>*</Name>
                            <Type>simple</Type>
                            <Simple>*</Simple>
                        </AttributeMapItem>
                        <AttributeMapItem>
                            <Name>primaryParentId</Name>
                            <Type>advanced</Type>
                            <Enabled>true</Enabled>
                            <Add>true</Add>
                            <Modify>true</Modify>
                            <Script>7465</Script>
                            <Simple>primaryParentId</Simple>
                        </AttributeMapItem>
                        <AttributeMapItem>
                            <Name>primaryParentType</Name>
                            <Type>advanced</Type>
                            <Script>"SOXAccount"</Script>
                            <Simple>primaryParentType</Simple>
                        </AttributeMapItem>
                    </AttributeMap>
                    <DeltaSettings>
                        <WhenToCommit>After every database operation</WhenToCommit>
                        <RowLocking>SERIALIZABLE</RowLocking>
                        <ChangeDetectionMode>DETECT_ALL</ChangeDetectionMode>
                    </DeltaSettings>
                    <Schema name="Input">
                        <InheritFrom>[parent]</InheritFrom>
                    </Schema>
                    <Schema name="Output">
                        <InheritFrom>[parent]</InheritFrom>
                        <SchemaItem>
                            <Name>$grcObject</Name>
                            <NativeSyntax>JavaScript Object</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>$grcObjectJSON</Name>
                            <NativeSyntax>JSON</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>$grcObjectType</Name>
                            <NativeSyntax>String</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Comment</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Created By</Name>
                            <NativeSyntax>Integer (read only)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Creation Date</Name>
                            <NativeSyntax>Date (read only)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Description</Name>
                            <NativeSyntax>String</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory-ActionPlan:Action Plan</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory-ActionPlan:Invisibility Root Cause</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory-ActionPlan:NCI</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory-ActionPlan:Owner</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory-ActionPlan:Start Date</Name>
                            <NativeSyntax>Date</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory-ActionPlan:Target Date</Name>
                            <NativeSyntax>Date</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Add to GACDW</Name>
                            <NativeSyntax>String</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Assignee</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:CAR Checklist Created</Name>
                            <NativeSyntax>String</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:CPU Detail</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:CPU Type</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Detection Date</Name>
                            <NativeSyntax>Date</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Hostname</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:IP Address</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Invisibility Reason</Name>
                            <NativeSyntax>String</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Kernel Type</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Last Communication Date</Name>
                            <NativeSyntax>Date</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Memory</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:NCI</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Operating System</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Other Invisibility Reason</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Other Remediation Action</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Platform</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Release</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Remediation Action</Name>
                            <NativeSyntax>String</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Serial Number</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:System Model</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Vendor</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Version</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Last Modification Date</Name>
                            <NativeSyntax>Date (read only)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Last Modified By</Name>
                            <NativeSyntax>Integer (read only)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Location</Name>
                            <NativeSyntax>String (limited to 4000 characters) (read only)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Name</Name>
                            <NativeSyntax>String (limited to 4000 characters) (read only)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>OPSS-Assert:Assertions</Name>
                            <NativeSyntax>String (multi-valued)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Orphan</Name>
                            <NativeSyntax>String (limited to 4000 characters) (read only)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Resource ID</Name>
                            <NativeSyntax>Integer (Id) (read only)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>parentFolderId</Name>
                            <NativeSyntax>Integer (Id)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>primaryParentId</Name>
                            <NativeSyntax>Integer (Id)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>typeDefinitionId</Name>
                            <NativeSyntax>Integer (Id)</NativeSyntax>
                        </SchemaItem>
                    </Schema>
                    <LinkCriteria>
                        <InheritFrom>[parent]</InheritFrom>
                        <LinkCriteriaItem>
                            <Key>172d3638ca6</Key>
                            <Attribute>GTS-Inventory:Hostname</Attribute>
                            <Operator>equals</Operator>
                            <Value>$GTS-Inventory:Hostname</Value>
                        </LinkCriteriaItem>
                    </LinkCriteria>
                    <Hooks>
                        <InheritFrom>[parent]</InheritFrom>
                    </Hooks>
                    <CheckpointConfig/>
                    <SandboxConfig/>
                    <Reconnect>
                        <InheritFrom>[parent]</InheritFrom>
                        <ReconnectRules/>
                    </Reconnect>
                    <Operations/>
                    <PoolDefinition>
                        <InheritFrom>[parent]</InheritFrom>
                    </PoolDefinition>
                    <PoolInstance/>
                </Connector>
            </ContainerDF>
            <ThreadOptions/>
            <Operations/>
            <InitParams>
                <Schema name="AssemblyLineInitParams"/>
            </InitParams>
        </AssemblyLine>
        <AssemblyLine name="inventory_readAccounts">
            <ModTime>1592684990133</ModTime>
            <Settings/>
            <Hooks/>
            <CheckpointConfig/>
            <SandboxConfig/>
            <SimulationConfig>
                <SimulationStates>
                    <Component name="Display" state="Enabled"/>
                    <Component name="OpenPages Connector" state="Enabled"/>
                </SimulationStates>
                <ProxySettings/>
            </SimulationConfig>
            <LogConfig/>
            <ContainerEF name="EntryFeedContainer">
                <ModTime>1592684653143</ModTime>
                <Connector name="OpenPages Connector">
                    <InheritFrom>/Connectors/OpenPages Connector</InheritFrom>
                    <ModTime>1592684653143</ModTime>
                    <ConnectorMode>Iterator</ConnectorMode>
                    <ConnectorState>Enabled</ConnectorState>
                    <Configuration>
                        <InheritFrom>[parent]</InheritFrom>
                        <ModTime>1592684597855</ModTime>
                        <parameter name="object">SOXAccount</parameter>
                        <parameter encrypted="true" name="password"/>
                        <parameter name="url">http://gts11.fyre.ibm.com:10108</parameter>
                    </Configuration>
                    <Parser>
                        <InheritFrom>[parent]</InheritFrom>
                    </Parser>
                    <AttributeMap name="Input">
                        <InheritFrom>[parent]</InheritFrom>
                        <ModTime>1592684653143</ModTime>
                        <AttributeMapItem>
                            <Name>*</Name>
                            <Type>simple</Type>
                            <Simple>*</Simple>
                        </AttributeMapItem>
                    </AttributeMap>
                    <AttributeMap name="Output">
                        <InheritFrom>[parent]</InheritFrom>
                        <AttributeMapItem>
                            <Name>*</Name>
                            <Type>simple</Type>
                            <Simple>*</Simple>
                        </AttributeMapItem>
                    </AttributeMap>
                    <DeltaSettings>
                        <WhenToCommit>After every database operation</WhenToCommit>
                        <RowLocking>SERIALIZABLE</RowLocking>
                        <ChangeDetectionMode>DETECT_ALL</ChangeDetectionMode>
                    </DeltaSettings>
                    <Schema name="Input">
                        <InheritFrom>[parent]</InheritFrom>
                    </Schema>
                    <Schema name="Output">
                        <InheritFrom>[parent]</InheritFrom>
                        <SchemaItem>
                            <Name>$grcObject</Name>
                            <NativeSyntax>JavaScript Object</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>$grcObjectJSON</Name>
                            <NativeSyntax>JSON</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>$grcObjectType</Name>
                            <NativeSyntax>String</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Comment</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Created By</Name>
                            <NativeSyntax>Integer (read only)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Creation Date</Name>
                            <NativeSyntax>Date (read only)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Description</Name>
                            <NativeSyntax>String</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory-ActionPlan:Action Plan</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory-ActionPlan:Invisibility Root Cause</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory-ActionPlan:NCI</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory-ActionPlan:Owner</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory-ActionPlan:Start Date</Name>
                            <NativeSyntax>Date</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory-ActionPlan:Target Date</Name>
                            <NativeSyntax>Date</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Add to GACDW</Name>
                            <NativeSyntax>String</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Assignee</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:CAR Checklist Created</Name>
                            <NativeSyntax>String</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:CPU Detail</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:CPU Type</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Detection Date</Name>
                            <NativeSyntax>Date</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Hostname</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:IP Address</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Invisibility Reason</Name>
                            <NativeSyntax>String</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Kernel Type</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Last Communication Date</Name>
                            <NativeSyntax>Date</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Memory</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:NCI</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Operating System</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Other Invisibility Reason</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Other Remediation Action</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Platform</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Release</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Remediation Action</Name>
                            <NativeSyntax>String</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Serial Number</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:System Model</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Vendor</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Version</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Last Modification Date</Name>
                            <NativeSyntax>Date (read only)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Last Modified By</Name>
                            <NativeSyntax>Integer (read only)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Location</Name>
                            <NativeSyntax>String (limited to 4000 characters) (read only)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Name</Name>
                            <NativeSyntax>String (limited to 4000 characters) (read only)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>OPSS-Assert:Assertions</Name>
                            <NativeSyntax>String (multi-valued)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Orphan</Name>
                            <NativeSyntax>String (limited to 4000 characters) (read only)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Resource ID</Name>
                            <NativeSyntax>Integer (Id) (read only)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>parentFolderId</Name>
                            <NativeSyntax>Integer (Id)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>primaryParentId</Name>
                            <NativeSyntax>Integer (Id)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>typeDefinitionId</Name>
                            <NativeSyntax>Integer (Id)</NativeSyntax>
                        </SchemaItem>
                    </Schema>
                    <LinkCriteria>
                        <InheritFrom>[parent]</InheritFrom>
                        <LinkCriteriaItem>
                            <Key>172d3638ca6</Key>
                            <Attribute>GTS-Inventory:Hostname</Attribute>
                            <Operator>equals</Operator>
                            <Value>$GTS-Inventory:Hostname</Value>
                        </LinkCriteriaItem>
                    </LinkCriteria>
                    <Hooks>
                        <InheritFrom>[parent]</InheritFrom>
                    </Hooks>
                    <CheckpointConfig/>
                    <SandboxConfig/>
                    <Reconnect>
                        <InheritFrom>[parent]</InheritFrom>
                        <ReconnectRules/>
                    </Reconnect>
                    <Operations/>
                    <PoolDefinition>
                        <InheritFrom>[parent]</InheritFrom>
                    </PoolDefinition>
                    <PoolInstance/>
                </Connector>
            </ContainerEF>
            <ContainerDF name="DataFlowContainer">
                <ModTime>1592684990133</ModTime>
                <Script name="Display">
                    <ModTime>1592684990133</ModTime>
                    <parameter name="script"><![CDATA[foundit = false;
for (att in work) {
	value = (att.getValue() || "").toLowerCase();
	if (value.contains("white hat")) {
		foundit = true;
		break;
	}
}

if (foundit) task.logmsg(work);]]></parameter>
                </Script>
            </ContainerDF>
            <ThreadOptions/>
            <Operations/>
            <InitParams>
                <Schema name="AssemblyLineInitParams"/>
            </InitParams>
        </AssemblyLine>
        <AssemblyLine name="inventory_writeCSV">
            <ModTime>1593084497250</ModTime>
            <Settings>
                <parameter name="ALPoolSettingsDialog">showALPoolSettings</parameter>
                <parameter name="automapattributes">false</parameter>
                <parameter name="createTombstones">false</parameter>
                <parameter name="includeGlobalPrologs">true</parameter>
                <parameter name="includePrologs"><![CDATA[Script_Lib
]]></parameter>
                <parameter name="nullBehaviorDialog">showNullBehavior</parameter>
            </Settings>
            <Hooks/>
            <CheckpointConfig/>
            <SandboxConfig/>
            <SimulationConfig>
                <SimulationStates>
                    <Component name="Read CSV" state="Enabled"/>
                    <Component name="OpenPages Connector" state="Simulated"/>
                </SimulationStates>
                <ProxySettings/>
            </SimulationConfig>
            <LogConfig/>
            <ContainerEF name="EntryFeedContainer">
                <ModTime>1593084469598</ModTime>
                <Connector name="OpenPages Connector">
                    <InheritFrom>/Connectors/OpenPages Connector</InheritFrom>
                    <ModTime>1593084469598</ModTime>
                    <ConnectorMode>Iterator</ConnectorMode>
                    <ConnectorState>Enabled</ConnectorState>
                    <Configuration>
                        <InheritFrom>[parent]</InheritFrom>
                        <ModTime>1593084041666</ModTime>
                    </Configuration>
                    <Parser>
                        <InheritFrom>[parent]</InheritFrom>
                    </Parser>
                    <AttributeMap name="Input">
                        <InheritFrom>[parent]</InheritFrom>
                        <ModTime>1593084469598</ModTime>
                        <AttributeMapItem>
                            <Name>$grcObject</Name>
                            <Type>advanced</Type>
                            <Script>null</Script>
                            <Simple>$grcObject</Simple>
                        </AttributeMapItem>
                        <AttributeMapItem>
                            <Name>$grcObjectJSON</Name>
                            <Type>advanced</Type>
                            <Script>null</Script>
                            <Simple>$grcObjectJSON</Simple>
                        </AttributeMapItem>
                        <AttributeMapItem>
                            <Name>$grcObjectType</Name>
                            <Type>advanced</Type>
                            <Script>null</Script>
                            <Simple>$grcObjectType</Simple>
                        </AttributeMapItem>
                        <AttributeMapItem>
                            <Name>*</Name>
                            <Type>simple</Type>
                            <Simple>*</Simple>
                        </AttributeMapItem>
                    </AttributeMap>
                    <AttributeMap name="Output">
                        <InheritFrom>[parent]</InheritFrom>
                        <ModTime>1593009906904</ModTime>
                        <AttributeMapItem>
                            <Name>*</Name>
                            <Type>simple</Type>
                            <Simple>*</Simple>
                        </AttributeMapItem>
                        <AttributeMapItem>
                            <Name>primaryParentId</Name>
                            <Type>advanced</Type>
                            <Enabled>true</Enabled>
                            <Add>true</Add>
                            <Modify>true</Modify>
                            <Script>7465</Script>
                            <Simple>primaryParentId</Simple>
                        </AttributeMapItem>
                        <AttributeMapItem>
                            <Name>primaryParentType</Name>
                            <Type>advanced</Type>
                            <Script>"SOXAccount"</Script>
                            <Simple>primaryParentType</Simple>
                        </AttributeMapItem>
                    </AttributeMap>
                    <DeltaSettings>
                        <ModTime>1592683374799</ModTime>
                        <WhenToCommit>After every database operation</WhenToCommit>
                        <RowLocking>SERIALIZABLE</RowLocking>
                        <ChangeDetectionMode>DETECT_ALL</ChangeDetectionMode>
                    </DeltaSettings>
                    <Schema name="Input">
                        <InheritFrom>[parent]</InheritFrom>
                        <ModTime>1593084445170</ModTime>
                        <SchemaItem>
                            <Name>$grcObject</Name>
                            <NativeSyntax>JavaScript Object</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>$grcObjectJSON</Name>
                            <NativeSyntax>JSON</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>$grcObjectType</Name>
                            <NativeSyntax>String</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Comment</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Created By</Name>
                            <NativeSyntax>Integer (read only)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Creation Date</Name>
                            <NativeSyntax>Date (read only)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Description</Name>
                            <NativeSyntax>String</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Last Modification Date</Name>
                            <NativeSyntax>Date (read only)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Last Modified By</Name>
                            <NativeSyntax>Integer (read only)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Location</Name>
                            <NativeSyntax>String (limited to 4000 characters) (read only)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Name</Name>
                            <NativeSyntax>String (limited to 4000 characters) (read only)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>OPSS-Assert:Assertions</Name>
                            <NativeSyntax>String (multi-valued)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Orphan</Name>
                            <NativeSyntax>String (limited to 4000 characters) (read only)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Resource ID</Name>
                            <NativeSyntax>Integer (Id) (read only)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>parentFolderId</Name>
                            <NativeSyntax>Integer (Id)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>primaryParentId</Name>
                            <NativeSyntax>Integer (Id)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>typeDefinitionId</Name>
                            <NativeSyntax>Integer (Id)</NativeSyntax>
                        </SchemaItem>
                    </Schema>
                    <Schema name="Output">
                        <InheritFrom>[parent]</InheritFrom>
                        <ModTime>1592684392665</ModTime>
                        <SchemaItem>
                            <Name>$grcObject</Name>
                            <NativeSyntax>JavaScript Object</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>$grcObjectJSON</Name>
                            <NativeSyntax>JSON</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>$grcObjectType</Name>
                            <NativeSyntax>String</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Comment</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Created By</Name>
                            <NativeSyntax>Integer (read only)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Creation Date</Name>
                            <NativeSyntax>Date (read only)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Description</Name>
                            <NativeSyntax>String</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory-ActionPlan:Action Plan</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory-ActionPlan:Invisibility Root Cause</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory-ActionPlan:NCI</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory-ActionPlan:Owner</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory-ActionPlan:Start Date</Name>
                            <NativeSyntax>Date</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory-ActionPlan:Target Date</Name>
                            <NativeSyntax>Date</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Add to GACDW</Name>
                            <NativeSyntax>String</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Assignee</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:CAR Checklist Created</Name>
                            <NativeSyntax>String</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:CPU Detail</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:CPU Type</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Detection Date</Name>
                            <NativeSyntax>Date</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Hostname</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:IP Address</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Invisibility Reason</Name>
                            <NativeSyntax>String</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Kernel Type</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Last Communication Date</Name>
                            <NativeSyntax>Date</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Memory</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:NCI</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Operating System</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Other Invisibility Reason</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Other Remediation Action</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Platform</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Release</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Remediation Action</Name>
                            <NativeSyntax>String</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Serial Number</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:System Model</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Vendor</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Version</Name>
                            <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Last Modification Date</Name>
                            <NativeSyntax>Date (read only)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Last Modified By</Name>
                            <NativeSyntax>Integer (read only)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Location</Name>
                            <NativeSyntax>String (limited to 4000 characters) (read only)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Name</Name>
                            <NativeSyntax>String (limited to 4000 characters) (read only)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>OPSS-Assert:Assertions</Name>
                            <NativeSyntax>String (multi-valued)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Orphan</Name>
                            <NativeSyntax>String (limited to 4000 characters) (read only)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Resource ID</Name>
                            <NativeSyntax>Integer (Id) (read only)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>parentFolderId</Name>
                            <NativeSyntax>Integer (Id)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>primaryParentId</Name>
                            <NativeSyntax>Integer (Id)</NativeSyntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>typeDefinitionId</Name>
                            <NativeSyntax>Integer (Id)</NativeSyntax>
                        </SchemaItem>
                    </Schema>
                    <LinkCriteria>
                        <InheritFrom>[parent]</InheritFrom>
                        <ModTime>1592684490735</ModTime>
                        <LinkCriteriaItem>
                            <Key>172d3638ca6</Key>
                            <Attribute>GTS-Inventory:Hostname</Attribute>
                            <Operator>equals</Operator>
                            <Value>$GTS-Inventory:Hostname</Value>
                        </LinkCriteriaItem>
                    </LinkCriteria>
                    <Hooks>
                        <InheritFrom>[parent]</InheritFrom>
                    </Hooks>
                    <CheckpointConfig/>
                    <SandboxConfig/>
                    <Reconnect>
                        <InheritFrom>[parent]</InheritFrom>
                        <ReconnectRules/>
                    </Reconnect>
                    <Operations/>
                    <PoolDefinition>
                        <InheritFrom>[parent]</InheritFrom>
                    </PoolDefinition>
                    <PoolInstance/>
                </Connector>
            </ContainerEF>
            <ContainerDF name="DataFlowContainer">
                <ModTime>1593084020965</ModTime>
                <Connector name="Read CSV">
                    <InheritFrom>system:/Connectors/ibmdi.FileSystem</InheritFrom>
                    <ModTime>1593084020965</ModTime>
                    <ConnectorMode>AddOnly</ConnectorMode>
                    <ConnectorState>Enabled</ConnectorState>
                    <Configuration>
                        <InheritFrom>[parent]</InheritFrom>
                        <ModTime>1592683296327</ModTime>
                        <parameter name="filePath">POC_MVP/inventory_test.csv</parameter>
                    </Configuration>
                    <Parser>
                        <InheritFrom>system:/Parsers/ibmdi.CSV</InheritFrom>
                        <ModTime>1592683310766</ModTime>
                        <parameter name="csvColumnSeparator">,</parameter>
                    </Parser>
                    <AttributeMap name="Input">
                        <InheritFrom>[parent]</InheritFrom>
                        <ModTime>1592684734995</ModTime>
                        <AttributeMapItem>
                            <Name>$grcObjecType</Name>
                            <Type>simple</Type>
                            <Simple>$grcObjecType</Simple>
                        </AttributeMapItem>
                        <AttributeMapItem>
                            <Name>Description</Name>
                            <Type>simple</Type>
                            <Simple>Description</Simple>
                        </AttributeMapItem>
                        <AttributeMapItem>
                            <Name>GTS-Inventory-ActionPlan:Invisibility Root Cause</Name>
                            <Type>simple</Type>
                            <Simple>GTS-Inventory-ActionPlan:Invisibility Root Cause</Simple>
                        </AttributeMapItem>
                        <AttributeMapItem>
                            <Name>GTS-Inventory:CAR Checklist Created</Name>
                            <Type>simple</Type>
                            <Simple>GTS-Inventory:CAR Checklist Created</Simple>
                        </AttributeMapItem>
                        <AttributeMapItem>
                            <Name>GTS-Inventory:CAR Checklist Created_index</Name>
                            <Type>simple</Type>
                            <Simple>GTS-Inventory:CAR Checklist Created_index</Simple>
                        </AttributeMapItem>
                        <AttributeMapItem>
                            <Name>GTS-Inventory:Detection Date</Name>
                            <Type>simple</Type>
                            <Simple>GTS-Inventory:Detection Date</Simple>
                        </AttributeMapItem>
                        <AttributeMapItem>
                            <Name>GTS-Inventory:Hostname</Name>
                            <Type>simple</Type>
                            <Simple>GTS-Inventory:Hostname</Simple>
                        </AttributeMapItem>
                        <AttributeMapItem>
                            <Name>GTS-Inventory:IP Address</Name>
                            <Type>simple</Type>
                            <Simple>GTS-Inventory:IP Address</Simple>
                        </AttributeMapItem>
                        <AttributeMapItem>
                            <Name>GTS-Inventory:Invisibility Reason</Name>
                            <Type>simple</Type>
                            <Simple>GTS-Inventory:Invisibility Reason</Simple>
                        </AttributeMapItem>
                        <AttributeMapItem>
                            <Name>GTS-Inventory:Invisibility Reason_index</Name>
                            <Type>simple</Type>
                            <Simple>GTS-Inventory:Invisibility Reason_index</Simple>
                        </AttributeMapItem>
                        <AttributeMapItem>
                            <Name>GTS-Inventory:Operating System</Name>
                            <Type>simple</Type>
                            <Simple>GTS-Inventory:Operating System</Simple>
                        </AttributeMapItem>
                        <AttributeMapItem>
                            <Name>GTS-Inventory:Platform</Name>
                            <Type>simple</Type>
                            <Simple>GTS-Inventory:Platform</Simple>
                        </AttributeMapItem>
                        <AttributeMapItem>
                            <Name>GTS-Inventory:Release</Name>
                            <Type>simple</Type>
                            <Simple>GTS-Inventory:Release</Simple>
                        </AttributeMapItem>
                        <AttributeMapItem>
                            <Name>GTS-Inventory:Remediation Action</Name>
                            <Type>simple</Type>
                            <Simple>GTS-Inventory:Remediation Action</Simple>
                        </AttributeMapItem>
                        <AttributeMapItem>
                            <Name>GTS-Inventory:Remediation Action_index</Name>
                            <Type>simple</Type>
                            <Simple>GTS-Inventory:Remediation Action_index</Simple>
                        </AttributeMapItem>
                        <AttributeMapItem>
                            <Name>GTS-Inventory:Serial Number</Name>
                            <Type>simple</Type>
                            <Simple>GTS-Inventory:Serial Number</Simple>
                        </AttributeMapItem>
                        <AttributeMapItem>
                            <Name>GTS-Inventory:System Model</Name>
                            <Type>simple</Type>
                            <Simple>GTS-Inventory:System Model</Simple>
                        </AttributeMapItem>
                        <AttributeMapItem>
                            <Name>GTS-Inventory:Vendor</Name>
                            <Type>simple</Type>
                            <Simple>GTS-Inventory:Vendor</Simple>
                        </AttributeMapItem>
                        <AttributeMapItem>
                            <Name>GTS-Inventory:Version</Name>
                            <Type>simple</Type>
                            <Simple>GTS-Inventory:Version</Simple>
                        </AttributeMapItem>
                    </AttributeMap>
                    <AttributeMap name="Output">
                        <InheritFrom>[parent]</InheritFrom>
                        <ModTime>1593084020965</ModTime>
                        <AttributeMapItem>
                            <Name>*</Name>
                            <Type>simple</Type>
                            <Simple>*</Simple>
                        </AttributeMapItem>
                    </AttributeMap>
                    <DeltaSettings>
                        <ModTime>1592683247505</ModTime>
                        <WhenToCommit>After every database operation</WhenToCommit>
                        <RowLocking>SERIALIZABLE</RowLocking>
                        <ChangeDetectionMode>DETECT_ALL</ChangeDetectionMode>
                    </DeltaSettings>
                    <Schema name="Input">
                        <InheritFrom>[parent]</InheritFrom>
                        <ModTime>1592683318739</ModTime>
                        <SchemaItem>
                            <Name>$grcObject</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>$grcObjectJSON</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Created By</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Creation Date</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Description</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory-ActionPlan:Invisibility Root Cause</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:CAR Checklist Created</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:CAR Checklist Created_index</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Detection Date</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Hostname</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:IP Address</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Invisibility Reason</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Invisibility Reason_index</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Operating System</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Platform</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Release</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Remediation Action</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Remediation Action_index</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Serial Number</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:System Model</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Vendor</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Version</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Last Modification Date</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Last Modified By</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Location</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Orphan</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Resource ID</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                    </Schema>
                    <Schema name="Output">
                        <InheritFrom>[parent]</InheritFrom>
                        <ModTime>1592683318750</ModTime>
                        <SchemaItem>
                            <Name>$grcObject</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>$grcObjectJSON</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Created By</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Creation Date</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Description</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory-ActionPlan:Invisibility Root Cause</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:CAR Checklist Created</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:CAR Checklist Created_index</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Detection Date</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Hostname</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:IP Address</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Invisibility Reason</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Invisibility Reason_index</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Operating System</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Platform</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Release</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Remediation Action</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Remediation Action_index</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Serial Number</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Serial Number,Location,GTS-Inventory:System Model,GTS-Inventory:Invisibility Reason_index,GTS-Inventory:CAR Checklist Created,GTS-Inventory:Platform,GTS-Inventory-ActionPlan:Invisibility Root Cause,$grcObjectJSON,GTS-Inventory:Vendor,GTS-Inventory:Operating System,GTS-Inventory:Remediation Action_index,GTS-Inventory:Release,Last Modified By,Creation Date,GTS-Inventory:Detection Date,Last Modification Date,GTS-Inventory:CAR Checklist Created_index,GTS-Inventory:Hostname,Resource ID,$grcObject,Orphan,GTS-Inventory:IP Address,GTS-Inventory:Version,GTS-Inventory:Invisibility Reason,Description,Created By,GTS-Inventory:Remediation Action</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:System Model</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Vendor</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>GTS-Inventory:Version</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Last Modification Date</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Last Modified By</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Location</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Orphan</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                        <SchemaItem>
                            <Name>Resource ID</Name>
                            <Syntax>java.lang.String</Syntax>
                        </SchemaItem>
                    </Schema>
                    <LinkCriteria>
                        <InheritFrom>[parent]</InheritFrom>
                        <ModTime>1592683238299</ModTime>
                    </LinkCriteria>
                    <Hooks>
                        <InheritFrom>[parent]</InheritFrom>
                        <ModTime>1592683238299</ModTime>
                    </Hooks>
                    <CheckpointConfig/>
                    <SandboxConfig/>
                    <Reconnect>
                        <InheritFrom>[parent]</InheritFrom>
                        <ReconnectRules/>
                    </Reconnect>
                    <Operations/>
                    <PoolDefinition>
                        <InheritFrom>[parent]</InheritFrom>
                    </PoolDefinition>
                    <PoolInstance/>
                    <LookupLimit>1</LookupLimit>
                </Connector>
            </ContainerDF>
            <ThreadOptions/>
            <Operations/>
            <InitParams>
                <Schema name="AssemblyLineInitParams"/>
            </InitParams>
        </AssemblyLine>
        <AssemblyLine name="z_CheckCCMigration">
            <ModTime>1604935220162</ModTime>
            <Settings>
                <parameter name="ALPoolSettingsDialog">showALPoolSettings</parameter>
                <parameter name="automapattributes">false</parameter>
                <parameter name="createTombstones">false</parameter>
                <parameter name="includeGlobalPrologs">true</parameter>
                <parameter name="includePrologs"><![CDATA[ClauseControlObj
DeviationsMap
Mapper
OpenPagesObj
Script_Lib
Timer
ePolicyObj]]></parameter>
                <parameter name="nullBehaviorDialog">showNullBehavior</parameter>
            </Settings>
            <Hooks/>
            <CheckpointConfig/>
            <SandboxConfig/>
            <SimulationConfig>
                <SimulationStates>
                    <Component name="Setup" state="Enabled"/>
                    <Component name="Check CC Updates" state="Enabled"/>
                </SimulationStates>
                <ProxySettings/>
            </SimulationConfig>
            <LogConfig/>
            <ContainerEF name="EntryFeedContainer"/>
            <ContainerDF name="DataFlowContainer">
                <ModTime>1604935220162</ModTime>
                <Script name="Setup">
                    <ModTime>1604933867037</ModTime>
                    <parameter name="script"><![CDATA[policyName = "POL-1133-Acc-341-AG"; // 1089, 1091, 1093

log("\n\n\n----------- Using Policy: " + policyName + "\n\n\n.");

timer = new Timer();

ePolicy = {
    userName: "db2inst1",
    password: "Epolicy2ibm@123",
    hostname: "mopbzp174025.fr.dst.ibm.com",
    port: "50000",
    database: "POLICYL"
  }

mappingTable = {};

op = new OpenPagesObj();

db = new ePolicyObj({
	    userName: "db2inst1",
	    password: "Epolicy2ibm@123",
	    hostName: "mopbzp174025.fr.dst.ibm.com",
	    port: "50000",
	    database: "POLICYL"
	  });

var CSDjson = '{"TEMPLATE_ID":1288,"TEMPLATE_TYPE_ID":2,"ACCOUNT_ID":1248,"TEMPLATE_TYPE_NAME":"Base Policy","NEXT_REVIEW_DATE":"2018-07-11","ACCOUNT_NUMBER_TYPE_NAME":null,"STATUS":"Production","EMAIL":"jrvalero@us.ibm.com","DELETED_TS":null,"LOCKED_FLAG":"N","FULL_NAME":"United States of America","NAME":"Customer Security Document","POLICY_TYPE_ID":24,"ID":5685,"REVISION":1,"CURRENT_APPROVAL_DATE":"2017-01-11","FILE_NAME":"","IMPORTED_FLAG":"N","TEMPLATE_POLICYTYPE_NAME":"CSD","LOCATION_ID":245,"LOCKED_BY":null,"REVISION_COUNT":1,"STATUS_ID":7,"ENVIRONMENT":"","TEMPLATE_POLICYTYPE_ID":24,"UPDATED_TS":"2014-10-09 18:28:05.614806","POLICY_TYPE_NAME":"CSD","LOCKED_TS":null,"TEMPLATE_VERSION":"1.2                      ","FORMAT":"DOCX","POLICY_ID":3003,"ACCOUNT_NUMBER":"","SHORTNAME":"CBANA","HISTORY_FLAG":"Y"}';
var CSD = work.fromJSON(CSDjson);
CSD.csd_status = CSD.status;

log("Lookup Policy " + policyName + "...");
var newPolicy = op.findOne("Name", policyName, "Policy");
if (newPolicy == null) {
	log("ERROR", "Unable to find Policy: " + policyName);
	throw "Unable to find Policy: " + policyName
}

var id = newPolicy.getString("Resource ID");

log("\n\n\n======================-----> Found " + policyName + " (" + id 
		+ ") - Status: " 
		+ newPolicy.getString("OPSS-Pol:Status")
		+ "\n\n\n.");

cc = new ClauseControlObj({
	openPagesObj: op,
	debug: false,
	validate: true
});

devMapObj = new DeviationMap({id: id, op: op, db: db});


function fixClient(txt, token) {
	var tokenLen = token.length;
	var p = 1;
	do {
		p = txt.indexOf(token);
		if (p >= 0) {
			txt = txt.substring(0, p) + "Copacabana" + txt.substring(p+tokenLen);
		}
	} while (p >= 0);
	return txt;	
}]]></parameter>
                </Script>
                <Script name="Check CC Updates">
                    <ModTime>1604935220162</ModTime>
                    <parameter name="script"><![CDATA[ccTypes = {RR: true, RV: true};

token = "[%customer%]";

bad = [];
for (ccType in ccTypes) {
	log("--- Checking " + ccType);
	
	actCCs = devMapObj.opMap[ccType];
	epCCs = devMapObj.epMap[ccType];

	arr = actCCs.keySet().toArray();
	java.util.Arrays.sort(arr);
	cnt = 0;
	for (ref in arr) {
		actualCC = actCCs.get(ref);
		epolicyCC = epCCs.get(ref);
		templateCC = cc.findClauseControl(ref);
		
		if (cnt++ % 25 == 0) {
			log("..." + cnt);
		}
		
		// Now to compare the values
		found = [];
		if (ccType == "RR") {
			for (var i = 2; i < 5; i++) {
				if (typeof epolicyCC == "undefined" || epolicyCC == null) continue;
				
				epValue = epolicyCC["col" + i].trim().replaceAll("\n","|").replaceAll("  ", " ");
				actValue = fixClient(actualCC["col" + i].trim().replaceAll("\n","|").replaceAll("  ", " "), token);
				if (epValue != actValue && epValue != "TBD" && epValue) {
					found.push("RR " + ref + " col"+ i + " not correctly set to ePolicy value"
								+ "\n epValue: " + epValue
								+ "\n  actual: " + actValue);
				}
			}
		} else {
			for (var i = 2; i < 5; i++) {
				if (i == 3) {
					shouldBeValue = fixClient(templateCC.getString("GTS-ClauseCtl:Col" + i).trim().replaceAll("\n","|").replaceAll("  ", " "), token);
					err = " does not have template value";
				} else {
					if (typeof epolicyCC == "undefined" || epolicyCC == null) continue;
					shouldBeValue = epolicyCC["col" + i].trim().replaceAll("\n","|").replaceAll("  ", " ");;
					err = " does not have ePolicy value";
				}
				actValue = fixClient(actualCC["col" + i].trim().replaceAll("\n","|").replaceAll("  ", " "), token);
				if (shouldBeValue != actValue && shouldBeValue != "TBD" && shouldBeValue) {
					found.push("RV " + ref + " col" + i + " " + err
								+ "\n correct: " + shouldBeValue
								+ "\n  actual: " + actValue);
				}
			}
		}
		if (found.length > 0) {
			bad = bad.concat(found);
		}
	}
	
	log("Handled " + cnt + " CCs");
}

if (bad.length == 0) {
	log("No problems found! :)");
	return;
}

log("Found " + bad.length + " problems:\n" + bad.join("\n   "));]]></parameter>
                </Script>
            </ContainerDF>
            <ThreadOptions/>
            <Operations/>
            <InitParams>
                <Schema name="AssemblyLineInitParams"/>
            </InitParams>
        </AssemblyLine>
        <AssemblyLine name="z_ReadObject">
            <ModTime>1599138134995</ModTime>
            <Settings>
                <parameter name="ALPoolSettingsDialog">showALPoolSettings</parameter>
                <parameter name="automapattributes">false</parameter>
                <parameter name="createTombstones">false</parameter>
                <parameter name="includeGlobalPrologs">true</parameter>
                <parameter name="includePrologs"><![CDATA[ClauseControlObj
ExcelObj
Mapper
OpenPagesObj
RequestObj
SCP
Script_Lib
Timer
WordDoc
ePolicyObj
]]></parameter>
                <parameter name="nullBehaviorDialog">showNullBehavior</parameter>
            </Settings>
            <Hooks>
                <ModTime>1599123574537</ModTime>
            </Hooks>
            <CheckpointConfig/>
            <SandboxConfig/>
            <SimulationConfig>
                <SimulationStates>
                    <Component name="Display" state="Enabled"/>
                    <Component name="OpenPages Connector" state="Enabled"/>
                </SimulationStates>
                <ProxySettings/>
            </SimulationConfig>
            <LogConfig/>
            <ContainerEF name="EntryFeedContainer">
                <ModTime>1599138134995</ModTime>
                <Connector name="OpenPages Connector">
                    <InheritFrom>/Connectors/OpenPages Connector</InheritFrom>
                    <ModTime>1599138134995</ModTime>
                    <ConnectorMode>Iterator</ConnectorMode>
                    <ConnectorState>Enabled</ConnectorState>
                    <Configuration>
                        <InheritFrom>[parent]</InheritFrom>
                        <ModTime>1599138134995</ModTime>
                        <parameter name="object">Policy</parameter>
                        <parameter name="query">select * from [SOXAccount] where [SOXAccount].[Name]='Acc-341-AG'</parameter>
                    </Configuration>
                    <Parser>
                        <InheritFrom>[parent]</InheritFrom>
                    </Parser>
                    <AttributeMap name="Input">
                        <InheritFrom>[parent]</InheritFrom>
                        <ModTime>1599123685725</ModTime>
                        <AttributeMapItem>
                            <Name>*</Name>
                            <Type>simple</Type>
                            <Simple>*</Simple>
                        </AttributeMapItem>
                    </AttributeMap>
                    <AttributeMap name="Output">
                        <InheritFrom>[parent]</InheritFrom>
                    </AttributeMap>
                    <DeltaSettings>
                        <ModTime>1599123591106</ModTime>
                        <WhenToCommit>After every database operation</WhenToCommit>
                        <RowLocking>SERIALIZABLE</RowLocking>
                        <ChangeDetectionMode>DETECT_ALL</ChangeDetectionMode>
                    </DeltaSettings>
                    <Schema name="Input">
                        <InheritFrom>[parent]</InheritFrom>
                    </Schema>
                    <Schema name="Output">
                        <InheritFrom>[parent]</InheritFrom>
                    </Schema>
                    <LinkCriteria>
                        <InheritFrom>[parent]</InheritFrom>
                    </LinkCriteria>
                    <Hooks>
                        <InheritFrom>[parent]</InheritFrom>
                    </Hooks>
                    <CheckpointConfig/>
                    <SandboxConfig/>
                    <Reconnect>
                        <InheritFrom>[parent]</InheritFrom>
                        <ReconnectRules/>
                    </Reconnect>
                    <Operations/>
                    <PoolDefinition>
                        <InheritFrom>[parent]</InheritFrom>
                    </PoolDefinition>
                    <PoolInstance/>
                </Connector>
            </ContainerEF>
            <ContainerDF name="DataFlowContainer">
                <ModTime>1599124770258</ModTime>
                <Script name="Display">
                    <ModTime>1599124770258</ModTime>
                    <parameter name="script"><![CDATA[log(work.name + " - " + work["Resource Id"]);
log("\n" + work);]]></parameter>
                </Script>
            </ContainerDF>
            <ThreadOptions/>
            <Operations/>
            <InitParams>
                <Schema name="AssemblyLineInitParams"/>
            </InitParams>
        </AssemblyLine>
        <AssemblyLine name="z_StartTransition">
            <ModTime>1603204424972</ModTime>
            <Settings>
                <parameter name="ALPoolSettingsDialog">showALPoolSettings</parameter>
                <parameter name="automapattributes">false</parameter>
                <parameter name="createTombstones">false</parameter>
                <parameter name="includeGlobalPrologs">true</parameter>
                <parameter name="includePrologs"><![CDATA[Mapper
OpenPagesObj
Script_Lib
ePolicyObj
ExcelObj
]]></parameter>
                <parameter name="nullBehaviorDialog">showNullBehavior</parameter>
            </Settings>
            <Hooks/>
            <CheckpointConfig/>
            <SandboxConfig/>
            <SimulationConfig>
                <SimulationStates>
                    <Component name="Start transition" state="Enabled"/>
                    <Component name="OpenPages Connector" state="Enabled"/>
                </SimulationStates>
                <ProxySettings/>
            </SimulationConfig>
            <LogConfig/>
            <ContainerEF name="EntryFeedContainer"/>
            <ContainerDF name="DataFlowContainer">
                <ModTime>1603204424972</ModTime>
                <Script name="Start transition">
                    <ModTime>1603204424972</ModTime>
                    <parameter name="script"><![CDATA[objectType = "GTSDeviation";
objectName = "DEV-383-CL-95-POL-74-Acc-166-AG";

objectType = "Policy";
objectName = "POL-977-Acc-341-AG";

op = new OpenPagesObj(this.op || null);

policyEntry = op.find("Name", objectName, objectType)[0];

op.startTransition({
	resourceId: policyEntry.getString("Resource ID"), 
	objectType: objectType,
	workflowName: "Policy Workflow", 
	transitionName: "Generate Policy", 
	statusField: "OPSS-Pol:Status",
	resultingStatus: "Draft"	
});]]></parameter>
                </Script>
                <Connector name="OpenPages Connector">
                    <InheritFrom>/Connectors/OpenPages Connector</InheritFrom>
                    <ModTime>1603198382597</ModTime>
                    <ConnectorMode>AddOnly</ConnectorMode>
                    <ConnectorState>Passive</ConnectorState>
                    <Configuration>
                        <InheritFrom>[parent]</InheritFrom>
                    </Configuration>
                    <Parser>
                        <InheritFrom>[parent]</InheritFrom>
                    </Parser>
                    <AttributeMap name="Input">
                        <InheritFrom>[parent]</InheritFrom>
                    </AttributeMap>
                    <AttributeMap name="Output">
                        <InheritFrom>[parent]</InheritFrom>
                    </AttributeMap>
                    <DeltaSettings/>
                    <Schema name="Input">
                        <InheritFrom>[parent]</InheritFrom>
                    </Schema>
                    <Schema name="Output">
                        <InheritFrom>[parent]</InheritFrom>
                    </Schema>
                    <LinkCriteria>
                        <InheritFrom>[parent]</InheritFrom>
                    </LinkCriteria>
                    <Hooks>
                        <InheritFrom>[parent]</InheritFrom>
                        <ModTime>1600691496642</ModTime>
                        <Hook name="after_initialize">
                            <InheritFrom>[no inheritance]</InheritFrom>
                            <Name>after_initialize</Name>
                            <Script>op = thisConnector.connector;</Script>
                            <Enabled>true</Enabled>
                        </Hook>
                    </Hooks>
                    <CheckpointConfig/>
                    <SandboxConfig/>
                    <Reconnect>
                        <InheritFrom>[parent]</InheritFrom>
                        <ReconnectRules/>
                    </Reconnect>
                    <Operations/>
                    <PoolDefinition>
                        <InheritFrom>[parent]</InheritFrom>
                    </PoolDefinition>
                    <PoolInstance/>
                </Connector>
            </ContainerDF>
            <ThreadOptions/>
            <Operations/>
            <InitParams>
                <Schema name="AssemblyLineInitParams"/>
            </InitParams>
        </AssemblyLine>
        <AssemblyLine name="z_combineExcel">
            <ModTime>1598256870193</ModTime>
            <Settings>
                <parameter name="ALPoolSettingsDialog">showALPoolSettings</parameter>
                <parameter name="automapattributes">false</parameter>
                <parameter name="createTombstones">false</parameter>
                <parameter name="includeGlobalPrologs">true</parameter>
                <parameter name="includePrologs"><![CDATA[ExcelObj
Mapper
Script_Lib
]]></parameter>
                <parameter name="nullBehaviorDialog">showNullBehavior</parameter>
            </Settings>
            <Hooks/>
            <CheckpointConfig/>
            <SandboxConfig/>
            <SimulationConfig>
                <SimulationStates>
                    <Component name="Do it" state="Enabled"/>
                </SimulationStates>
                <ProxySettings/>
            </SimulationConfig>
            <LogConfig/>
            <ContainerEF name="EntryFeedContainer"/>
            <ContainerDF name="DataFlowContainer">
                <ModTime>1598256870193</ModTime>
                <Script name="Do it">
                    <ModTime>1598256870193</ModTime>
                    <parameter name="script"><![CDATA[ex = new ExcelSheet("POC_MVP/test.xlsx");

useDir = "/media/psf/Home/Downloads";
dir = new java.io.File(useDir);
list = dir.list();

for (filename in list) {
	if (filename.endsWith("xls")) {
		log("Handling " + filename);
		byteArray = loadFileToByteArray(useDir + "/" + filename);
		
		ex.addRows(byteArray);
	}
}]]></parameter>
                </Script>
            </ContainerDF>
            <ThreadOptions/>
            <Operations/>
            <InitParams>
                <Schema name="AssemblyLineInitParams"/>
            </InitParams>
        </AssemblyLine>
        <AssemblyLine name="z_createMailDoc">
            <ModTime>1602245060096</ModTime>
            <Settings>
                <parameter name="ALPoolSettingsDialog">showALPoolSettings</parameter>
                <parameter name="automapattributes">false</parameter>
                <parameter name="createTombstones">false</parameter>
                <parameter name="includeGlobalPrologs">true</parameter>
                <parameter name="includePrologs"><![CDATA[Mapper
OpenPagesObj
Script_Lib
WordDoc]]></parameter>
                <parameter name="nullBehaviorDialog">showNullBehavior</parameter>
            </Settings>
            <Hooks/>
            <CheckpointConfig/>
            <SandboxConfig/>
            <SimulationConfig>
                <SimulationStates>
                    <Component name="set up status" state="Enabled"/>
                </SimulationStates>
                <ProxySettings/>
            </SimulationConfig>
            <LogConfig/>
            <ContainerEF name="EntryFeedContainer"/>
            <ContainerDF name="DataFlowContainer">
                <ModTime>1602245060096</ModTime>
                <Script name="set up status">
                    <ModTime>1602245060096</ModTime>
                    <parameter name="script"><![CDATA[status = {
	date: new Date(),
	epolicy: {
        userName: "db2inst1",
        password: "Epolicy2ibm@123",
        hostname: "mopbzp174025.fr.dst.ibm.com",
        port: "50000",
        database: "POLICYL"
    },
	  accounts: [
        "Copacabana"
    ],
		opUserEmail : "eddie.hartman@no.ibm.com",
		mappingTable : {
        "BR001": "A",
        "BR002": "TBD"
    },
	status: {
        "errors": [
            "Migration of all accounts failed"
        ],
        "message": "See Account details for more information",
        "accounts": [
            {
                "message": "'thisAction' not found (class com.ibm.di.entry.Attribute)",
                "error": "'thisAction' not found (class com.ibm.di.entry.Attribute)",
                "created": "Created Policy: 1",
                "status": "Failed",
                "name": "Copacabana"
            }
        ],
        "errorMsg": "Migration of all accounts failed",
        "code": "400",
        "created": "Created Policy: 1",
        "msg": "Bad Request",
        "status": "Failed"
    }
}]]></parameter>
                </Script>
            </ContainerDF>
            <ThreadOptions/>
            <Operations/>
            <InitParams>
                <Schema name="AssemblyLineInitParams"/>
            </InitParams>
        </AssemblyLine>
        <AssemblyLine name="z_sendEmail">
            <ModTime>1608642686068</ModTime>
            <Settings>
                <parameter name="ALPoolSettingsDialog">showALPoolSettings</parameter>
                <parameter name="automapattributes">false</parameter>
                <parameter name="createTombstones">false</parameter>
                <parameter name="includeGlobalPrologs">true</parameter>
                <parameter name="includePrologs"><![CDATA[MailObj
Script_Lib]]></parameter>
                <parameter name="nullBehaviorDialog">showNullBehavior</parameter>
            </Settings>
            <Hooks/>
            <CheckpointConfig/>
            <SandboxConfig/>
            <SimulationConfig>
                <SimulationStates>
                    <Component name="Set up metrics" state="Enabled"/>
                    <Component name="ePolicy2OP_define service functions" state="Enabled"/>
                    <Component name="Build Message" state="Enabled"/>
                    <Component name="Test MailObj" state="Enabled"/>
                    <Component name="MailObj tester" state="Enabled"/>
                </SimulationStates>
                <ProxySettings/>
            </SimulationConfig>
            <LogConfig/>
            <ContainerEF name="EntryFeedContainer"/>
            <ContainerDF name="DataFlowContainer">
                <ModTime>1608642686068</ModTime>
                <Script name="Set up metrics">
                    <ModTime>1606228255953</ModTime>
                    <parameter name="enabled">false</parameter>
                    <parameter name="script"><![CDATA[request = {
	epolicy: {
	    userName: "db2inst1",
	    password: "Epolicy2ibm@123",
	    hostname: "mopbzp174025.fr.dst.ibm.com",
	    port: "50000",
	    database: "POLICYL"
	  },
	accounts: [
			"ABB",
			"WHU"
			"Copacabana"
	],
	opUserEmail : "eddie.hartman@no.ibm.com",
	mappingTable : {
		"BR001": "CL02-ST-CBR001",
//		"XYZZY": "XX02-XX-XXX001",
		"BR002": "CL06-SR-CBR001"
	}
};

accounts = request.accounts;
ePolicy = request.epolicy;
counters = fromJson('{"Service":{"GTSTechSpec":5,"Policy":5,"SOXDocument":26},"Copacabana":{"GTSTechSpec":4,"Policy":3,"SOXDocument":18},"WHU":{"GTSTechSpec":1,"Policy":2,"SOXDocument":8}}');
errors = fromJson('{"ABB":"Unable to find Account in OpenPages: ABB","Copacabana":[],"WHU":[]}');
operation = "migrate";

migrationStart = new Date();
migrationEnd = new Date();

function inError() {
	return false;
}

function rootCause() {
	return "Unable to connect to ePolicy db";
}]]></parameter>
                </Script>
                <Script name="ePolicy2OP_define service functions">
                    <InheritFrom>/Scripts/ePolicy2OP_define service functions</InheritFrom>
                    <ModTime>1602751736245</ModTime>
                </Script>
                <Script name="Build Message">
                    <ModTime>1602751719514</ModTime>
                    <parameter name="enabled">false</parameter>
                    <parameter name="script"><![CDATA[// Send out email notification
function buildMailMessage() {
	var firstColWidth = 20;
	var nameColWidth = 20;
	if(typeof accounts == "undefined"){
		return;	
	}	

	var opNoun = (operation == "migrate") ? "Migration" : "Validation";
	var policyCnt = {};
	var accountError = {};
	var accountsInError = 0;
	
	var lines = ["<!DOCTYPE html><html><head><style>table, th, td {border: 1px solid black;border-collapse: collapse;}</style></head><body>",
				 "<h1>IBM Global GTS SR&RM - OpenPages</h1>"
				 "<hr width:100% size:20px/>",
				 "<div>Below are details of the requested ePolicy " + opNoun + " performed on " + system.formatDate(new Date(), "d-MMM-yyyy HH:mm:ss") + "</div>",
				 "<div><h2>" + opNoun + " Status:</h2></div>"];

    // First go through each Account passed in the request to see if
    // there are errors for that Account
    for (var i in accounts) {
	    var accountName = accounts[i];
	    if ((accountName.length+1) > nameColWidth) {
	    	nameColWidth = accountName.length+1;
	    }
    
	    var useErrors = errors[accountName] || [];
	    if (!(useErrors instanceof Array)) {
		    useErrors = [useErrors];
		}
	    // If errors were found, attach them
	    if (useErrors.length > 0) {
		    accountError[accountName] = useErrors[0];
		    accountsInError++;
	    }
	}
	
	// Now start creating mail body lines

	lines.push("<table>")
	var lineCnt = 0;
	lines.push('<tr><td style="color:white;background-color:gray">ePolicy Instance</td><td>' + ePolicy.hostname + "</td></tr>");
	
	if (inError()) {
		lines.push('<tr><td style="color:white;background-color:gray">Status</td><td>' + opNoun + " failed with internal error</td></tr>");
		lines.push('<tr><td style="color:white;background-color:gray">Detailed Status</td><td>' + rootCause() + "</td></tr>");
	} else {
		if (accountsInError == 0) {
			lines.push('<tr><td style="color:white;background-color:gray">Status</td><td>' + opNoun + " Successful</td></tr>");
			lines.push('<tr><td style="color:white;background-color:gray">Detailed Status</td><td>' + accounts.length + " Accounts " + operation + "d successfully</td></tr>");
		} else {
			lines.push('<tr><td style="color:white;background-color:gray">Status</td><td>' + opNoun + " Failed for " + accountsInError + " Accounts</td></tr>");
			lines.push('<tr><td style="color:white;background-color:gray">Detailed Status</td><td>'+ "Some accounts fail to " + operation + "<br/>"
						+ "Correct the issues identified in the Account Details below and resubmit the " + opNoun + " request</td></tr>");
		}	
	}
	
	
	lines.push('<tr><td style="color:white;background-color:gray">Accounts in Request</td><td>' + accounts.length + "</td></tr>");
	lines.push('<tr><td style="color:white;background-color:gray">Migration Start</td><td>' + system.formatDate(migrationStart, "dd-MMM-yyyy HH:mm:ss") + "</td></tr>");
	lines.push('<tr><td style="color:white;background-color:gray">Migration End</td><td>' + system.formatDate(migrationEnd, "dd-MMM-yyyy HH:mm:ss") + "<td></tr>");
	lines.push("</table>");

	lines.push("<div><h2>Account Details:</h2></div>");

	lines.push("<table>");	
	lines.push('<tr><td><b>Account Name</b></td><td><b>Details</b></td></tr>');
	for (var i in accounts) {
		var accountName = accounts[i];
		if (inError()) {
			var details = accountError[accountName] || opNoun + " failed due to error listed above";
		} else {
			var details = accountError[accountName] || opNoun + " successful";
		}
		if (inError() || (accountError[accountName] && accountError[accountName].length > 0)) {
			lines.push('<tr><td style="color:red">' + accountName + "</td><td>" + details + "</td></tr>");
		} else {
			lines.push('<tr><td>' + accountName + "</td><td>" + details + "</td></tr>");
		}
	}
	lines.push("</table>");
	
	lines.push("<br/><br/>")
	lines.push('<div>For more information on GTS Global ITRM Process and OpenPages implementation refer to <a href="https://w3-connections.ibm.com/wikis/home?lang=en#!/wiki/Wf49a2ed8f3ed_49c2_bc11_b9e51af1f556/page/Welcome%20to%20OpenPages">ITRM OpenPages wiki</a></div>');
	lines.push("<hr width:100% size:10/>");
	lines.push('<div style="color:white;background-color:black">This email is auto generated by IBM OpenPages GRC Platform. Have a question? Click <a href="mailto://itrmop@us.ibm.com">here</a> to write to us.</div>')

	lines.push("</body></html>")

	log("\n" + lines.join("\n") + "\n");

	return lines.join("");
}]]></parameter>
                </Script>
                <Script name="Test MailObj">
                    <ModTime>1606228305885</ModTime>
                    <parameter name="enabled">false</parameter>
                    <parameter name="script"><![CDATA[// The argument 'args' can hold the following properties:
//		o hostname 	- SMTP hostname
//		o port		- SMTP port (default is 25)
//		o ssl		- true/false if SSL is enabled (default = true)
//		o username	- username credential for SMTP server
//		o password 	- password credential for SMTP server
mail = new MailObj({
	hostname: "smtp.gmail.com",
	port: 465,
	ssl: true,
	username: "eddiehartman@gmail.com",
	password: "fadiheowgawprnac"	
});

mail.send({
	to: "eddie.hartman@gmail.com", 
	from: "tdi@ibm.com", 
	subject: "File test", 
//	attachment: "/opt/IBM/TDI/V7.2/docs/api/index.html",
//	body: "/opt/IBM/TDI/V7.2/docs/api/index.html",
	body: buildMailMessage(),
	contentType: "text/html"
});]]></parameter>
                </Script>
                <Script name="MailObj tester">
                    <ModTime>1608642686068</ModTime>
                    <parameter name="script"><![CDATA[// The argument 'args' can hold the following properties:
//		o hostname 	- SMTP hostname
//		o port		- SMTP port (default is 25)
//		o ssl		- true/false if SSL is enabled (default = true)
//		o username	- username credential for SMTP server
//		o password 	- password credential for SMTP server

mail = new MailObj({
	hostname: system.getTDIProperty("hostname"),
	port: system.getTDIProperty("port"),
	ssl: true,
	username: system.getTDIProperty("username"),
	password: system.getTDIProperty("password")	
});

/*
mail = new MailObj({
	hostname: "smtp.gmail.com",
	port: 465,
	ssl: true,
	username: "eddiehartman@gmail.com",
	password: "fadiheowgawprnac"	
});
*/

mail.send({
	to: "eddiehartman@gmail.com", 
	from: "tdi@ibm.com", 
	subject: "File test", 
//	attachment: "/opt/IBM/TDI/V7.2/docs/api/index.html",
//	body: "/opt/IBM/TDI/V7.2/docs/api/index.html",
	body: "<html><head><title>SendEmail Test</title></head><body><h1>Successfull!</h1></body></html>",
	contentType: "text/html"
});]]></parameter>
                </Script>
            </ContainerDF>
            <ThreadOptions/>
            <Operations/>
            <InitParams>
                <Schema name="AssemblyLineInitParams"/>
            </InitParams>
        </AssemblyLine>
        <AssemblyLine name="z_testCountingRunningALs">
            <ModTime>1607976464655</ModTime>
            <Settings>
                <parameter name="ALPoolSettingsDialog">showALPoolSettings</parameter>
                <parameter name="automapattributes">false</parameter>
                <parameter name="createTombstones">false</parameter>
                <parameter name="includeGlobalPrologs">true</parameter>
                <parameter name="includePrologs"><![CDATA[MailObj
Mapper
OpenPagesObj
Script_Lib
Timer
ePolicyObj]]></parameter>
                <parameter name="nullBehaviorDialog">showNullBehavior</parameter>
            </Settings>
            <Hooks/>
            <CheckpointConfig/>
            <SandboxConfig/>
            <SimulationConfig>
                <SimulationStates>
                    <Component name="do it" state="Enabled"/>
                </SimulationStates>
                <ProxySettings/>
            </SimulationConfig>
            <LogConfig/>
            <ContainerEF name="EntryFeedContainer"/>
            <ContainerDF name="DataFlowContainer">
                <ModTime>1607976464655</ModTime>
                <Script name="do it">
                    <ModTime>1607976464655</ModTime>
                    <parameter name="script"><![CDATA[als = session.getAssemblyLines();
log(als.length)]]></parameter>
                </Script>
            </ContainerDF>
            <ThreadOptions/>
            <Operations/>
            <InitParams>
                <Schema name="AssemblyLineInitParams"/>
            </InitParams>
        </AssemblyLine>
        <AssemblyLine name="z_testGettingFileTimestamp">
            <ModTime>1607681527982</ModTime>
            <Settings>
                <parameter name="ALPoolSettingsDialog">showALPoolSettings</parameter>
                <parameter name="automapattributes">false</parameter>
                <parameter name="createTombstones">false</parameter>
                <parameter name="includeGlobalPrologs">true</parameter>
                <parameter name="includePrologs"><![CDATA[MailObj
Mapper
OpenPagesObj
Script_Lib
Timer
ePolicyObj]]></parameter>
                <parameter name="nullBehaviorDialog">showNullBehavior</parameter>
            </Settings>
            <Hooks/>
            <CheckpointConfig/>
            <SandboxConfig/>
            <SimulationConfig>
                <SimulationStates>
                    <Component name="get file timestamp" state="Enabled"/>
                </SimulationStates>
                <ProxySettings/>
            </SimulationConfig>
            <LogConfig/>
            <ContainerEF name="EntryFeedContainer"/>
            <ContainerDF name="DataFlowContainer">
                <ModTime>1607681527982</ModTime>
                <Script name="get file timestamp">
                    <ModTime>1607681527982</ModTime>
                    <parameter name="script"><![CDATA[file = java.nio.file.Paths.get("POC_MVP/POC_MVP.xml");

attr = java.nio.file.Files.readAttributes(file, java.nio.file.attribute.BasicFileAttributes);

log(attr.lastModifiedTime())]]></parameter>
                </Script>
            </ContainerDF>
            <ThreadOptions/>
            <Operations/>
            <InitParams>
                <Schema name="AssemblyLineInitParams"/>
            </InitParams>
        </AssemblyLine>
        <AssemblyLine name="z_testReadingVariousDocTypes">
            <ModTime>1606925282390</ModTime>
            <Settings>
                <parameter name="ALPoolSettingsDialog">showALPoolSettings</parameter>
                <parameter name="automapattributes">false</parameter>
                <parameter name="createTombstones">false</parameter>
                <parameter name="includeGlobalPrologs">true</parameter>
                <parameter name="includePrologs"><![CDATA[OpenPagesObj
Script_Lib
ePolicyObj]]></parameter>
                <parameter name="nullBehaviorDialog">showNullBehavior</parameter>
            </Settings>
            <Hooks/>
            <CheckpointConfig/>
            <SandboxConfig/>
            <SimulationConfig>
                <SimulationStates>
                    <Component name="test" state="Enabled"/>
                    <Component name="Java code" state="Enabled"/>
                </SimulationStates>
                <ProxySettings/>
            </SimulationConfig>
            <LogConfig/>
            <ContainerEF name="EntryFeedContainer"/>
            <ContainerDF name="DataFlowContainer">
                <ModTime>1606925282390</ModTime>
                <Script name="test">
                    <ModTime>1606925282390</ModTime>
                    <parameter name="script"><![CDATA[folder = "/media/psf/Home/Downloads";
filenames = [
	"()Customer_Security_Document_V1.3__CSD_Japan_Japan.docx",
	"Customer Security Document_V2.1.1__CSD_HBT_2017-06-21-12.56.41.765328.docx",
	"Customer Security Document__CSD_CBANA_2014-10-09-18.28.05.614806.docx"
]

headerStyles = {
	TOC1: true,
	Header1: true,
	11: true
}

for (i in filenames) {
	filename = filenames[i];
	log("\n--------------------- " + filename);
	filepath = folder + "/" + filename;
	
	var fis = new java.io.FileInputStream(filepath);
	var doc = new org.apache.poi.xwpf.usermodel.XWPFDocument(org.apache.poi.openxml4j.opc.OPCPackage.open(fis));
	var filepath = folder + "/" + filename;
		
	var foundIt = false;
	var tables = doc.getTables();
	for (var i = tables.length-1; i >= 0 && !foundIt; i--) {
		table = tables[i];
		if (!table) {
			continue;
		}
		var rows = table.getRows();
		if (rows.length < 2) {
			continue;
		}
		for (var j = 0; j < 5 && j < rows.length && !foundIt; j++) {
			var cells = rows[j].getTableCells();
			if (cells.length < 2) {
				continue;
			}
			var txt =  cells[1].getText();
			//log("Checking " + txt);
			var val = txt.match(/([\d.a-zA-Z]+[.][\d.a-zA-Z]+)/);
			if (val != null) {
				log("Found it: " + val[1]);
				//foundIt = true;
				//break;
			}
		}
	}	


	fis.close();
}]]></parameter>
                </Script>
                <Script name="Java code">
                    <ModTime>1606829825297</ModTime>
                    <parameter name="enabled">false</parameter>
                    <parameter name="script"><![CDATA[/*
import java.io.*; 
import java.util.ArrayList; 
import java.util.StringTokenizer; 
import java.util.regex.Matcher; 
import java.util.regex.Pattern; 
import org.apache.poi.POIOLE2TextExtractor; 
import org.apache.poi.extractor.ExtractorFactory; 
import org.apache.poi.hpsf.*; 
import org.apache.poi.hwpf.HWPFDocument; 
import org.apache.poi.hwpf.extractor.WordExtractor; 
import org.apache.poi.hwpf.usermodel.Paragraph; 
import org.apache.poi.hwpf.usermodel.Range; 
import org.apache.poi.hwpf.usermodel.Table; 
import org.apache.poi.hwpf.usermodel.TableCell; 
import org.apache.poi.hwpf.usermodel.TableRow; 
import org.apache.poi.poifs.filesystem.POIFSFileSystem; 

import excel.Workbook; 
  
public class readwordIMP 
{ 
        public readwordIMP() 
        { 
                 Table table = null; 
                 TableRow  row = null; 
                 String filesname = "D:\\Akhil\\TEMP\\maths\\limits and contin\\Limits - 1 - Assignment Info\\IITPU1_M_11_1_M.doc"; 

                 ArrayList<String> al=new ArrayList<String>(); 
                try 
                { 
                  POIFSFileSystem fs = new POIFSFileSystem(new FileInputStream(filesname));                 
                  HWPFDocument doc = new HWPFDocument(fs);         
                  String character; 
                  Range range = doc.getRange(); 
                  
                  Paragraph tablePar; 
                  tablePar = range.getParagraph(0); 
                
               if (isInTable()) { 
                     table = range.getTable(tablePar); 
                  
                    for (int rowIdx=4; rowIdx<table.numRows(); rowIdx++) 
                    { 
                    row = table.getRow(rowIdx);     
                        System.out.println("row "+(rowIdx+1)+"qwwq"+row.numCells()); 
                        
 ****               Paragraph   tab=row.getParagraph(0); 
                      Table t=row.getTable(tab); 
                      System.out.println("number of rows "+t.NumRows());           ************** 


                  //      for (int colIdx=0; colIdx<row.numCells(); colIdx++) 
                    //    { 
                      //       TableCell cell = row.getCell(colIdx); 
                        //     character=cell.getParagraph(0).text(); 

                              
          
                          //   character=character.substring(0, character.length()-1);                     

                            // al.add(character); 
                            
                        //} 
                      }         
                } 
                
          } catch(Exception e) { 
                    e.printStackTrace(); 
                } 
        } 
        private Paragraph Paragraph(int i) { 
                // TODO Auto-generated method stub 
                return null; 
        } 
        private boolean isInTable() { 
                // TODO Auto-generated method stub 
                return true; 
        } 
        public static void main( String[] args ) 
        { 
                readwordIMP t=new readwordIMP(); 
    } 
}
 * 
 */]]></parameter>
                </Script>
            </ContainerDF>
            <ThreadOptions/>
            <Operations/>
            <InitParams>
                <Schema name="AssemblyLineInitParams"/>
            </InitParams>
        </AssemblyLine>
    </Folder>
    <Folder name="Connectors">
        <Connector name="CSVReader">
            <InheritFrom>system:/Connectors/ibmdi.FileSystem</InheritFrom>
            <ModTime>1600853952677</ModTime>
            <ConnectorMode>Iterator</ConnectorMode>
            <ConnectorState>Enabled</ConnectorState>
            <Configuration>
                <InheritFrom>[parent]</InheritFrom>
                <ModTime>1600853440984</ModTime>
            </Configuration>
            <Parser>
                <InheritFrom>system:/Parsers/ibmdi.CSV</InheritFrom>
                <ModTime>1600853952677</ModTime>
                <parameter name="csvColumnSeparator">,</parameter>
            </Parser>
            <AttributeMap name="Input">
                <InheritFrom>[parent]</InheritFrom>
                <ModTime>1600853440984</ModTime>
            </AttributeMap>
            <AttributeMap name="Output">
                <InheritFrom>[parent]</InheritFrom>
                <ModTime>1600853440984</ModTime>
            </AttributeMap>
            <DeltaSettings>
                <ModTime>1600853452612</ModTime>
                <WhenToCommit>After every database operation</WhenToCommit>
                <RowLocking>SERIALIZABLE</RowLocking>
                <ChangeDetectionMode>DETECT_ALL</ChangeDetectionMode>
            </DeltaSettings>
            <Schema name="Input">
                <InheritFrom>[parent]</InheritFrom>
                <ModTime>1600853440984</ModTime>
            </Schema>
            <Schema name="Output">
                <InheritFrom>[parent]</InheritFrom>
                <ModTime>1600853440984</ModTime>
            </Schema>
            <LinkCriteria>
                <InheritFrom>[parent]</InheritFrom>
                <ModTime>1600853440984</ModTime>
            </LinkCriteria>
            <Hooks>
                <InheritFrom>[parent]</InheritFrom>
                <ModTime>1600853440984</ModTime>
            </Hooks>
            <CheckpointConfig/>
            <SandboxConfig/>
            <Reconnect>
                <InheritFrom>[parent]</InheritFrom>
                <ReconnectRules/>
            </Reconnect>
            <Operations/>
            <PoolDefinition>
                <InheritFrom>[parent]</InheritFrom>
                <ModTime>1600853452769</ModTime>
                <Enabled>false</Enabled>
                <MinPoolSize>0</MinPoolSize>
                <MaxPoolSize>0</MaxPoolSize>
                <PurgeInterval>0</PurgeInterval>
                <InitializeAttempts>1</InitializeAttempts>
                <InitializeSleepInterval>0</InitializeSleepInterval>
            </PoolDefinition>
            <PoolInstance/>
        </Connector>
        <Connector name="HTTPClientConnector">
            <InheritFrom>system:/Connectors/ibmdi.HTTPClient</InheritFrom>
            <ModTime>1604060654927</ModTime>
            <ConnectorMode>AddOnly</ConnectorMode>
            <ConnectorState>Enabled</ConnectorState>
            <Configuration>
                <InheritFrom>[parent]</InheritFrom>
                <ModTime>1604060654927</ModTime>
                <parameter name="url">https://gtsus-uat01.op.ibmcloud.com:8042</parameter>
            </Configuration>
            <Parser>
                <InheritFrom>[parent]</InheritFrom>
                <ModTime>1604060145276</ModTime>
            </Parser>
            <AttributeMap name="Input">
                <InheritFrom>[parent]</InheritFrom>
                <ModTime>1604060145276</ModTime>
            </AttributeMap>
            <AttributeMap name="Output">
                <InheritFrom>[parent]</InheritFrom>
                <ModTime>1604060145276</ModTime>
            </AttributeMap>
            <DeltaSettings/>
            <Schema name="Input">
                <InheritFrom>[parent]</InheritFrom>
                <ModTime>1604060145276</ModTime>
            </Schema>
            <Schema name="Output">
                <InheritFrom>[parent]</InheritFrom>
                <ModTime>1604060145276</ModTime>
            </Schema>
            <LinkCriteria>
                <InheritFrom>[parent]</InheritFrom>
                <ModTime>1604060145276</ModTime>
            </LinkCriteria>
            <Hooks>
                <InheritFrom>[parent]</InheritFrom>
                <ModTime>1604060145276</ModTime>
            </Hooks>
            <CheckpointConfig/>
            <SandboxConfig/>
            <Reconnect>
                <InheritFrom>[parent]</InheritFrom>
                <ReconnectRules/>
            </Reconnect>
            <Operations/>
            <PoolDefinition>
                <InheritFrom>[parent]</InheritFrom>
                <ModTime>1604060149732</ModTime>
                <Enabled>false</Enabled>
                <MinPoolSize>0</MinPoolSize>
                <MaxPoolSize>0</MaxPoolSize>
                <PurgeInterval>0</PurgeInterval>
                <InitializeAttempts>1</InitializeAttempts>
                <InitializeSleepInterval>0</InitializeSleepInterval>
            </PoolDefinition>
            <PoolInstance/>
        </Connector>
        <Connector name="OpenPages Connector">
            <InheritFrom>system:/Connectors/ibmdi.ScriptConnector</InheritFrom>
            <ModTime>1618399270508</ModTime>
            <ConnectorMode>Lookup</ConnectorMode>
            <ConnectorState>Enabled</ConnectorState>
            <Configuration>
                <UserComment>fixing</UserComment>
                <InheritFrom>[parent]</InheritFrom>
                <ModTime>1618399270508</ModTime>
                <parameter name="$form$"><![CDATA[<?xml version="1.0" encoding="UTF-8"?><MetamergeConfig Cycle="261" UUID="a8ad3eb7-a05b-4a69-b5c2-397f536ac120" created="Sun Jun 01 21:17:26 CEST 2014" createdBy="Administrator" main="Form" modified="Sat Nov 14 16:43:20 CET 2020" modifiedBy="eddie" version="7.1.1">
    <Form name="Form">
        <ModTime>1605368530174</ModTime>
        <FormItemNames>
            <ListItem>$GLOBAL.script</ListItem>
            <ListItem>password</ListItem>
            <ListItem>deBug</ListItem>
            <ListItem>url</ListItem>
            <ListItem>username</ListItem>
            <ListItem>object</ListItem>
            <ListItem>query</ListItem>
            <ListItem>root</ListItem>
            <ListItem>parentType</ListItem>
            <ListItem>parentLoc</ListItem>
            <ListItem>smtpHost</ListItem>
            <ListItem>smtpPort</ListItem>
            <ListItem>mailTo</ListItem>
            <ListItem>shareSchema</ListItem>
        </FormItemNames>
        <FormSectionNames>
            <ListItem>General</ListItem>
            <ListItem>Advanced</ListItem>
            <ListItem>Shared</ListItem>
        </FormSectionNames>
        <FormItem name="Parent Object Type"/>
        <FormItem name="allowOrphans">
            <ModTime>1433528573989</ModTime>
            <parameter name="description">When set, allow orphaned objects to be created.</parameter>
            <parameter name="label">Allow Orphans</parameter>
            <parameter name="syntax">boolean</parameter>
        </FormItem>
        <FormItem name="deBug">
            <ModTime>1431552570823</ModTime>
            <parameter name="description">Enable this to provide debugging messages in the log output and console.</parameter>
            <parameter name="label">Debug log</parameter>
            <parameter name="syntax">boolean</parameter>
        </FormItem>
        <FormItem name="mailTo">
            <ModTime>1436821990224</ModTime>
            <parameter name="description">The email address to use for sending email notifications for errors that can occur in the assembly line connectors.</parameter>
            <parameter name="label">Mail To</parameter>
        </FormItem>
        <FormItem name="object">
            <ModTime>1432753097249</ModTime>
            <Values>
                <ListItem>Incident</ListItem>
                <ListItem>Asset</ListItem>
            </Values>
            <parameter name="Required">true</parameter>
            <parameter name="description">The type of object to work with. May be overridden for add operation by mapping out an attribute named '$grcObjectType'.</parameter>
            <parameter name="label">GRC Object</parameter>
            <parameter name="script">getTypes</parameter>
            <parameter name="scriptLabel">Query</parameter>
            <parameter name="syntax">dropedit</parameter>
        </FormItem>
        <FormItem name="parentLoc">
            <ModTime>1433445455394</ModTime>
            <parameter name="Required">false</parameter>
            <parameter name="description">The relative location of the GRC parent object to use as the parent for all newly created incidents.  Example: /EMEA/Audits</parameter>
            <parameter name="label">Parent Location</parameter>
        </FormItem>
        <FormItem name="parentType">
            <ModTime>1433771469910</ModTime>
            <parameter name="Required">false</parameter>
            <parameter name="description">The GRC object type of the parent object to use for all newly created incidents.</parameter>
            <parameter name="label">Parent Object Type</parameter>
        </FormItem>
        <FormItem name="password">
            <ModTime>1432753086954</ModTime>
            <parameter name="Required">true</parameter>
            <parameter name="description">The password for the OpenPages user id.</parameter>
            <parameter name="label">Password</parameter>
            <parameter name="noLabel">false</parameter>
            <parameter name="syntax">password</parameter>
        </FormItem>
        <FormItem name="query">
            <ModTime>1435339779622</ModTime>
            <parameter name="description">The GRC query to apply for iteration.  If empty then SELECT * FROM [&lt;object&gt;] is used.</parameter>
            <parameter name="label">Query</parameter>
            <parameter name="modes"/>
            <parameter name="syntax">string</parameter>
        </FormItem>
        <FormItem name="root">
            <ModTime>1432753221316</ModTime>
            <parameter name="Required">true</parameter>
            <parameter name="description">The root of the OpenPages REST API. This is by default /grc/api .</parameter>
            <parameter name="label">URI Root</parameter>
            <parameter name="noLabel">false</parameter>
        </FormItem>
        <FormItem name="shareSchema">
            <ModTime>1605368530174</ModTime>
            <parameter name="description">Optimization that only works if all instances point to the same server</parameter>
            <parameter name="label">Share Schema</parameter>
            <parameter name="syntax">boolean</parameter>
        </FormItem>
        <FormItem name="smtpHost">
            <ModTime>1436823079339</ModTime>
            <parameter name="description">The SMTP host to use for sending email notifications for errors that can occur in the assembly line connectors.</parameter>
            <parameter name="label">SMTP Host</parameter>
        </FormItem>
        <FormItem name="smtpPort">
            <ModTime>1436821942625</ModTime>
            <parameter name="description">The SMTP port to use for sending email notifications to for errors that can occur in the assembly line connectors. Defaulted to 25.</parameter>
            <parameter name="label">SMTP Port</parameter>
        </FormItem>
        <FormItem name="url">
            <ModTime>1431455638910</ModTime>
            <parameter name="Required">true</parameter>
            <parameter name="description">The URL to the OpenPages system.  For example: http://openpages.acme.com:10108</parameter>
            <parameter name="label">URL</parameter>
        </FormItem>
        <FormItem name="username">
            <ModTime>1432753093706</ModTime>
            <parameter name="Required">true</parameter>
            <parameter name="description">The OpenPages user id to authenticate with.</parameter>
            <parameter name="label">User id</parameter>
        </FormItem>
        <FormSection name="Advanced">
            <FormSectionNames>
                <ListItem>root</ListItem>
                <ListItem>query</ListItem>
                <ListItem>$GLOBAL.script</ListItem>
                <ListItem>shareSchema</ListItem>
            </FormSectionNames>
            <parameter name="initiallyExpanded">false</parameter>
            <parameter name="title">Advanced</parameter>
        </FormSection>
        <FormSection name="General">
            <FormSectionNames>
                <ListItem>url</ListItem>
                <ListItem>username</ListItem>
                <ListItem>password</ListItem>
                <ListItem>object</ListItem>
                <ListItem>parentType</ListItem>
                <ListItem>parentLoc</ListItem>
                <ListItem>$GLOBAL.userComment</ListItem>
                <ListItem>deBug</ListItem>
            </FormSectionNames>
        </FormSection>
        <FormSection name="Shared">
            <ModTime>1436821851376</ModTime>
            <FormSectionNames>
                <ListItem>smtpHost</ListItem>
                <ListItem>smtpPort</ListItem>
                <ListItem>mailTo</ListItem>
            </FormSectionNames>
            <parameter name="initiallyExpanded">false</parameter>
            <parameter name="title">Shared</parameter>
        </FormSection>
        <parameter name="formevents"><![CDATA[// 20140912 1248
var params = {	url : "", 
				root : "/grc/api",
				username : "", 
				password : "",
				object : "",
				query : "",
				
				refresh : function(connector) {
					for (var pname in this) {
						if (typeof this[pname] !== "function") {
							var control = form.getControl(pname);
							if (control !== null && control.getText() != null) {
								this[pname] = control.getText();
							}	
						}	
					}

					this.root = "/grc/api";

					if (!this.url.toLowerCase().endsWith(this.root.toLowerCase())) {
						this.url = this.url + this.fixPath(this.root);
					}	
//					form.alert("this.url: " + this.url + "\nthis.root: " + this.root)
				},
				
				apply : function(http) {
					for (var pname in this) {
						if (typeof this[pname] !== "function") {
							http.setParam(pname, this[pname]);
						}	
					}
				},

				fixPath : function(path) {
					if (!path.startsWith("/")) {
						path = "/" + path;
					}
					return path;
				}
			}


function getCertificate () {
	form.setWaitCursor();
	try {
		var msg = com.ibm.di.security.GetSSLCertificate.installCertificateFrom(url, 443);
	} finally {
		form.setNormalCursor();
	}
	form.alert(msg);
}

function getTypes() {
	params.refresh();
	params.apply(http);
	
	form.getClass();
	var combo = form.getControl("object");
	combo.removeAll();

	var reply = makeRequest({"verb" : "GET", 
							 "url" : "/types", 
							 "ctype" : "application/json", 
							 "where" : "selectEnries"});

	if (typeof reply.length !== "undefined") {						 
		var arr = new java.util.ArrayList();

		arr.add("file (word, excel, etc)");
		for (var i = 0; i < reply.length; i++) {
			arr.add(reply[i].name);
		}
			
		arr = arr.toArray();
		java.util.Arrays.sort(arr);
	
		for (var a in arr) {
			combo.add(a);
		}	
		
		combo.select(0);
	}	
}

function makeRequest(args) {
	var verb = args.verb;		// HTTP method, e.g. GET, POST, PUT, ...
	var url = args.url;		// url for the request. May be partial (only the path & query string params)
	var body = args.body;		// HTTP body to be passed for the request
	var ctype = args.ctype;	// Content-Type of the HTTP body
	var where = args.where;	// where this method is called from - for debugging purposes

	// set default values for missing params/properties
	if (verb == null) { verb = "GET"; } 
	if (url == null) { url = ""; } 
	if (ctype == null) { ctype = "application/json"; }
	if (where == null) { where = ""; } 

	// prepend the base url if not found in the url passed to the function
	if (url.toLowerCase().indexOf(params.url.toLowerCase()) < 0) {
		url = params.url + params.fixPath(url);
	}
	
//	form.alert("url: " + url + "\n\n    params.url: " + params.url);
	
	requestEntry.removeAllAttributes();
	
	if (typeof body !== "undefined" && body !== null && body.trim().length > 0) {
		requestEntry["http.body"] = body;
	}
	
	// set Connector parameters
	http.setParam("method", verb.toUpperCase());
	http.setParam("url", url);

	// prepare the request Entry (used for POST/PUT calls)
	requestEntry["http.Content-Type"] = ctype;
	requestEntry["http.Accept"] = "application/json";
	requestEntry["http.Connection"] = "keep-alive";
	requestEntry["http.remote_user"] = params.username;
	requestEntry["http.remote_pass"] = params.password;

// commented out for now
//
//	requestEntry["http.Accept-Encoding"] = "gzip, deflate";
//	requestEntry["http.Accept-Language"] = "en-US,en;q=0.5";
//	requestEntry["http.User-Agent"] = "IBM Security Directory Integrator";
//	requestEntry["http.Authorization"] = "BASIC " + system.base64Encode(String(user + ":" + password).getBytes());
	
	// add any cookies received on previous calls
	if (cookies.size() > 0) {
//		requestEntry["X-CouchDB-WWW-Authenticate"] = "Cookie"; // TODO
		requestEntry.merge(cookies);
	}	

	// if Detailed Log is enabled then write request details to the log
	if (deBug) {
		logDetails({"msg" : message["Request to"] + " OpenPages", 
					"obj" : requestEntry, 
					"url" : url, 
					"verb" : verb, 
					"ctype" : ctype, 
					"where" : where});
	}

	var retry = 0;
	var maxRetry = 2;
	var retEntry = null;
	
	// this loop makes the actual request. If an SSL handshake error occurs, attempt to retrieve
	// and import the client certificate and inform the user that TDI must be restarted.
	//
	do {
		try {	
			retEntry = http.queryReply(requestEntry);
			
//			form.alert(retEntry.toString())
		} catch (ex) {
			if (ex instanceof javax.net.ssl.SSLHandshakeException) {
				if (retry == 0) {
					getCertificate();
				} else {	
					throwException(message["You must restart the SDI server in order for the imported certificate to be trusted."])
				}
			} else {
				throw ex;
			}	
		}
		
		retry++;
	} while (retEntry === null && retry < maxRetry);
	
	// if Detailed Log is enabled, write reply details to the log
	if (deBug) {
		logDetails({"msg" : message["Response from"] + " OpenPages", 
				    "entry" : retEntry});
	}
	
	verifyResponse(retEntry);
	
	// parse the reply from OpenPages
	var reply = parseReply(retEntry);
	
	return reply;
}

function throwException(msg) {
	throw new java.lang.IllegalArgumentException(msg);
}

function logmsg(lvl, msg) {
	if (typeof lvl === "undefined") { lvl = ""; } 
	if (typeof msg === "undefined") {
		msg = lvl;
		lvl = "INFO";
	}
	
	if (deBug) {
		java.lang.System.out.println(msg);
	}
		
	try {
		connector.logmsg(lvl, msg);
	} catch (ex) {
		main.logmsg(lvl, msg);
	}	
}

function getParam(pname, required) {
	if (typeof required === "undefined") { required = true; }
	var ctrl = form.getControl(pname);
	if (ctrl == null && required) {
		throwException(message["Required parameter not set"] + ": " + pname);
	}
	
	pval = ctrl.getText();
	
	if (pval === null && required) {
		throwException(message["Required parameter not set"] + ": " + pname);
	} 
	
	return pval;
}

function parseReply(replyEntry) {
	var body = replyEntry.getString("http.bodyAsString");
	
	try {
//		if (deBug) logmsg("DEBUG", "body: " + body);
		var jobj = fromJson(body);
		
		// save any cookies passed back	
		var setCookie = replyEntry.getAttribute("http.Set-Cookie");
		if (setCookie !== null) {
			for (var i = 0; i < setCookie.size(); i++) {
				var thisCookie = setCookie.getValue(i);
				var p = thisCookie.indexOf("=");
				if (p > 0) {
					cookies["http." + thisCookie.substring(0,p)] = thisCookie.substring(p+1);
				}
			}	
		}
	} catch (ex) {
		throwException(message["Unable to parse JSON return from"] + " OpenPages - " + ex);
	}	
	
	return jobj;
}

function fixUrl(params) {
	var url = params.url;
	var dbtype = params.dbtype;
	var protocolSpes = "http:";
	var auth = "";
	
	if (url.startsWith("http")) {
		var p = url.indexOf("/");
		if (p > 0) {
			protocolSpes = url.substring(0, p);
			var p2 = url.indexOf("/", p+1);
			if (p2 == (p+1)) {
				url = url.substring(p2+1);
			} else {
				throwException(message["Invalid format for URL parameter"] + ": " + url);
			}
		}
	}

	if (!url.endsWith("/")) {
		return protocolSpes + "//" + auth + url + "/";
	} else {
		return protocolSpes + "//" + auth + url;
	}
}

function logDetails(params) {
	var msg = params.msg;
	var obj = params.obj; 
	var url = params.url;
	var verb = params.verb;
	var ctype = params.ctype; 
	var where = params.where;
	
	if (msg == null) {
		msg = message["Unnamed entry"];
	}

	var s = new java.lang.StringBuffer();
	
	if (where != null) {
		s.append("\n@@@------> (" + where + ") " + msg);
	} else {
		s.append("\n---------> " + msg);
	}
	
	
	if (verb != null) { s.append("   " + verb.toUpperCase()); } 
	if (ctype != null) { s.append("   " + ctype); } 
	if (url != null) { s.append("   " + url); } 
	s.append("\n");

	if (obj != null) {
		if (obj instanceof com.ibm.di.entry.Entry) {	
			var attNames = obj.getAttributeNames();
			for (var a in attNames) {
				if (a.indexOf("http.") >= 0 && 
					!("http.bodyAsString".equalsIgnoreCase(a)
						|| "http.bodyAsBytes".equalsIgnoreCase(a)) ) {
					s += " " + a + ": " + obj[a] + "\n";
				}
			}	
		} else {
			s.append(obj.toString());
		}
	}	
	form.alert(s.toString());
}

function verifyResponse(replyEntry) {
	var respCode = replyEntry.getString("http.responseCode");
	if (!respCode.startsWith("2")) {
		throwException(message["Error from"] 
						+ " OpenPage server - code: " + respCode
						+ "  message: " + replyEntry.getString("http.responseMsg"));
	}
}

function authenticate() {
	var user = getParam("user");
	var password = getParam("password");
	var reply = makeRequest({verb : "POST", 
							 url : "_session", 
							 body : "name=" + user + "&password=" + password, 
							 ctype : "application/x-www-form-urlencoded", 
							 where : "authenticate",
							 authenticating : true});
	authenticated = true;
}]]]]><![CDATA[></parameter>
        <parameter name="formscript"><![CDATA[var message = new Array();
var message = new Array();
message["Required parameter not set"] = "Required parameter not set";
message["Response from"] = "Response from";
message["Request to"] = "Request to";
message["Error from"] = "Error from";
message["You must restart the SDI server in order for the imported certificate to be trusted."] = "You must restart the SDI server in order for the imported certificate to be trusted.";
message["Unable to parse JSON return from"] = "Unable to parse JSON return from";
message["Invalid format for URL parameter"] = "Invalid format for URL parameter";

if (typeof(system) == "undefined") {
	var c = java.lang.Class.forName("com.ibm.di.function.UserFunctions");
	system = new c;
}	

var http = system.getConnector("ibmdi.HTTPClient");
var requestEntry = system.newEntry();
var cookies = system.newEntry();
var deBug = false;
var authenticated = false;
http.initialize(null);
]]]]><![CDATA[></parameter>
        <parameter name="title">OpenPages Connector</parameter>
        <TranslationFile>NLS/idi_conn_scriptconn</TranslationFile>
    </Form>
</MetamergeConfig>]]></parameter>
                <parameter name="allowOrphans">@SUBSTITUTE{property.qradar_integration:op_allowOrphans}</parameter>
                <parameter name="object">SOXRisk</parameter>
                <parameter name="parentLoc"/>
                <parameter name="parentType"/>
                <parameter name="password">@SUBSTITUTE{property.OpenPagesAssets:op.password}</parameter>
                <parameter name="query"/>
                <parameter name="root">@SUBSTITUTE{property.OpenPagesAssets:op.uri.root}</parameter>
                <parameter name="script"><![CDATA[//////////////////////////////////////////////////////////////////////////////
//
//  Licensed Materials - Property of IBM
//
//  5725-D51
//
//  (C) Copyright IBM Corporation 2015, 2017  All Rights Reserved.
//
//  US Government Users Restricted Rights - Use, duplication or
//  disclosure restricted by GSA ADP Schedule Contract with IBM Corp.
//
//////////////////////////////////////////////////////////////////////////////
//
// OpenPages Connector
//
// Ancient history moved to bottom of script
//var version = "20200626 1608"; // make selectEntries() initialize the Connector
//var version = "20200627 1307"; // Now support SOXDocment creation - both the actual doc (attachment) and fields
//var version = "20200629 1102"; // Trying different regex for the replacement of \/ with /
//var version = "20200629 1222"; // Giving up and reverting to simple replace
//var version = "20200630 1007"; // Adding get_fielddefinitions operation to queryReply
//var version = "20200630 1340"; // Fixed refresh in params object to trim Connector param values
//var version = "20200731 2334"; // Added set_current operation to queryReply()
//var version = "20200802 1502"; // putEntry() logs out new Resource ID
//var version = "20200802 1543"; // modEntry() corrected
//var version = "20200802 2109"; // modEntry() now returns updated Entry
//var version = "20200805 2239"; // updated entryToGRCObject() to remove illegal chars from Name
//var version = "20200813 2101"; // Fixed a bug I introduced to GrcObjectToEntry()
//var version = "20200818 1348"; // Fixed a bug where log() was used instead of logmsg()
//var version = "20200818 2013"; // Added debug for putEntry()
//var version = "20200818 1710"; // EH - Removed code in entryToGrcObject() that removed extension from Name for SOXDocuments
//var version = "20200903 1639"; // Added add_parent operation to queryReply()
//var version = "20200921 1916"; // Added make_request operation to queryReply() - e.g. for calling API extension
//var version = "20200922 1339"; // Add skipSelect arg to params.ensureInitialized()
//var version = "20200924 2029"; // Fixed MULTI_VALUE_ENUM thanks to Blade!
//var version = "20200930 1759"; // parse_url uses params.port as default if none found
//var version = "20201007 1432"; // Added parse2entry to queryReply, and parsing entry for make_request
//var version = "20201012 1543"; // makeRequest now parses queries for the objectType, and $grcObjectTypeName added to entries
//var version = "20201015 2054"; // Changed modEntry to handle search passed in
//var version = "20201021 1147"; // Fixed queryReply for make_request to handle 'raw' list return from direct request (like ../associations)
//var version = "20201111 1254"; // Now encoding reply from OpenPages to UTF-8
//var version = "20201114 1644"; // Added shareSchema flag under Connection > Advanced
//var version = "20201117 1602"; // Improved thread-safety of the Connector
//var version = "20201118 2034"; // More thread-safety work
//var version = "20201201 1340"; // Now incrementing the name of SOXDocuments when it throws the 'already exists' error.
//var version = "20201203 1546"; // Corrected exception thrown by verifyResponse()
var version = "20201210 2208"; // Corrected use of log() to logmsg()

var requestEntry = system.newEntry();
var cookies = system.newEntry();
var ISOdateMask1 = "yyyy-MM-dd'T'HH:mm:ss.SSZ";
var ISOdateMask2 = "yyyy-MM-dd'T'HH:mm:ss.SSSZ";

// Messages returned by the Connector are kept in an Array and set here to make it
// simpler to localize this component later.
//
var message = [];
message["Required parameter not set"] = "Required parameter not set";
message["Response from"] = "Response from";
message["Request to"] = "Request to";
message["Error from"] = "Error from";
message["You must restart the SDI server in order for the imported certificate to be trusted."] = "You must restart the SDI server in order for the imported certificate to be trusted.";
message["Unable to parse JSON return from"] = "Unable to parse JSON return from";
message["Invalid format for URL parameter"] = "Invalid format for URL parameter";
message["No field definitions returned for GRC object type"] = "No field definitions returned for GRC object type";
message["No GRC Object types returned by OpenPages"] = "No types returned by OpenPages";
message["GRC Object type"] = "GRC Object type";
message["has no field defintion for attribute"] = "has no field defintion for attribute";
message["The following field is readOnly and cannot be written to"] = "The following field is readOnly and cannot be written to";
message["No types returned by OpenPages"] = "No types returned by OpenPages";
message["The following fields are readOnly and cannot be written"] = "The following fields are readOnly and cannot be written";
message["The following fields are required"] = "The following fields are required";
message["Unable to parse DATE_TYPE value for"] = "Unable to parse DATE_TYPE value for";

// Global variables defined here
var initialized = false;

// GRC object system fields
var grcSystemFieldNames = ["name", "description", "primaryParentId", "typeDefinitionId", "parentFolderId"];
var grcSystemFieldTypes = ["String", "String", "Integer (Id)", "Integer (Id)", "Integer (Id)"];

var schemaType = [];
schemaType["DATE_TYPE"] = "Date";
schemaType["INTEGER_TYPE"] = "Integer";
schemaType["ID_TYPE"] = "Integer (Id)";
schemaType["STRING_TYPE"] = "String (limited to 4000 characters)";
schemaType["MEDIUM_STRING_TYPE"] = "Medium size String (limited to 32000 characters)";
schemaType["LARGE_STRING_TYPE"] = "Large size String (limited to configured maximum)";
schemaType["ENUM_TYPE"] = "String";
schemaType["MULTI_VALUE_ENUM"] = "String (multi-valued)";
schemaType["CURRENCY_TYPE"] = "Number (value in default currency)";
schemaType["BOOLEAN_TYPE"] = "Boolean (true or false)";
schemaType["FLOAT_TYPE"] = "Floating point decimal";

// timer object defined in some ALs using this Connector
// var _timer = java.lang.System.getProperties().get("_timer") || {start: function() {}, stop: function() {}, timers: function() {return {} }}; 
// Mail settings - this copy here has a local copy of the values shared by all connectors in the project
var mailSettings = {
	smtpHost: "",
	smtpPort: 25,
	emailTo: "",
	notificationsSent: null
};

// Keep track of last conn Entry after a putEntry() call
var lastConn = null;

// feed properties object; cleared and used for each entry
var feedProps = {
	staticPrimaryParentId: null,
	parentType: null,
	parentLoc: null,
	derivedPrimaryParentId: null,
	currencyIsoCodes: new java.util.concurrent.ConcurrentHashMap(), // isoCode for each mapped CURRENCY_TYPE value per iteration

	clear: function() {
		this.staticPrimaryParentId = null;
		this.parentType = null;
		this.parentLoc = null;
		this.derivedPrimaryParentId = null;
		this.currencyIsoCodes.clear();
	},

	recoverPrimaryParentIdFromFeed: function(entry) {
		if (typeof entry.primaryparentType !== "undefined" && entry.primaryparentType !== null &&
			typeof entry.primaryparentLocation !== "undefined" && entry.primaryparentLocation !== null) {
			this.parentType = entry.primaryparentType.getValue();
			this.parentLoc = entry.primaryparentLocation.getValue();

			if (this.parentType !== null && this.parentType !== "" &&
				this.parentLoc !== null && this.parentLoc !== "") {
				if (params.getParentObjectType(this.parentType) !== null) {
					this.derivedPrimaryParentId = params.getParentObjectIdFromTypeAndLoc(this.parentType, this.parentLoc);
				}

				if (this.derivedPrimaryParentId === null) {
					var msg = "A primaryParentId could not be derived from the feed's parentType '" + this.parentType +
						"' and parentLocation '" + this.parentLoc + "' properties for this entry." +
						"Verify that the parentType is a legitimate parent type for an object of type '" +
						params.object + "' and that the parentLocation is correct.";
					logmsg("WARN", msg);
					sendEmailNotification(msg);
				}
			}
		}
	},

	obtainPrimaryParentIdFromFeed: function(entry) {
		var msg = "";
		var parentObjectType = null;

		if (typeof entry !== "undefined" && entry instanceof com.ibm.di.entry.Entry) {

			// First check if a valid primary parent id value was included in the feed
			if (typeof entry.primaryParentId !== "undefined" && entry.primaryParentId !== null &&
				isPrimaryParentIdValid(entry.primaryParentId.getValue())) {
				this.staticPrimaryParentId = entry.primaryParentId.getValue();
			}

			// Otherwise check if it can be derived from the feed's parentType and parentLocation values
			else if (typeof entry.parentType !== "undefined" && entry.parentType !== null &&
				typeof entry.parentLocation !== "undefined" && entry.parentLocation !== null) {
				this.parentType = entry.parentType.getValue();
				this.parentLoc = entry.parentLocation.getValue();

				if (this.parentType !== null && this.parentType !== "" &&
					this.parentLoc !== null && this.parentLoc !== "") {
					parentObjectType = params.getParentObjectType(this.parentType);

					if (parentObjectType !== null) {
						this.derivedPrimaryParentId = params.getParentObjectIdFromTypeAndLoc(this.parentType, this.parentLoc);
					}

					if (this.derivedPrimaryParentId === null) {
						msg = "A primaryParentId could not be derived from the feed's parentType '" + this.parentType +
							"' and parentLocation '" + this.parentLoc + "' properties for this entry." +
							"Verify that the parentType is a legitimate parent type for an object of type '" +
							params.object + "' and that the parentLocation is correct.";
						logmsg("WARN", msg);
						sendEmailNotification(msg);
					}
				}
			}
		}
	}
};

// parameters container object
var params = {
	url: "",
	root: "/grc/api",
	username: "",
	password: "",
	hostname: "",
	specifier: "https",
	port: 443,
	
	//
	// The grc object name, such as "Submandate" or "Mandate".  Should be set in the connector settings form.
	//
	object: "",

	//
	// The grc object id, looked up from the object name specified in the "object" property above
	//
	objectId: null,

	query: "",
	schema: null,
	defaultPrimaryParentObjectId: null, // derived from op_parentType, op_parentLoc props in connector.properties
	http: null,
	current: null,
	deBug: false,
	parentType: "", // from connector.properties file for deriving defaultPrimaryParentObjectId only
	parentLoc: "", // from connector.properties file for deriving defaultPrimaryParentObjectId only
	validPrimaryParentIds: null,
	invalidPrimaryParentIds: null,
	smtpHost: "",
	smtpPort: 25,
	mailTo: "",
	defaultCurrencyIsoCode: "",
	largeStringMaxSize: 256000,

	//
	// Resource caches that are loaded via query to OpenPages
	//
	fieldDefinitions: null,
	templates: null,
	typesById: null,
	typesByName: null,
	typeDetailsByName: null,

	//
	// Properties shared across all members of an assembly line (instance of java.lang.System.getProperties()).
	// This will be used to cache results of OP queries that will not change over the lifetime of the
	// assembly line, such as type and field definitions, preventing unnecessary reloading of common data.
	//
	properties: null,

	getHttp: function() {
		if (!this.http) {
			this.http = system.getConnector("ibmdi.HTTPClient");
			this.http.initialize(null);
		}

		return this.http;
	},

	refresh: function() {
		var paramVal;
		this.getHttp();
		for (var pname in this) {
			if (typeof this[pname] !== "function") {
				paramVal = connector.getParam(pname);
				if (paramVal != null || pname == "query") {
					if (typeof paramVal == "string") {
						paramVal = paramVal.trim();
					}
					this[pname] = paramVal;
				}
			}
		}
		
		var urlParts = this.parse_url(this.url);
		this.hostname = urlParts.hostname;
		this.port = urlParts.port;
		this.instance = this.hostname + ":" + this.port;
		this.specifier = urlParts.specifier;
//		if (!this.url.endsWith(this.root)) {

		this.shareSchema = false; // connector.getParam("shareSchema") // Disabling sharing schema

		this.url = this.fixUrl(this.url);
	},
	
	// Returns a javascript object with properties 'hostname' and 'port', as well as optionally 'specifier'
	parse_url: function(url, defaultPort) {
		defaultPort = defaultPort || params.port || 443;
	    var retObj = {
			specifier: "",
	    	hostname: "",
	        port: defaultPort,
	        path: "/"
	    };
	    var specifier = true;
		//var parts = url.match(/^(iiops?|https?|jdbc[A-Z\d:]*|ldaps?):\/\/([A-Z\d\.-]{2,})(:\d{2,})*(\/[A-Z\d\.\-\/]*)?/i)
		if (url.trim().startsWith("/")) {
			retObj.path = url;
			return retObj;
		}		
		
		// Math full URL with full protocol specifier, hostname, port and path
	    var parts = url.match(/^(iiops?|https?|jdbc[A-Z\d:]*|ldaps?):\/\/([A-Z\d\.-]{2,})(:\d{2,})*(\/[A-Z\d\.%-\/]*)?/i);

	    if (parts != null) {
            var ndx = 1;
            // See if no full URL with protocol specifier is being parse. Maybe just the path
            if (specifier) {
                retObj.specifier = parts[ndx++];
            }
            retObj.hostname = parts[ndx++];
            retObj.port = parts.length < (ndx + 1) ? defaultPort : (parts[ndx++] || defaultPort);
            retObj.path = parts.length < (ndx + 1) ? "/" : parts[ndx++];
	
	        if (typeof retObj.port == "string" && retObj.port.startsWith(":")) {
	            retObj.port = retObj.port.substring(1);
	        }
	
	        try {
	            var port = java.lang.Long.parseLong(String(retObj.port));
	        } catch (ex) {
	            port = defaultPort;
	        }

	        retObj.port = port;
	    }
	
	//    task.logmsg("--> " + url + "  -  " + toJson(retObj));
	    return retObj;
	},

	apply: function() {
		for (var pname in this) {
			if (typeof this[pname] !== "function") {
				this.getHttp().setParam(pname, this[pname]);
			}
		}

		if (this.deBug !== "true") this.deBug = false;
	},

	fixPath: function(path) {
		if (!path.startsWith("/")) {
			path = "/" + path;
		} else
		if (!path.startsWith("/grc")) {
			if (path.startsWith("/")) {
				path = this.root + path;
			} else {
				path = this.root + "/" + path;
			}	
		}
		return path;
	},
	
	fixUrl: function(url) {
		var urlParts = this.parse_url(url);

		// Fix thanks to Shikha!
		urlParts.port = urlParts.port || params.port;
		
		var usePath = this.fixPath(urlParts.path || this.path || "");
		if (usePath == "/") {
			usePath = this.root;
		} else
		if (!usePath.startsWith("/grc")) {
			usePath = this.root + usePath;
		}
		url = (urlParts.specifier || this.specifier)
				+ "://" 
				+ (urlParts.hostname || this.hostname)
				+ ":"
				+ (urlParts.port || this.port)
				+ usePath;
		return url;
	},
	
	initialize: function() {
		this.refresh();
		this.apply();

		var propsId = "_OpenPagesConnector_properties";
		var opProps = null;
		//var opProps = java.lang.System.getProperties().get(params.instance + "OP_PROPERTIES");

		if (this.properties == null) {
			//this.properties = new java.util.Properties();
			this.properties = new java.util.concurrent.ConcurrentHashMap();
		}

		// Process the SMTP/mail properties
		var hostname = java.net.InetAddress.getLocalHost().getHostName();
		mailSettings.mailSubject = "(Do Not Reply) OpenPages Connector error ";
		mailSettings.mailFrom = "SDI-Solution-on-" + hostname + "@" + hostname;
		mailSettings.notificationsSent = new java.util.HashSet();
		mailSettings.smtpHost = this.smtpHost ? this.smtpHost : "";
		mailSettings.smtpPort = this.smtpPort ? this.smtpPort : 25;
		mailSettings.mailTo = this.mailTo ? this.mailTo : "";

		// Disable mail notifications if important mailing properties were not specified
		if (mailSettings.smtpHost === "" || mailSettings.mailTo === "") {
			mailSettings.smtpHost = "";
		}

		// verify required properties are at least present from processing properties files
		if (this.url === null || this.url === "" || this.url.endsWith("/")) {
			throwException("Required property op_url must be set to a valid URL (with no trailing '/' character).");
			return null;
		}
		if (this.username === null || this.username === "") {
			throwException("Required property op_username must be set to a valid OpenPages login user name.");
			return null;
		}
		if (this.password === null || this.password === "") {
			throwException("Required property op_conn_password must be set to the password for the specified OpenPages login (op_username) property.");
			return null;
		}
		if (this.object === null || this.object === "") {
			throwException("Required property op_object must be set to a valid OpenPages object type.");
			return null;
		}

		// Ensure that if the API root was not specified that the default is used
		if (this.root === undefined || this.root === null || this.root === "null" || this.root == "") {
			this.root = "/grc/api";
		}

		if (!this.url.contains("/grc")) {
			this.url = this.fixUrl(this.url);
		}

		var objectTypeName = this.object;
		this.getHttp().initialize(null);

		this.objectId = null;

		if (objectTypeName != null) {
			var thisType = this.getTypeByIdOrName(objectTypeName);
			if (thisType != null) {
				this.objectId = thisType.id;
				logmsg("INFO", "Object is " + objectTypeName + " and object id is " + this.objectId);
			}
		}

		// Process the parent type and the parent location properties from the properties file
		// to establish the default primary parent to use when the feed does not provide a
		// static or dynamically derived primaryParentId
		this.validPrimaryParentIds = new java.util.HashSet();
		this.invalidPrimaryParentIds = new java.util.HashSet();

		// Obtain the default currency ISO code to use in case the feed does not provide one
		// when a currency amount is included.
		this.defaultCurrencyIsoCode = this.getDefaultCurrencyIsoCode();

		// Obtain the registry setting for the Large String's maximum value
		this.largeStringMaxSize = this.getLargeStringMaxValue();

		if (this.object === "Mandate" && this.parentType !== "SOXBusEntity") {
			throwException("Invalid parent type set for Mandate.  Must be set to SOXBusEntity");
		}

		// log the property values obtained from the various properties file(s)
		logmsg("INFO", "The OpenPages Connector configuration properties used for this instance are:" +
			"\n\tURL (op_url):						  " + this.url +
			"\n\tUser Id (op_username):				 " + this.username +
			"\n\tGRC Object (op_object):				" + this.object +
			"\n\tQuery (op_query):					  " + this.query +
			"\n\tParent Object Type (op_parentType):	" + this.parentType +
			"\n\tParent Object Location (op_parentLoc): " + this.parentLoc +
			"\n\tDebug log (op_deBug):				  " + this.deBug +
			"\n\tURI Root (op_root):					" + this.root
		);

		if (mailSettings.smtpHost && mailSettings.smtpHost != "" && mailSettings.mailTo && mailSettings.mailTo != "") {
			system.setJavaProperty("mail.smtp.host", mailSettings.smtpHost);
			system.setJavaProperty("mail.smtp.port", mailSettings.smtpPort);

			//TEST:
			//sendEmailNotification("This is a test email from the OP Connector.");
		}
	},

	getDefaultPrimaryParentObjectId: function(addNewObject) {
		if (!this.defaultPrimaryParentObjectId) {
			var msg;

			var defaultParentObjectType = this.getParentObjectType(this.parentType);

			if (defaultParentObjectType !== null) {
				this.defaultPrimaryParentObjectId = this.getParentObjectIdFromTypeAndLoc(this.parentType, this.parentLoc);
				if (this.defaultPrimaryParentObjectId === null && addNewObject) {
					msg = "The Parent Object Location property (op_parentLoc='" + this.parentLoc +
						"') from the properties file is not valid. Verify that op_parentType '" +
						this.parentType + "' is a legitimate parent type for object '" + this.object +
						"' and that the specified parent location is correct.";
					logmsg("WARN", msg);
					sendEmailNotification(msg);
				}
			} else 
			if (addNewObject){
				msg = "The Parent Type property (op_parentType='" + this.parentType + "') from the " +
					"properties file is not valid.";
				logmsg("WARN", msg);
				sendEmailNotification(msg);
			}

			if (addNewObject && this.defaultPrimaryParentObjectId === null) {
				msg = "The default primaryParentId derived from the Parent Type property " +
					"(op_parentType) and the Parent Location property (op_parentLoc) " +
					"from the properties file is not valid. " +
					"Unable to establish a default primaryParentId for this assembly line run.";
				logmsg("WARN", msg);
				sendEmailNotification(msg);

				this.defaultPrimaryParentObjectId = "not_found";
			}
		}

		return this.defaultPrimaryParentObjectId === "not_found" ? null : this.defaultPrimaryParentObjectId;
	},

	setCurrent: function(entry) {
		this.current = entry;
	},

	getObjectType: function(entryOrType) {
		if (typeof entryOrType === "undefined") {
			entryOrType = params.object;
		}
		var objectType = null;

		if (entryOrType instanceof com.ibm.di.entry.Entry) {
			objectType = entry.getString("$grcObjectType");
			if (objectType == null) {
				objectType = entry.getString("objectType");
			}
			if (objectType == null) {
				typeAttVal = entry.getString("typeDefinitionId");
				if (typeAttVal !== null) {
					objectType = params.getTypeByIdOrName(typeAttVal);
				}
			}
		} else
		if (typeof entryOrType == "string") {
			if (system.isValidInt(String(entryOrType))) {
				objectType = params.getTypeByIdOrName(entryOrType);
			} else {
				objectType = String(entryOrType)
			}
		}

		//if (typeof objectType == "string" && objectType.toLowerCase().startsWith("file")) {
		//	objectType = 4; // EH hardcoding 4 for file type (attachment)
		//}

		if (objectType == null || objectType.trim().length == 0) {
			objectType = params.object;
		}

		if (objectType.toLowerCase().startsWith("file")) {
			objectType = "SOXDocument";
		}

		return objectType;
	},

	getCachedTemplate: function(objectType) {
		var key = objectType.trim().toLowerCase();
		return this.templates.get(key) || this.properties.get("OP_TMPL_" + key);
	},

	setCachedTemplate: function(objectType, template) {
		var key = objectType.trim().toLowerCase();
		this.templates[key] = template;
		this.properties.put("OP_TMPL_" + key, template);
	},

	typeToTemplate: function(fieldDefObj, objectType) {
		//fieldDefs = fieldDefObj.fieldDefinitions.fieldDefinition;
		var fieldDefs = this.getFieldDefinitions(fieldDefObj.name);

		var template = {
			fields: {
				field: []
			}
		};
		var fields = template.fields.field;
		
		for (var fieldName in fieldDefs) {
			var fieldDef = fieldDefs.get(fieldName);
			if (typeof fieldDef == "object" && fieldDef.id && !fieldDef.readOnly) {
				var field = {
					id: fieldDef.id,
					name: fieldDef.name,
					dataType: fieldDef.dataType
				};
				if (field.dataType == "ENUM_TYPE") {
					field.enumValue = fieldDef.enumValues.enumValue[0];
				}
				fields.push(field);
			}
		}

		return template;
	},

	getTemplate: function(entryOrType) {
		var templateObj = null;

		if (this.templates == null) {
			this.templates = new java.util.concurrent.ConcurrentHashMap();
		}

		var objectType = this.getObjectType(entryOrType);
		var objectDef = this.getTypeByIdOrName(objectType);
		var objectId = objectDef.id;

		var template = this.getCachedTemplate(objectType);

		if (template == null || String(objectId) == "161") {
			template = new java.util.concurrent.ConcurrentHashMap();
			// Handle SOXDocument and GTSLibPolicy by creating the template from the type definition
			if (String(objectId) == "4" || String(objectId) == "161") {
				templateObj = this.typeToTemplate(objectDef, objectType);
			} else {
			if (this.deBug) logmsg("DEBUG", "Retrieving template for " + objectType);
				try {
// // _timer.start("OpenPages Connector - getTemplate()" );
					templateObj = makeRequest({
						url: "/contents/template?typeId=" + objectId,
						where: "params.getTemplate"
					});
				} catch (ex) {
					//templateObj = null;   EH - trying to build template from objectDef
					//if (this.deBug) logmsg("DEBUG", "Exception occurred; details:\n" + ex);
					templateObj = this.typeToTemplate(objectDef, objectType);
				}
// // _timer.stop("OpenPages Connector - getTemplate()" );
			}

			if (templateObj == null || templateObj.length == 0) {
				throwException(message["No template found for GRC object type"] + ": " + objectType);
				return null;
			}

			var fds = templateObj.fields.field;
			for (var i = 0; fds != null && i < fds.length; i++) {
				var fd = fds[i];
				template.put(fd.name.trim().toLowerCase(), fd);
			}

			template.put("$grcObjectType", objectType);

			this.setCachedTemplate(objectType, template);
		}

		return template;
	},

	getFieldDefinition: function(objectType, fieldName) {
		if (!fieldName) {
			fieldName = objectType;
			objectType = this.object;
		}
		var fieldDefs = this.getFieldDefinitions(objectType);
		return fieldDefs.get(fieldName.toLowerCase().trim());
	},

	getFieldDefinitions: function(entryOrType) {
		entryOrType = entryOrType || params.object;
		
		var schema = null;

		var objectType = this.getObjectType(entryOrType);
		var fieldDefs = this.getCachedFieldDefinition(objectType);

		if (fieldDefs == null) {
			fieldDefs = new java.util.concurrent.ConcurrentHashMap();

			if (this.deBug) logmsg("DEBUG", "Retrieving field definitions for " + objectType);
			try {
// _timer.start("OpenPages Connector - getFieldDefinitions()" );
				schema = makeRequest({
					url: "/types/" + objectType,
					where: "params.getFieldDefinitions"
				});
			} catch (ex) {
				schema = null;
				if (this.deBug) logmsg("DEBUG", "Exception occurred; details:\n" + ex);
			}
// _timer.stop("OpenPages Connector - getFieldDefinitions()" );

			if (schema == null || schema.fieldDefinitions == null) {
				throwException(message["No field definitions returned for GRC object type"] + ": " +
					objectType + "  RESPONSE: " + toJson(schema) +
					". A valid op_object must be specified; aborting assembly line run.");
				return null;
			}

			var fds = schema.fieldDefinitions.fieldDefinition;
			for (var i = 0; fds != null && i < fds.length; i++) {
				var fd = fds[i];
				fieldDefs.put(fd.name.trim().toLowerCase(), fd);
			}

			fieldDefs.put("$grcObjectType", objectType);

			this.setCachedFieldDefinition(objectType, fieldDefs);
		}

		return fieldDefs;
	},

	getCachedFieldDefinition: function(objectType) {
		if (objectType.toLowerCase().startsWith("file")) {
			objectType = "SOXDocument";
		}
		
		var key = objectType.trim().toLowerCase();
		
		if (!this.fieldDefinitions) {
			 //var opFieldDefs = java.lang.System.getProperties().get(params.instance + "OP_FIELDDEFINITIONS");	
			 var opFieldDefs = this.properties.get("OP_FIELDDEF");
			
			if (opFieldDefs != null) {
				this.fieldDefinitions = opFieldDefs;
			} else {
				this.fieldDefinitions = new java.util.concurrent.ConcurrentHashMap();
				return null;
			}
		}

		var fieldDef = this.properties.get("OP_FIELDDEF_" + key) 
						|| (this.fieldDefinitions == null ? null : this.fieldDefinitions.get(key));

		if (fieldDef != null) {
			return fieldDef;	
		}

		return null;		
	},


	setCachedFieldDefinition: function(objectType, fieldDef) {
		var key = objectType.trim().toLowerCase();
		if (!this.fieldDefinitions) {
			this.fieldDefinitions = new java.util.concurrent.ConcurrentHashMap();	
		}
		this.fieldDefinitions.put(key, fieldDef);
		this.properties.put("OP_FIELDDEF_" + key, fieldDef);
	},

	getTypeByIdOrName: function(objectType) {
		if (system.isValidInt(objectType)) {
			var objectDef = this.getTypeById(objectType);
		} else {
			var objectDef = this.getTypeByName(objectType);
		}
		return objectDef;
	},

	getTypeById: function(id) {
		var ids = this.getTypesById(id);
		return ids.get(id);
	},

	getTypeByName: function(type) {
		var types = this.getTypesByName(type);
		if (type.toLowerCase().startsWith("file")) {
			return 4; // EH hardcoding type 4 here for file (attachement)
		}
		return types.get(type);
	},

	getTypesByName: function() {
		if (this.typesByName != null) {
			return this.typesByName;
		}

		this.getTypesById();
		return this.typesByName;
	},

	getCachedTypes: function() {
		if (!this.typesById) {
			this.typesById = this.properties.get("OP_TypesByID");
			if (this.typesById) {
				//				this.typesByName = java.lang.System.getProperties().get("OPTypesByName");
				this.typesByName = this.properties.get("OP_TypesByName");
			}
		}

		return this.typesById;
	},

	setCachedTypes: function(typesById, typesByName) {
		this.typesById = typesById;
		this.typesByName = typesByName;
		this.properties.put("OP_TypesByID", typesById);
		this.properties.put("OP_TypesByName", typesByName);
	},

	getTypesById: function() {
		var reply = null;

		if (this.getCachedTypes()) {
			return this.typesById;
		}

		var typesById = new java.util.concurrent.ConcurrentHashMap();
		var typesByName = new java.util.concurrent.ConcurrentHashMap();

		try {
// _timer.start("OpenPages Connector - getTypesById()" );
			reply = makeRequest({
				verb: "GET",
				url: "/types",
				ctype: "application/json",
				where: "params.getTypesById"
			});
		} catch (ex) {
// _timer.stop("OpenPages Connector - getTypesById()" );
			throw ex;
			reply = null;
			if (this.deBug) logmsg("DEBUG", "Exception occurred; details:\n" + ex);
		}
// _timer.stop("OpenPages Connector - getTypesById()" );

		if (reply == null || typeof reply.length === "undefined" || typeof reply.length == 0) {
			throwException(message["No types returned by OpenPages"] + " RESPONSE: - " +
				toJson(reply) +
				".\nEnsure that the OpenPages server is running and that the op_url, op_root, " +
				"op_username and op_conn_password properties are valid.");
		}

		for (var i = 0; i < reply.length; i++) {
			typesById.put(reply[i].id, reply[i]);
			typesByName.put(reply[i].name, reply[i]);
		}

		this.setCachedTypes(typesById, typesByName);

		return this.typesById;
	},

	getCachedObjectDetails: function(objectType) {
		return this.typeDetailsByName && this.typeDetailsByName.get(objectType);
	},

	setCachedObjectDetails: function(objectType, details) {
		if (!this.typeDetailsByName) {
			this.typeDetailsByName = new java.util.concurrent.ConcurrentHashMap();
		}

		this.typeDetailsByName.put(objectType, details);
	},

	// Perform a lookup of the specified parent object type to verify that it exists.
	// Return the parent object type (as JSON), or null if the type does not exist.
	getParentObjectType: function(ptype) {
		var reply = null;

		if (!ptype || ptype === "") {
			logmsg("INFO", "No value specified for parent object type.");
			return null;
		}

		ptype = ptype.trim();

		var parentObjectTypeAsJson = this.getCachedObjectDetails(ptype);
		if (parentObjectTypeAsJson) {
			return parentObjectTypeAsJson;
		}

		if (this.deBug) logmsg("DEBUG", "Retrieving definition for parent object type " + ptype);
		try {
// _timer.start("OpenPages Connector - getParentObjectType()" );
			reply = makeRequest({
				url: "/types/" + ptype,
				where: "params.getParentObjectType"
			});

			if (reply !== null && reply.fieldDefinitions !== null) {
				parentObjectTypeAsJson = toJson(reply);

				this.setCachedObjectDetails(ptype, parentObjectTypeAsJson);
			}
		} catch (ex) {
			logmsg("WARN", "Non-fatal exception occurred while retrieving parent object type '" + ptype +
				"'; details:\n" + ex);
		}
// _timer.stop("OpenPages Connector - getParentObjectType()" );

		return parentObjectTypeAsJson;
	},

	// Given the parent type, perform a lookup to verify that it exists. Return the
	// parent object Id, or null if it does not exist. This method assumes that the
	// ptype parameter has been validated by the getParentType() function.
	getParentObjectIdFromTypeAndLoc: function(ptype, ploc) {
		var reply = null;
		var parentObjectId = null;

		if (!ptype || ptype === "") {
			logmsg("INFO", "No value specified for parent object type.");
			return null;
		}

		if (!ploc || ploc === "") {
			logmsg("INFO", "No value specified for parent object location.");
			return null;
		}

		ptype = ptype.trim();
		ploc = ploc.trim();
		ploc = this.fixPath(ploc); // ensures that the location starts with a '/'

		// Search for the parent object instance of the given ptype at the specified location.
		// There should be one and only one match if the provided location is correct.
		var queryUrl = "query?q=SELECT * FROM [" + ptype + "] WHERE [Location] LIKE '" + ploc + "'";
		if (this.deBug) logmsg("DEBUG", "Retrieving parent object with relative location: " + ploc);

		try {
// _timer.start("OpenPages Connector - getParentObjectIdFromTypeAndLoc()" );
			reply = makeRequest({
				url: queryUrl,
				where: "params.getParentObjectIdFromTypeAndLoc"
			});
			if (reply !== null && typeof reply.rows !== "undefined" && reply.rows.length === 1) {
				if (isPrimaryParentIdValid(reply.rows[0].fields.field[0].value)) {
					parentObjectId = reply.rows[0].fields.field[0].value;
				}
			}
		} catch (ex) {
			if (this.deBug) logmsg("DEBUG", "Exception occurred; details:\n" + ex);
		}
// _timer.stop("OpenPages Connector - getParentObjectIdFromTypeAndLoc()" );

		return parentObjectId;
	},

	getDefaultCurrencyIsoCode: function() {
		if (this.defaultCurrencyIsoCode) {
			return this.defaultCurrencyIsoCode;
		}

		var isoCode = this.properties.get("OP_DefaultCurrencyIsoCode");
		if (isoCode) {
			this.defaultCurrencyIsoCode = isoCode;
			return isoCode;
		}

		var reply = null;
		isoCode = "USD";

		if (this.deBug) {
			logmsg("DEBUG", "Retrieving default (base) currency ISO code...");
		}

		try {
			reply = makeRequest({
				url: "/configuration/currencies/base",
				where: "this.getDefaultCurrencyIsoCode"
			});

			if (reply !== null && reply.isoCode !== null) {
				isoCode = reply.isoCode;
			}
		} catch (ex) {
			logmsg("WARN",
				"Non-fatal exception occurred while retrieving base currency ISO code;" +
				" using 'USD'. Exception details:\n" + ex);
		}

		this.defaultCurrencyIsoCode = isoCode;
		this.properties.put("OP_DefaultCurrencyIsoCode", isoCode);

		return isoCode;
	},

	getLargeStringMaxValue: function() {
		if (this.largeStringMaxSize) {
			return this.largeStringMaxSize;
		}

		var largeStringMaxSize = this.properties.get("OP_LargeStringMaxSize");
		if (largeStringMaxSize) {
			this.largeStringMaxSize = largeStringMaxSize;
			return largeStringMaxSize;
		}

		var reply = null;
		var doubleVal = 256000;

		if (this.deBug) logmsg("DEBUG", "Retrieving Large Text maximum value from OP registry...");
		// do a GET of this: "configuration/settings/%2FOpenPages%2FPlatform%2FRepository%2FResource%2FLarge Text%2FMaximum Size"
		try {
			reply = makeRequest({
				url: "configuration/settings/%2FOpenPages%2FPlatform%2FRepository%2FResource%2FLarge Text%2FMaximum Size",
				where: "params.getLargeStringMaxValue"
			});

			if (reply != null && reply.value != null) {
				largeStringMaxSize = reply.value;

				try {
					doubleVal = java.lang.Double.parseDouble(largeStringMaxSize);
				} catch (ex) {
					logmsg("WARN", "Unable to convert Large String Maximum Value of (" + largeStringMaxSize +
						") into a number; using hard-coded value of 256000.");
					doubleVal = 256000;
				}
			} else {
				logmsg("WARN", "No response on attempt to retrieve Large String Maximum Value registry setting;" +
					" using hard-coded value of 256000.");
			}
		} catch (ex) {
			logmsg("WARN", "Non-fatal exception occurred while retrieving Large String Maximum Value registry setting;" +
				" using hard-coded value of 256000. Exception details:\n" + ex);
		}

		this.largeStringMaxSize = doubleVal;
		this.properties.put("OP_LargeStringMaxSize", doubleVal);

		return doubleVal;
	}
};

// result set handler - works similar to an Iterator
var resultSet = {
	set: new java.util.ArrayList(),
	index: 0,
	nextUrl: null,
	objectType: null,

	add: function(jobj) {
		this.set.add(jobj);
	},

	size: function() {
		return this.set.size();
	},

	clear: function() {
		this.set.clear();
		this.index = 0;
	},

	hasNext: function() {
		return (this.set !== null && (this.index < this.set.size() || this.nextUrl != null));
	},

	next: function() {
		if (this.set === null) {
			return null;
		} else {
			//if no results AND no next link, end of list
			if (this.index >= this.set.size() && this.nextUrl == null) {
				return null;
			}
			//else if no results but have next link, get result set
			else if (this.index >= this.set.size() && this.nextUrl != null) {
				this.getResultSet({
					url: "/" + this.nextUrl
				});
			}

			//return next entry
			var n = this.set.get(this.index);
			if (n == null) {
				return null;
			}
			return GrcObjectToEntry(this.set.get(this.index++));
		}
	},


	executeGrcObjectQuery: function(queryPath, ignoreCache) {
// _timer.start("OpenPages Connector - executeGrcObjectQuery()" );
		var reply = this.makeRequest({
			ignoreCache: ignoreCache,
			verb: "GET",
			ctype: "application/json;charset=utf-8",
			url: "/query?q=" + queryPath.replace(" ", "+") + "&caseInsensitive=true",
			where: "executeGrcObjectSetQuery"
		});
// _timer.stop("OpenPages Connector - executeGrcObjectQuery()" );
		return reply;
	},

	getResultSet: function(args) {
		var verb = args.verb || "GET"; // HTTP method, e.g. GET, POST, PUT, ...
		var url = args.url || ""; // url for the request. May be partial (only the path & query string params)
		// var body = args.body;	// HTTP body to be passed for the request
		var ctype = args.ctype || "application/json"; // Content-Type of the HTTP body
		var where = args.where || ""; // where this method is called from - for debugging purposes
		var reply = null;
		var query = args.query || "";

		if (query != "") {
			url = "/query?q=" + query.replace(" ", "+") + "&caseInsensitive=true";
		}

		this.clear();
		if (params.deBug) logmsg("DEBUG", "Issuing " + verb + " request to URL: " + url);

		try {
// _timer.start("OpenPages Connector - getResultSet()" );
			reply = makeRequest({
				verb: verb,
				url: url,
				ctype: ctype,
				where: where + "resultSet.getResultSet"
			});
		} catch (ex) {
			reply = null;
			logmsg("WARN", "Exception occurred while processing result set from REST request to OpenPages; continuing...");
			if (params.deBug) logmsg("DEBUG", "Exception occurred; details:\n" + ex);
		}
// _timer.stop("OpenPages Connector - getResultSet()" );

		this.addToResultSet(reply);
	},
	
	addToResultSet: function(reply) {
		var i;
		if (reply !== null) {
			if (typeof reply.rows !== "undefined") {
				var rows = reply.rows;
				for (i = 0; i < rows.length; i++) {
					rows[i]["$grcObjectType"] = params.getTypeByIdOrName(params.object).id;
					rows[i]["$grcObjectTypeName"] = params.object;
					this.add(rows[i]);
				}
			} else {
				reply["$grcObjectType"] = params.getTypeByIdOrName(params.object).id;
				reply["$grcObjectTypeName"] = params.object;
				this.add(reply);
			}

			// check for next link
			if (typeof reply.links !== "undefined") {
				this.nextUrl = null;
				for (i = 0; i < reply.links.length; i++) {
					if (reply.links[i].rel == "next") {
						this.nextUrl = reply.links[i].href;
					}
				}
			}
		}
	}
}

function ensureInitialized(skipSelect) {
	skipSelect = skipSelect || false;
	params.refresh();
	if (!initialized) {
		initializeConnector();
		if (!skipSelect) {
			selectConnectorEntries();
		}
	}
}

// functions follow
function initializeConnector() {
	logmsg("INFO", "[OpenPages Connector] v" + version);
	if (initialized) {
		terminate();
	}

	params.initialize();

	initialized = true;
}

function terminate() {
	initialized = false;
	params.getHttp().terminate();
}

function selectEntries() {
	ensureInitialized();
}

function selectConnectorEntries(args) {
	//if (!initialized) { notInitializedError(); }
	ensureInitialized(true);

	if (connector.getParam("object").toLowerCase().startsWith("file")) {
		return {};
	}

	var urlPath = "/query?q=";
	var selectClause, whereClause, query;
	var url;

	if (args) {
		urlPath = (args.urlPath) ? args.urlPath : urlPath;
		selectClause = args.selectClause;
		whereClause = args.whereClause;
	}

	if (!selectClause) {
		selectClause = "SELECT * from [" + params.object + "]";
		if (params.query && params.query.length > 0) {
			selectClause = params.query;
		}
	}

	url = urlPath;

	if (url.equalsIgnoreCase("/query?q=")) {
		query = selectClause;
		if (whereClause && query.indexOf(" WHERE ") < 0) {
			query += whereClause;
		}

		// EH Always add Resource Id to the list of fields returned - at least for the first object listed in the fields list
		query = addIdToQuery(query);

		//		url += java.net.URLEncoder.encode(query + "&caseInsensitive=true", "UTF-8");
		url += java.net.URLEncoder.encode(query, "UTF-8");
	}

	resultSet.getResultSet({
		verb: "GET",
		url: url,
		ctype: "application/json",
		where: "selectConnectorEntries"
	});

}

function addIdToQuery(query) {
	query = query.trim();
	var queryLC = query.toLowerCase();

	if (!queryLC.startsWith("select")) {
		return query;
	}

	var fromP = queryLC.indexOf(" from ");
	if (fromP < 0) {
		return query;
	}

	var attList = query.substring("select ".length, fromP).trim();
	var attListLC = attList.toLowerCase();

	if (attList == "*") {
		return query;
	}

	// Now determine which objects are being read based on the field list.
	// If required by args.needId then add .["Resource ID"] for first Object found

	// First first field specifier
	var p = attList.indexOf("].[");
	if (p < 0) {
		return query;
	}

	var objectName = attList.substring(1, p);

	var requiredAtt = "[" + objectName + "].[Resource ID]";
	if (attListLC.contains(requiredAtt.toLowerCase())) {
		return query;
	}

	attList += " " + requiredAtt + " as _UNIQUE_ID_";

	var newQuery = query.substring(0, "select ".length) +
		attList +
		query.substring(fromP);

	logmsg("DEBUG", "Adding " + requiredAtt) + " to query: " + newQuery;;
	return newQuery;
}

function getNextEntry() {
	ensureInitialized(true);

	var e = resultSet.next();
	if (e !== null) {
		entry.merge(e);
		result.setStatus(1);
	} else {
		result.setStatus(0);
	}

	return entry;
}

// This is a multi-purpose function that provides the following operations, based on
// the value passed in the 'operation' attribute of the conn Entry:
//	 o make_request-Makes a request of the OpenPages REST API based on the following attributes:
//					> path is the full path of the request
//					> method is set to the HTTP Method (e.g. GET, POST, etc)
//					> body (optional) contains the body to POST/PUT
//   o add_parent - Adds a parent to an object, based on the following attribute values:
//					> parentId is the resource Id of the parent object
//					> parentType is the type of the parent (name, e.g. SOXAccount)
//					> childType is the type of the child object (name, e.g. Policy)
//					> childId is the resource id of the child
//	 o state - 		Returns a 'state' attribute with the value 'initialized' if the Connector is init'ed, otherwise 'not initialized'
//	 o get_conn -	Returns the last conn Entry - e.g. result of a putEntry or modEntry operation
//	 o set_current -Sets the current (last read) Entry
//	 o get_types -	Returns two HashMaps, OpenPages types by name, and one by Id
//	 o get_fielddefinitions -
//					Returns the field definitions for the type of object passed into the queryReply function
//	 o select -		Performs selectEntries based on the current parameter settings (e.g. the 'query' param), afterwhich getNextEntry()
//					can be used to retrieve the data.
//	 o parse2entry	Converts a JSON payload to an Entry
//	
function queryReply() {
	var operation = entry.getString("operation") 
					|| entry.getString("command") 
					|| entry.getString("task")
					|| "* not specified *";
	//entry.removeAllAttributes();

	switch (operation) {
		case "make_request": 
			ensureInitialized(true);

			var path = String(entry.getString("path")).trim().toLowerCase();
			if (!path.startsWith("/")) path = "/" + path;
			//if (!path.startsWith("/grc")) path = params.root + path;
			var method = entry.getString("method") || "GET";
			var body = entry.getObject("body");
			if (typeof body == "object") {
				body = toJson(body);
			}
			
			var response = makeRequest({
				verb: method,
				url: path,
				ctype: "application/json",
				body: body
			});
			
			try {
				var obj = GrcObjectToEntry(response);
				if (obj instanceof com.ibm.di.entry.Entry) {
					entry.merge(obj);
				} else {
					entry.entryArray = obj;
				}
			} catch (ex) {
				entry.response = response;
			}
			
			/*
			// See if the request returned a list of object. If so, set up for getNextEntry()
			if (response instanceof Array) {
				resultSet.clear();
				resultSet.addToResultSet({rows: response});
			}
			*/
			break;
		case "add_parent":
			ensureInitialized(true);
			
			grcObj = {
				id: system.toInt(entry.getObject("parentId") || 0),
				typeDefinitionId: params.getTypeByIdOrName(entry.getString("parentType")).id,
				associationDefinitionId: params.getTypeByIdOrName(entry.getString("childType")).id,
				type: "PARENT"
			};
			var response = makeRequest({
				verb: "POST",
				url: "/contents/" + entry.childId + "/associations/parents",
				ctype: "application/json",
				where: "queryReply - add_parent",
				body: makeJson([grcObj])
			});

			try {
				var obj = GrcObjectToEntry(response);		
				if (obj instanceof com.ibm.di.entry.Entry) {
					entry.merge(obj);
				} else {
					entry.entryArray = obj;
				}
			} catch (ex) {
				entry.response = response;
			}
			
			break;
		case "parse2entry":
			entry.removeAllAttributes();
			// parse the reply from OpenPages
			var jsonOrObj = entry.getString("json") || entry.getString("response") || "{}";
			if (typeof jsonOrObj == "string") {
				jsonOrObj = fromJson(jsonOrObj);
			}
			var obj = GrcObjectToEntry(jsonOrObj);		
			if (obj instanceof com.ibm.di.entry.Entry) {
				entry.merge(obj);
			} else {
				entry.entryArray = obj;
			}
			break;
		case "state":
			entry.removeAllAttributes();
			if (!initialized) {
				entry.state = "not initialized";
			} else {
				entry.state = "initialized";
			}
			break;
		case "get_conn":
			entry.removeAllAttributes();
			if (lastConn != null) {
				entry.merge(lastConn);
			}
			break;
		case "set_current":
			params.setCurrent(entry.getObject("current"));
			break;
		case "get_types":
			entry.removeAllAttributes();
			ensureInitialized(true);
			params.getTypesById();
			var types = {
				typesById: params.typesById,
				typesByName: params.typesByName
			}
			entry.types = types;
			break;
		case "get_fielddefinitions":
			ensureInitialized(true);
			params.getFieldDefinitions(entry);
			var fieldDefinitions = params.fieldDefinitions
			entry.removeAllAttributes();
			entry.field_definitions = fieldDefinitions;
			break;
		case "select":
			entry.removeAllAttributes();
			ensureInitialized(true);
			params.refresh();
			params.apply();
			selectConnectorEntries();
			break;
		default:
			throw "Cannot perform queryReply() operation: " + operation;
	}
}

function putEntry() {
	ensureInitialized(true);

	var grcObj = entryToGrcObject(entry, true /* creating new */ );
	var primaryParentId = "<undefined>";

	if (params.deBug) logmsg("--->\n" + makeJson(grcObj));

	// Only create a new object if a valid primary parent Id is present
	if (typeof grcObj.primaryParentId === "undefined" || grcObj.primaryParentId === null ||
		params.invalidPrimaryParentIds.contains(grcObj.primaryParentId)) {
		if (typeof grcObj.primaryParentId !== "undefined" && grcObj.primaryParentId !== null) {
			primaryParentId = grcObj.primaryParentId;
		}
		throwException("A null or invalid primaryParentId was detected; not creating a new " +
						params.object + " object.");
	} else {
// _timer.start("OpenPages Connector - putEntry()" );
		if (entry.getString("$grcObjectType") == "SOXDocument") {
			logmsg("Adding SOXDocument: " + grcObj.name);
		
			// Need a loop here to increment the name in case of a 3202 error (already exists)
			var retry = 0;
			var docName = grcObj.name;
			do {
				retry++;
				try {
					var response = makeRequest({
						verb: "POST",
						url: "/contents",
						ctype: "application/json",
						where: "putEntry",
						body: makeJson(grcObj)
					});
					break; // Leave the loop if this works ok
				} catch (ex) {
					if (String(ex).contains("OP-03202")) {
						if (retry > 40) {
							var errmsg = "Unable to add CSD Doc - OpenPages error -3202";
							logmsg("ERROR", errmsg);
							throw errmsg;
						}
						grcObj.name = docName + "(" + (retry+1) + ")";
						logmsg("WARN", "Retrying write of CSD Doc, incrementing name to: " + grcObj.name);
					} else {
						throw ex;
					}
				}
			} while (true);
		} else {
			var response = makeRequest({
				verb: "POST",
				url: "/contents",
				ctype: "application/json",
				where: "putEntry",
				body: makeJson(grcObj)
			});
		}	
// _timer.stop("OpenPages Connector - putEntry()" );

		// Now return the new Resource ID in the conn Entry by setting lastConn
		var fields = response.fields.field;
		for (var i = 0; i < fields.length; i++) {
			var field = fields[i];
			if (field.name == "Resource ID") {
				var newID = system.toInt(field.value)
				entry["Resource ID"] = newID;
			} else {
				entry[field.name] = field.value;
			}
		}
		lastConn = entry;
		logmsg("INFO", "Added new " + params.object + " named '" + entry.name + "'" + " with id: " + entry["Resource ID"]);
	}
}

function modEntry() {
	ensureInitialized(true);
	
	if (search.getCriteria().size() > 0) {
		var crit = search.getCriteria()[0];
		if (crit.name == "Resource ID") {
			entry["Resource ID"] = crit.value;
			params.current = entry;
		}
	} else
	if (entry["Resource ID"] == null) {
		entry["Resource ID"] = params.current.getString("Resource ID");
	}

	var grcObj = entryToGrcObject(entry, false /* not new object - modifying existing */ );
	var primaryParentId = (params.current) ? params.current.getString("Resource ID") : null;
	var i;

	if (params.deBug) logmsg("--->\n" + makeJson(grcObj));

	// This if-clause only works for ucf_integration. The function is to modify and correct Requirements' primary
	// parent back to the Business Entity after adding other Sub-mandate parents (Parent-child association);
	// And collect a set of parents' attribute values and map them to Requirements' fields. Aug, 2016
	if (params.object == "Requirement") {
// _timer.start("OpenPages Connector - modEntry()" );
		var preReply = makeRequest({
			verb: "GET",
			url: "/contents/" + params.current.getString("Resource ID"),
			ctype: "application/json"
		});
// _timer.stop("OpenPages Connector - modEntry()" );

		var preserveFields = ["UCF-Req:Supporting Requirements", "UCF-Req:Associated Mandates", "UCF-Req:Guidance"];
		var existingField = preReply.fields.field;

		var tempSuppReq = null;
		var tempADCommonName = null;
		var tempGuidance = null;

		for (i = 0; i < existingField.length; i++) {
			if (existingField[i].name == preserveFields[0]) {
				tempSuppReq = existingField[i].value
			} else if (existingField[i].name == preserveFields[1]) {
				tempADCommonName = existingField[i].value
			} else if (existingField[i].name == preserveFields[2]) {
				tempGuidance = existingField[i].value
			}

			var newField = grcObj.fields.field;

			for (i = 0; i < newField.length; i++) {
				if (newField[i].name == preserveFields[0]) {
					newField[i].value = (tempSuppReq.contains(newField[i].value)) ? tempSuppReq : tempSuppReq + newField[i].value
				} else if (newField[i].name == preserveFields[1]) {
					newField[i].value = (tempADCommonName.contains(newField[i].value)) ? tempADCommonName : tempADCommonName + newField[i].value
				} else if (newField[i].name == preserveFields[2]) {
					newField[i].value = (tempGuidance.contains(newField[i].value)) ? tempGuidance : tempGuidance + newField[i].value
				}
			}
		}
	}

	if (params.object == "Requirement") {
		feedProps.recoverPrimaryParentIdFromFeed(entry);
		grcObj.primaryParentId = feedProps.derivedPrimaryParentId;
		setGrcPrimaryParentIdFromFeedPropsOrDefault(grcObj, "primaryParentId");

	} else {
		if (typeof grcObj.primaryParentId !== "undefined" && grcObj.primaryParentId !== null) {
			primaryParentId = grcObj.primaryParentId;
		}
		//logmsg("WARN", "A null or invalid primaryParentId was detected");
	}

// _timer.start("OpenPages Connector - modEntry()" );
	response = makeRequest({
		verb: "PUT",
		url: "/contents/" + entry.getString("Resource ID"),
		ctype: "application/json",
		where: "modEntry",
		body: makeJson(grcObj)
	});
// _timer.stop("OpenPages Connector - modEntry()" );

	logmsg("INFO", "Modified existing " + params.object + " named '" + entry.name + "'" + " with id: " + entry["Resource ID"]);

	// Now return the new Resource ID in the conn Entry by setting lastConn
	var fields = response.fields.field;
	for (var i = 0; i < fields.length; i++) {
		var field = fields[i];
		if (field.name == "Resource ID") {
			var newID = system.toInt(field.value)
			entry["Resource ID"] = newID;
		} else {
			entry[field.name] = field.value;
		}
	}
	lastConn = entry;
}

function findEntry() {
	ensureInitialized(true);

	var res = grcWhereClause(search);

	params.setCurrent(null);
	feedProps.clear(); // clear out the feed props for each new entry

	selectConnectorEntries({
		urlPath: res.path,
		whereClause: res.where,
		selectClause: res.query
	});

	if (resultSet.size() == 1) {
		var e = resultSet.next();
		entry.merge(e);
		result.setStatus(1);
		params.setCurrent(e);
	} else
	if (resultSet.size() > 1) {
		while (resultSet.hasNext()) {
			connector.addFindEntry(resultSet.next());
		}
		result.setStatus(1);
	} else {
		result.setStatus(0);
	}
}

function deleteEntry() {
	ensureInitialized(true);

	try {
		var response = makeRequest({
			verb: "DELETE",
			url: "/contents/" + params.current.getString("Resource ID"),
			ctype: "application/json",
			where: "deleteEntry"
		});
	} catch (ex) {
		logmsg("ERROR", "Unable to delete existing object; an exception occured in the " +
			"OpenPages server: " + ex);
	}
}

function querySchema(objectType) {
	ensureInitialized(true);

	if (typeof objectType === "undefined" || objectType == null) {
		objectType = params.object;
	}

	if (objectType.toLowerCase().startsWith("file")) { // EH hardcoding for "file"
		var fields = [{
				name: "name",
				type: "String (f.ex. document.docx)"
			},
			{
				name: "extension",
				type: "String (f.ex. docx)"
			},
			{
				name: "type",
				type: "String (f.ex. word)"
			},
			{
				name: "description",
				type: "String"
			},
			{
				name: "content",
				type: "String or Byte Array"
			},
			{
				name: "primaryParentId",
				type: "Integer"
			}
		];
		for (var i = 0; i < fields.length; i++) {
			var e = system.newEntry();
			var field = fields[i];
			e.addAttributeValue("name", field.name);
			e.addAttributeValue("syntax", field.type);
			list.add(e);
		}
	} else {
		var fieldDefs = params.getFieldDefinitions(objectType);

		for (var key in fieldDefs) {
			list.add(newSchemaEntry(key, fieldDefs));
		}

		for (var i = grcSystemFieldNames.length - 1; i > 0; i--) {
			list.add(newSchemaEntry(grcSystemFieldNames[i], grcSystemFieldTypes[i]));
		}

		list.add(newSchemaEntry("$grcObject", "JavaScript Object"));
		list.add(newSchemaEntry("$grcObjectType", "Number"));
		list.add(newSchemaEntry("$grcObjectTypeName", "String"));
		list.add(newSchemaEntry("$grcObjectJSON", "JSON"));
	}

	result.setStatus(1);
}

function newSchemaEntry(key, fieldDefs) {
	var e = new com.ibm.di.entry.Entry();

	if (typeof fieldDefs === "string" || typeof fieldDefs[key] === "string") {
		e.addAttributeValue("name", key);
		e.addAttributeValue("syntax", fieldDefs);
	} else {
		e.addAttributeValue("name", fieldDefs[key].name);
		e.addAttributeValue("syntax", getSchemaType(fieldDefs, key));
	}

	return e;
}

function grcWhereClause(search) {
	var where = "";
	var path = null;
	var query = null;
	var critList = search.getCriteria();
	var type = params.object;
	var boolOp = "AND";
	if (search.getType() == search.SEARCH_OR) {
		boolOp = "OR";
	}

	for (var crit in critList) {
		var fieldDef = params.getFieldDefinition(crit.name);
		if (fieldDef == null) {
			throw "The link criteria of the OpenPages connector specifies a field name (" + crit.name + ") that does not belong " +
				"to the chosen OpenPages object type (" + type + ").  Either the link criteria or the chosen OpenPages object " +
				"has changed and is out of sync with the other.  Check both settings and try again.";
		}

		if ("Resource ID".equalsIgnoreCase(fieldDef.name) &&
			crit.match == search.EXACT &&
			search.getType() == search.SEARCH_AND) {
			path = "contents/" + crit.value;
			query = null;
			where = null;
			break;
		}
		where += (where.length == 0) ? "" : " " + boolOp + " ";
		where += "[" + type + "].[" + fieldDef.name + "]";
		where += grcClause(crit, fieldDef);
	}

	return {
		where: " WHERE " + where,
		path: path,
		query: query
	};
}

function grcClause(criteria, fieldDef) {
	var match = criteria.match;
	var value = criteria.value;

	if (!"INTEGER_TYPE".equals(fieldDef.dataType) &&
		!"CURRENCY_TYPE".equals(fieldDef.dataType)) {
		value = "'" + criteria.value + "'";
	}

	if (match == com.ibm.di.server.SearchCriteria.EXACT ||
		match == com.ibm.di.server.SearchCriteria.EXCACT) {
		return " = " + value;
	} else
	if (match == com.ibm.di.server.SearchCriteria.FINAL_STRING) {
		return " LIKE '%" + criteria.value + "'"
	} else
	if (match == com.ibm.di.server.SearchCriteria.GREATER_THAN) {
		return " > " + value;
	} else
	if (match == com.ibm.di.server.SearchCriteria.GREATER_THAN_OR_EQUAL) {
		return " >= " + value;
	} else
	if (match == com.ibm.di.server.SearchCriteria.INITIAL_STRING) {
		return " LIKE '" + criteria.value + "%'"
	} else
	if (match == com.ibm.di.server.SearchCriteria.LESS_THAN) {
		return " < " + value;
	} else
	if (match == com.ibm.di.server.SearchCriteria.LESS_THAN_OR_EQUAL) {
		return " <= " + value;
	} else
	if (match == com.ibm.di.server.SearchCriteria.SUBSTRING) {
		return " LIKE '%" + criteria.value + "%'"
	} else {
		throw "Unknown match type: " + match;
	}
}

function getSchemaType(fieldDefs, key) {
	var type = "?undefined " + key + "?";
	var fieldDef = fieldDefs[key];
	if (typeof fieldDef !== "undefined" || fieldDef != null) {
		var fieldType = schemaType[fieldDef.dataType];
		if (fieldType != null) {
			type = fieldType;
			if ("true".equalsIgnoreCase(fieldDef.readOnly)) {
				type += " (read only)";
			} else
			if ("true".equalsIgnoreCase(fieldDef.required)) {
				type += " (required)";
			}
		}
	}
	return type;
}

function fixTypeObj(ext) {
	ext = ext || "txt";
	switch (ext) {
		case "xls":
			return {
				type: "application/vnd.ms-excel", id: 46, ext: ext
			};
		case "xlsx":
			return {
				type: "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet", id: 53, ext: ext
			};
		case "docx":
			return {
				type: "application/vnd.openxmlformats-officedocument.wordprocessingml.document", id: 73, ext: ext
			};
		case "rtf":
			return {
				type: "text/richtext", id: 13, ext: ext
			};
		case "txt":
			return {
				type: "text/plain", id: 9, ext: ext
			};
		case "html":
			return {
				type: "text/html", id: 1, ext: ext
			};
		case "htm":
			return {
				type: "text/html", id: 2, ext: ext
			};
		case "pdf":
			return {
				type: "application/pdf", id: 44, ext: ext
			};
		case "ppt":
			return {
				type: "application/vnd.ms-powerpoint", id: 56, ext: ext
			};
		case "doc":
			return {
				type: "application/msword", id: 70, ext: ext
			};
		default:
			return {
				type: "application/msword", id: 70, ext: ext
			};
	}
}

// Funcion to add file details to a SOXDocument
function addFileDetails(grcObj, entry) {
	var name = entry.getString("name");
	var p = name.lastIndexOf(".");
	var ext = entry.getString("extension") || ((p > 0) ? name.substring(p + 1) : "txt");
	if (p > 0) {
		name = name.substring(0, p);
	}

	var type = entry.getString("type");

	var encode = true;
	typeobj = fixTypeObj(ext);

	var content = entry.getObject("content");
	if (encode) {
		if (typeof content != "[B") { // If not a byte array, then the request is wrong
			var errormsg = "The content Attribute must be a Byte Array for this type of file";
			logmsg("ERROR", "Error writing file object - " + errormsg);
			throw errormsg;
		}
		content = system.base64Encode(content);
	}

	grcObj.contentDefinition = {
		attribute: {
			type: typeobj.type
		},
		children: content
	};
	grcObj.fileTypeDefinition = {
		id: typeobj.id,
		mimeType: typeobj.type,
		fileExtension: typeobj.ext
	};

	return grcObj;
}

// Convert an Entry into a grc Object ready to be passed to the OpenPages REST API
function entryToGrcObject(entry, creatingNew) {
	if (typeof creatingNew === "undefined") {
		creatingNew = true;
	}

	var i, length;
	var grcObj = entry.getObject("$grcObject");

	// Place holder for future use (ucf_integration_control)
	var grcObjType = entry.getObject("$grcObjectType");
	if (grcObjType != null) {
		params.object = grcObjType;
		var thisType = params.getTypeByIdOrName(grcObjType);
		if (thisType != null) {
			params.objectId = thisType.id;
		}
	}

	params.getObjectType(entry);

	if (grcObj == null || typeof grcObj !== "object") {
		var readOnly = [];
		var required = [];

		if (params.object.toLowerCase().startsWith("file") ||
			params.object.equalsIgnoreCase("SOXDocument")) {
			var mandatoryFields = ["name", "content"];
			for (var i = 0; i < mandatoryFields.length; i++) {
				if (entry[mandatoryFields[i]] == null) {
					required.push(mandatoryFields[i]);
				}
			}

			if (required.length > 0) {
				var errmsg = "Required Attributes are missing from the output map: " + required.join(", ");
				logmsg("ERROR", errmsg);
				throw errmsg;
			} else {
				var name = entry.getString("Name") || "* Name not set *";
				var ext = entry.getString("extension") || "txt";

				var type = entry.getString("type");

				var encode = true;
				typeobj = fixTypeObj(ext);

				var content = entry.getObject("content");
				if (encode) {
					if (typeof content != "[B") { // If not a byte array, then the request is wrong
						var errormsg = "The content Attribute must be a Byte Array for this type of file";
						logmsg("ERROR", "Error writing file object - " + errormsg);
						throw errormsg;
					}
					content = system.base64Encode(content);
				}

				grcObj = {
					name: name,
					contentDefinition: {
						attribute: {
							type: typeobj.type
						},
						children: content
					},
					fileTypeDefinition: {
						id: typeobj.id,
						mimeType: typeobj.type,
						fileExtension: typeobj.ext
					},
					fields: {
						field: []
					},
					typeDefinitionId: "4"
				};

				var optionalFields = ["description", "primaryParentId"];
				for (var i = 0; i < optionalFields.length; i++) {
					var fieldName = optionalFields[i];
					if (entry[fieldName] != null) {
						grcObj[fieldName] = entry.getObject(fieldName);
					}
				}
			}
		} else {
			grcObj = {
				fields: {
					field: []
				}
			};
		}

		// Continue build the grcObj

		var fieldDefs = params.getFieldDefinitions(entry);
		var templates = params.getTemplate(entry);

		var objectType = fieldDefs.get("$grcObjectType");

		grcObj.typeDefinitionId = params.getTypeByIdOrName(objectType).id;

		// It is possible that the system field value for primaryParentId may not be specified.
		// If it is it will be used. If it is not, there may be feed-provided values for
		// "parentType" and "parentLocation" that can be used to derive the primaryParentId.
		// Obtain the static (or dynamically derived) value of the primaryParentId from the
		// feed now so that addGrcSystemField() can use the proper value.
		feedProps.obtainPrimaryParentIdFromFeed(entry);

		for (i = 0, length = grcSystemFieldNames.length; i < length; i++) {
			addGrcSystemField(grcObj, grcSystemFieldNames[i], entry, creatingNew);
		}

		for (var key in templates) {
			if (key.startsWith("$")) {
				continue;
			}
			var fieldDef = fieldDefs.get(key);
			var att = entry.getAttribute(fieldDef.name);

			if (fieldDef.readOnly && att != null) {
				readOnly.push(fieldDef);
			} else
			if (fieldDef.required && att == null && creatingNew) {
				if (!fieldDef.readOnly) {
					required.push(fieldDef);
				}
			} else if (att !== null) {
				addGrcField(grcObj, att, fieldDef);
			}
		}

		var fields;
		if (required.length > 0) {
			fields = [];
			for (i = 0; i < required.length; i++) {
				fields.push(required[i].name);
			}
			throwException(message["The following fields are required"] + ": " + fields.join(", "));
		}

		if (readOnly.length > 0) {
			fields = "";
			for (i = 0; i < readOnly.length; i++) {
				fields += (fields.length == 0 ? "" : ", ") + readOnly[i].name;
			}
			logmsg("WARN", message["The following fields are readOnly and cannot be written"] + ": " + fields);
		}

		if (entry.primaryParentId) {
			grcObj.primaryParentId = entry.getObject("primaryParentId");
		}

		if (objectType.equalsIgnoreCase("SOXDocument")) {
			grcObj = addFileDetails(grcObj, entry);
		}
	}
	
	// Remove illegal characters from the .name property
	if (grcObj.name) {
		var illegalChars = ["/"];
		for (var i = 0; i < illegalChars.length; i++) {
			grcObj.name = grcObj.name.replaceAll(illegalChars[i], "_");
		}
	}

	return grcObj;
}

// This function is for use when setting an entry's primaryParentId
function setGrcPrimaryParentIdFromFeedPropsOrDefault(grcObj, name, addNewObject) {
	if (typeof addNewObject == "undefined") addNewObject = true;

	// If a valid primaryParentId was included in the feed for this entry then use it
	if (feedProps.staticPrimaryParentId !== null) {
		grcObj[name] = feedProps.staticPrimaryParentId;
		if (addNewObject) {
			logmsg("INFO", "Using the static primaryParentId value '" + feedProps.staticPrimaryParentId +
				"' supplied in the feed.");
		}	
	}

	// otherwise if a primaryParentId was derived from the feed properties then use it
	else if (feedProps.derivedPrimaryParentId !== null) {
		grcObj[name] = feedProps.derivedPrimaryParentId;
		if (addNewObject) {
			logmsg("INFO", "Using the primaryParentId value '" + feedProps.derivedPrimaryParentId +
				"' derived from the feed's parentType and parentLocation values.");
		}
	}

	// otherwise use the default parent object ID (if any)
	else {
		var defaultPrimaryParentObjectId = params.getDefaultPrimaryParentObjectId(addNewObject);

		if (defaultPrimaryParentObjectId) {
			grcObj[name] = defaultPrimaryParentObjectId;

			if (addNewObject) {
				logmsg("INFO", "A primaryParentId was not supplied in or derived from the feed; using " +
					"the default primaryParentId value '" + defaultPrimaryParentObjectId +
					"' derived from the op_parentType and op_parentLoc properties. ");
			}
		} else {
			if (addNewObject) {
				logmsg("WARN", "A primaryParentId was not supplied in or derived from the feed, " +
					"and a default primaryParentId is not defined.");
			}
		}
	}
}

function addGrcSystemField(grcObj, name, entry, addNewObject) {
	if (typeof addNewObject == "undefined") addNewObject = true;
	
	var att = entry[name];

	// Special handling is required for the "typeDefinitionId" and "primaryParentId" system fields
	if (att == null) {
		if ("typeDefinitionId".equalsIgnoreCase(name)) {
			grcObj[name] = params.objectId || grcObj.typeDefinitionId;
		} else if ("primaryParentId".equalsIgnoreCase(name) && addNewObject) {
			setGrcPrimaryParentIdFromFeedPropsOrDefault(grcObj, name, addNewObject);
		}
	}
	// The attribute value is not null but special handling is needed for "primaryParentId"
	// (the primaryParentId to use is set up via feedProps.obtainPrimaryParentIdFromFeed)
	else if ("primaryParentId".equalsIgnoreCase(name) && addNewObject) {
		setGrcPrimaryParentIdFromFeedPropsOrDefault(grcObj, name, addNewObject);
	}

	// no special handling needed for this field, just set it
	else {
		grcObj[name] = att.getValue();
	}
}

function truncateStringForGrcField(stringValue, maxAllowedLength) {
	var truncatedStr = stringValue;
	if (stringValue.length >= maxAllowedLength) {
		truncatedStr = stringValue.substring(0, Math.min(stringValue.length(), maxAllowedLength - 5));
		if (stringValue.length >= maxAllowedLength - 4) {
			truncatedStr += "...";
		}
	}
	return truncatedStr;
}

function addGrcField(grcObj, att, fieldDef) {
	var grcField = {
		dataType: fieldDef.dataType,
		id: fieldDef.id,
		name: fieldDef.name
	};
	var inError = [];
	var attValue = null;
	var field = grcObj.fields.field;
	var addedValue = false;
	var message = "";
	var truncatedStr, eval;

	if (params.deBug) logmsg("DEBUG", "--> Attempting to add " + att.toString() + "   field: " + fieldDef.id);

	if (att !== null && att.size() > 0) {
		attValue = att.getValue(0);
	}

	if (attValue != null) {
		try {
			switch (fieldDef.dataType) {
				case "STRING_TYPE": // string length limited to 4000 chars
					truncatedStr = truncateStringForGrcField(attValue, 4000);
					grcField.value = truncatedStr;
					addedValue = true;
					break;
				case "MEDIUM_STRING_TYPE": // string length limited to 32000 chars
					truncatedStr = truncateStringForGrcField(attValue, 32000);
					grcField.value = truncatedStr;
					addedValue = true;
					grcField.dataType = "STRING_TYPE"; //nan -  OP server doesn't recognize MEDIUM_STRING_TYPE
					break;
				case "LARGE_STRING_TYPE": // string length limited to OP registry setting for largeStringMaxSize
					truncatedStr = truncateStringForGrcField(attValue, params.largeStringMaxSize);
					grcField.value = truncatedStr;
					addedValue = true;
					break;
				case "ID_TYPE":
				case "BOOLEAN_TYPE":
				case "FLOAT_TYPE":
					grcField.value = attValue;
					addedValue = true;
					break;
				case "INTEGER_TYPE":
					grcField.value = attValue;
					addedValue = true;
					break;
				case "ENUM_TYPE":
					eval = enumValue(attValue, fieldDef);
					if (eval != null) {
						grcField.enumValue = enumValue(attValue, fieldDef);
						addedValue = true;
					} else {
						message = "Attempt to add value of '" + attValue +
							"' to enumerated field definition '" + fieldDef.name +
							"' was not allowed to object type '" + params.object + "'." +
							" The assembly line mapping will need to be modified.";
						logmsg("WARN", message);
						sendEmailNotification(message);
					}
					break;
				case "MULTI_VALUE_ENUM":
					grcField.multiEnumValue = {enumValue: []};
					for (var i = 0; i < att.size(); i++) {
						eval = enumValue(att.getValue(i), fieldDef);
						if (eval != null) {
							grcField.multiEnumValue.enumValue.push(eval);
							addedValue = true;
						} else {
							message = "Attempt to add value of '" + attValue +
								"' to multi-enumerated field definition '" + fieldDef.name +
								"' was not allowed to object type '" + params.object + "'." +
								" The assembly line mapping will need to be modified.";
							logmsg("WARN", message);
							sendEmailNotification(message);
						}
					}
					break;
				case "DATE_TYPE":
					var dateValue;
					if (attValue instanceof java.util.Date) {
						dateValue = attValue;
					} else {
						dateValue = parseDateValue(attValue);
					}
					if (dateValue !== null) {
						// "yyyy-MM-dd'T'HH:mm:ss.SSS'Z'" // works but TZ is not accurate

						// TDI 7.1.1 uses Java 6, so we cannot use format string "yyyy-MM-dd'T'HH:mm:ss.SSSXXX"
						// (which *is* supported in Java 7 and newer). So, we are using format string
						// "yyyy-MM-dd'T'HH:mm:ss.SSSZ" and are manually inserting the colon into place at the
						// end of the string in the 4 digits that follow the last "-" or "+" character, and
						// (if present) we remove the ':' directly in front of the 'T'.
						// Example: convert 2013-10-07T07:36:13.000-0400 to 2013-10-07T07:36:13.000-04:00
						// Example: convert 2013-10-07:T07:36:13.000-0400 to 2013-10-07T07:36:13.000-04:00

						var sdf = new java.text.SimpleDateFormat("yyyy-MM-dd'T'HH:mm:ss.SSSZ");
						var timeDate = sdf.format(dateValue);
						timeDate = timeDate.replace(":T", "T");

						var timeDateStr = new java.lang.String(timeDate);
						var insertColonPos = timeDateStr.length() - 2;
						var firstPart = timeDateStr.substring(0, insertColonPos);
						var lastPart = timeDateStr.substring(insertColonPos, timeDateStr.length());

						grcField.value = new java.lang.String(firstPart + ":" + lastPart);
						addedValue = true;
					}
					break;
				case "CURRENCY_TYPE":
					// Mapping format required for a currency value in the feed must follow this example:
					//	  "123.45|AUD"
					// If no ISO code is supplied then the OP Base ISO code is used.

					var valueStr = new java.lang.String(attValue.trim());
					if (valueStr == "") {
						break;
					}

					var separatorIndex = valueStr.indexOf("|");
					var amount = "";
					var doubleVal = null;
					var isoCode = "";

					// parse out the amount and the ISO code from the provided attValue string
					if (separatorIndex !== -1) {
						amount = valueStr.substring(0, separatorIndex).trim();
						isoCode = valueStr.substring(separatorIndex + 1).trim();
					} else {
						amount = valueStr.trim();
					}

					// ensure that the amount is a valid double value
					try {
						doubleVal = java.lang.Double.parseDouble(amount);
					} catch (ex) {
						logmsg("ERROR", "Detected missing or invalid amount '" + amount + "' in the value " +
							"specified from the feed for CURRENCY_TYPE field '" + fieldDef.name +
							"'. Skipping this currency value.");
						break;
					}

					// ensure that the ISO code is not empty
					if (separatorIndex === -1 || isoCode === null || isoCode === "") {
						isoCode = params.defaultCurrencyIsoCode;
						logmsg("WARN", "Detected missing or invalid ISO code in the value " +
							"specified from the feed for CURRENCY_TYPE field '" + fieldDef.name +
							"'. Using the OpenPages default ISO code of '" + isoCode + "'.");
					}

					grcField.baseAmount = amount;
					grcField.localAmount = amount;

					// keep track of this field's ISO code for use when creating the JSON for OP
					feedProps.currencyIsoCodes.putIfAbsent(fieldDef.id, isoCode);

					addedValue = true;
					break;
			}
		} catch (ex2) {
			inError.push("Error creating GRC field" + " - " + ex2 + " --> " + att.toString());
		}
	}

	if (inError.length > 0) {
		throwException(toJson(inError));
	}

	if (addedValue) {
		field[field.length] = grcField;
	}

	return grcField;
}

function enumValue(attValue, fieldDef) {
	var enumValues = fieldDef.enumValues.enumValue;
	if (attValue == null) {
		return null;
	}

	attValue = attValue.trim();
	for (var i = enumValues.length - 1; i >= 0; i--) {
		var thisValue = enumValues[i];
		if (attValue.equalsIgnoreCase(thisValue.name) ||
			attValue.equalsIgnoreCase(thisValue.localizedLabel ||
				attValue.equalsIgnoreCase(thisValue.index))) {
			return {
				index: thisValue.index,
				hidden: thisValue.hidden,
				name: thisValue.name,
				id: thisValue.id,
				localizedLabel: thisValue.localizedLabel
			};
		}
	}

	return null;
}

function parseDateValue(attValue) {
	if (typeof attValue === "undefined" || attValue == null) {
		return null;
	}

	var dt = system.parseDate(attValue, "EEE MMM dd HH:mm:ss z yyyy");

	if (dt == null) {
		dt = system.parseDate(attValue, ISOdateMask1);
	}
	if (dt == null) {
		dt = system.parseDate(attValue, ISOdateMask2);
	}
	if (dt == null) {
		try {
			var df = java.text.DateFormat.getDateInstance();
			dt = df.parse(attValue);
		} catch (ex) {
			dt = null;
		}
	}

	return dt;
}

// requests the client cert from the service and installs it into the SDI keystore
function getCertificate() {
	com.ibm.di.security.GetSSLCertificate.installCertificateFrom(params.url, 443);
}

// examine the reply from OpenPages for any errors returned
function verifyResponse(replyEntry, requestEntry, url, suppressErrors) {
	suppressErrors = suppressErrors || false;
	
	var respCode = replyEntry.getString("http.responseCode");
	var body = new java.lang.String(replyEntry.getObject("http.bodyAsBytes"), "UTF-8");

	if (!respCode.startsWith("2") && !suppressErrors) {
		if (body.contains("-60002")) { // querying invalid object type
			logmsg("Got responseCode: " + respCode + " and body: "+ body + " - for url: " + url);
			return;
		}
		var responseMsg = replyEntry.getString("http.responseMsg") || "";

		var msg = "";
		try {
			msg = fromJson(body).message || body;
		} catch (ex) {
			msg = body;
		}

		var msg = body || "{message: " + msg + "}";
		throwException("Error from OpenPages - code: " + respCode + " message: " + responseMsg + " - " + msg
						+ "\nURL: " + url);
/*		
		throwException(message["Error from"] +
			" OpenPages server - code: " + respCode +
			"  message: " + rresponseMsg +
			"\nRequest: " + requestEntry.toJSON() +
			"\nRequest body: " + requestEntry.getString("body") +
			"\nURL: " + url +
			"\nHTTP Body returned: " + body);
*/
	}
}

// Replaces \/ with /
function fixBody(body) {
	return String(body).replace(/\\\//g, "/");
	//	return String(body).replace(/[a-zA-Z0-9_.-]+(\\\/)[a-zA-Z0-9_.-]+/g, "/");
}

// workhorse function that handles all comms with OpenPages. It accepts a single
// argument that is a Javascript object containing the properties set in the first
// lines of the function. Note that many of these properties are optional and that
// default values are set by the script is not specified.
//
function makeRequest(args) {
	var verb = args.verb; // HTTP method, e.g. GET, POST, PUT, ...
	var url = args.url; // url for the request. May be partial (only the path & query string params)
	var body = args.body; // HTTP body to be passed for the request
	var ctype = args.ctype; // Content-Type of the HTTP body
	var where = args.where; // where this method is called from - for debugging purposes
	var suppressErrors = args.suppressErrors || false;

	// set default values for missing params/properties
	if (verb == null) {
		verb = "GET";
	}
	if (url == null) {
		url = "";
	}
	if (ctype == null) {
		ctype = "application/json";
	}
	if (where == null) {
		where = "";
	}

	// prepend the base url if not found in the url passed to the function
	url = params.fixUrl(url);

	requestEntry.removeAllAttributes();

	if (typeof body !== "undefined" && body !== null && body.trim().length > 0) {
		requestEntry["http.body"] = fixBody(body);
	}

	// set Connector parameters
	params.getHttp().setParam("method", verb.toUpperCase());
	params.getHttp().setParam("url", url);
	
	var p = url.indexOf("/query?");
	if (p > 0) {
		p = url.indexOf("from", p+7);
		p = url.indexOf("%5B", p);
		var p2 = url.indexOf("%5D", p2);
		if (p > 0 && p2 > p) {
			var objType = url.substring(p+3, p2);
			params.object = objType;
			connector.setParam("object", objType);
		}
	}

	// prepare the request Entry (used for POST/PUT calls)
	requestEntry["http.Content-Type"] = ctype;
	requestEntry["http.Accept"] = "application/json";
	requestEntry["http.Connection"] = "keep-alive";
	requestEntry["http.remote_user"] = params.username;
	requestEntry["http.remote_pass"] = params.password;

	// the following are not used for now:
	//
	//	requestEntry["http.Accept-Encoding"] = "gzip, deflate";
	//	requestEntry["http.Accept-Language"] = "en-US,en;q=0.5";
	//	requestEntry["http.User-Agent"] = "IBM Security Directory Integrator";
	//	requestEntry["http.Authorization"] = "BASIC " + system.base64Encode(String(user + ":" + password).getBytes());

	// add any cookies received on previous calls
	if (cookies.size() > 0) {
		//		requestEntry["X-CouchDB-WWW-Authenticate"] = "Cookie";
		requestEntry.merge(cookies);
	}

	// if Detailed Log is enabled then write request details to the log
	if (params.deBug) {
		logDetails({
			msg: message["Request to"] + " OpenPages",
			obj: requestEntry,
			url: url,
			verb: verb,
			ctype: ctype,
			where: where
		});
	}

	var retry = 0;
	var maxRetry = 2;
	var retEntry = null;

	// this loop makes the actual request. If an SSL handshake error occurs, attempt to retrieve
	// and import the client certificate and inform the user that TDI must be restarted.
	//
	do {
		try {
			retEntry = params.getHttp().queryReply(requestEntry);
		} catch (ex) {
			if (ex instanceof javax.net.ssl.SSLHandshakeException && false) {
				if (retry == 0) {
					getCertificate();
				} else {
					throwException("You must restart the SDI server in order for the imported certificate to be trusted.")
				}
			} else {
				throw ex;
			}
		}
		/*
			// For some object types , template queries are different
			var code = retEntry.getString("http.responseCode");
			var msg = retEntry.getString("http.responseMsg");
			var p = url.indexOf("/template?typeId=");
			var body = retEntry.getString("http.bodyAsString");
			if(code == "400"
			&& body.contains("Bad Request - Document object template requires fileTypeId to be set.")
			&& p > 0 ){
				var p2 = url.lastIndexOf("=");
				url = url.substring(0,p) + "/" + url.substring(p2+1);
				params.getHttp().setParam("url", url);
				retEntry = null;
			}
		 */
		retry++;
	} while (retEntry === null && retry < maxRetry);

	// if Detailed Log is enabled, write reply details to the log
	if (params.deBug) {
		logDetails({
			"msg": message["Response from"] + " OpenPages",
			"entry": retEntry
		});
	}

	verifyResponse(retEntry, requestEntry, url, suppressErrors);

	// parse the reply from OpenPages
	return parseReply(retEntry, suppressErrors);
}

// parses the responseEntry (or just the response string or object)
function parseReply(replyEntry, suppressErrors) {
	suppressErrors = suppressErrors || false;
	
	var jobj = null;
	
	if (typeof replyEntry == "string") {
		var code = "200";
		var body = replyEntry;
	} else 
	if (replyEntry instanceof com.ibm.di.entry.Entry) {
		//var body = replyEntry.getString("http.bodyAsString");
		var body = new java.lang.String(replyEntry.getObject("http.bodyAsBytes"), "UTF-8");
		var code = replyEntry.getString("http.resultCode");
	} else
	if (typeof replyEntry == "object") {
		return replyEntry;
	}

	if (body == null || body.trim().length == 0 || "404".equals(code)) {
		return;
	}

	try {
		//		if (params.deBug) logmsg("DEBUG", "body: " + body);
		jobj = fromJson(body);

		// save any cookies passed back
		var setCookie = replyEntry.getAttribute("http.Set-Cookie");
		if (setCookie !== null) {
			for (var i = 0; i < setCookie.size(); i++) {
				var thisCookie = setCookie.getValue(i);
				var p = thisCookie.indexOf("=");
				if (p > 0) {
					cookies["http." + thisCookie.substring(0, p)] = thisCookie.substring(p + 1);
				}
			}
		}
	} catch (ex) {
		if (!suppressErrors) {
			throwException("Unable to parse JSON return from" + " OpenPages - " + ex + "\nBody received: " + body);
		}
	}

	return jobj;
}

// wrapper function for throwing exceptions. Otherwise exceptions thrown will be 'script' exceptions
function throwException(msg) {
	logmsg("ERROR", msg); // will also send an email notification
	throw new java.lang.IllegalArgumentException(msg);
}

// wrapper function for writing log messages
function logmsg(lvl, msg) {
	if (typeof lvl === "undefined") {
		lvl = "";
	}
	if (typeof msg === "undefined") {
		msg = lvl;
		lvl = "INFO";
	}

	// if Detailed Log is enabled then log output is also sent to the stdout
	if (params.deBug) {
		java.lang.System.out.println(msg);
	}

	try {
		task.logmsg(lvl, msg);
	} catch (ex) {
		main.logmsg(lvl, msg);
	}

	// send an email notification
	if (lvl === "ERROR") {
		sendEmailNotification(msg);
	}
}

// write request or reply details to the log
function logDetails(params) {
	var msg = params.msg;
	var obj = params.obj;
	var url = params.url;
	var verb = params.verb;
	var ctype = params.ctype;
	var where = params.where;

	if (msg == null) {
		msg = message["Unnamed entry"];
	}

	var s = new java.lang.StringBuffer();

	if (where != null) {
		s.append("\n@@@------> (" + where + ") " + msg);
	} else {
		s.append("\n---------> " + msg);
	}


	if (verb != null) {
		s.append("   " + verb.toUpperCase());
	}
	if (ctype != null) {
		s.append("   " + ctype);
	}
	if (url != null) {
		s.append("   " + url);
	}
	s.append("\n");

	if (obj != null) {
		if (obj instanceof com.ibm.di.entry.Entry) {
			var attNames = obj.getAttributeNames();
			for (var a in attNames) {
				// include all "http.*" attributes, except bodyAsBytes
				if (a.indexOf("http.") >= 0 &&
					!"http.bodyAsBytes".equalsIgnoreCase(a) &&
					!"http.remote_pass".equalsIgnoreCase(a)) {
					s += " " + a + ": " + obj[a] + "\n";
				}
			}
		} else {
			s.append(obj.toString());
		}
	}
	logmsg(s.toString());
}

function notInitializedError() {
	throwException("The OpenPages Connector must be initialized before use.");
}

function GrcObjectToEntry(jobj) {
	if (jobj instanceof Array) {
		var arrayList = new java.util.ArrayList();
		for (var i = 0; i < jobj.length; i++) {
			var subObj = jobj[i];
			arrayList.add(GrcObjectToEntryMain(subObj));
		}
		return arrayList.toArray();
	} else {
		return GrcObjectToEntryMain(jobj);
	}
}

/**
 * @return {null}
 */
function GrcObjectToEntryMain(jobj) {
	var entry = system.newEntry();
	var inError = [];
	var i;

	try {
		var type = null;

		// If jobj is from an array then this parsing to Entry is slightly different
		
		if (!jobj.fields) {
			entry["$grcObjectType"] = jobj.typeDefinitionId;
			entry["Resource ID"] = jobj.id;
			entry.path = jobj.path;
		} else {
			var links = jobj.links;
			if (typeof links !== "undefined") {
				for (i = 0; i < links.length; i++) {
					if ("describedby".equals(links[i].rel.toLowerCase().trim())) {
						type = links[i].href.substring(9);
						var p = type.indexOf("?");
						type = type.substring(0, p);
					}
				}
				if (type !== null) {
					var p = type.indexOf("/");
					if (p > 0) {
						type = type.substring(p+1);
					}
					entry["$grcObjectType"] = type;
					entry["$grcObjectTypeName"] = params.getTypeByIdOrName(type).name;
				}
			}
	
			var fields = jobj.fields ? jobj.fields.field : [];
			if (fields !== "undefined") {
				for (i = 0; i < fields.length; i++) {
					addGrcAttribute(entry, fields[i]);
				}
			}
			
			if (jobj.contentDefinition) {
				var contentLink = jobj.contentDefinition.attribute.src;
				try {
					var response = makeRequest({
						url: contentLink,
						verb: "GET",
						suppressErrors: true
					});
					if (response != null) {
						entry.contents = response.contentDefinition.children;
						var parts = system.splitString(entry.getString("Name"), ".");
						var type = "docx";
						if (parts.length > 1) {
							type = parts[parts.length-1];
						}
						entry.type = type;
					}	
				} catch (docEx) {
					//logmsg("WARN", "Error retrieving underlying SOXDocument: " + entry.name + " - " + docEx);
				}
			}
	
			if (entry.size() > 0) {
				entry["$grcObject"] = jobj;
				entry["$grcObjectJSON"] = makeJson(jobj);
			}
		}

	} catch (ex) {
		inError.push("Error converting JSON from OpenPages" + " - " + ex + "  -> " + makeJson(jobj));
	}

	if (inError.length > 0) {
		throwException(toJson(inError));
	}

	if (entry.size() === 0) {
		return null;
	} else {
		if (entry["$grcObjectType"] == null) {
			entry["$grcObjectType"] = system.toInt(params.getTypeByIdOrName(params.object).id);
			entry["$grcObjectTypeName"] = params.object;
		}
		return entry;
	}
}

function addGrcAttribute(entry, field) {
	if (typeof field === "undefined" || field == null) {
		return;
	}

	var fieldName = field.name;
	var fieldValue = field.value;

	if (typeof fieldName !== "undefined" && fieldName != null && fieldName.trim().length > 0) {

		fieldName = fieldName.trim();

		try {
			switch (field.dataType) {
				case "STRING_TYPE":
				case "MEDIUM_STRING_TYPE":
				case "LARGE_STRING_TYPE":
				case "ID_TYPE":
				case "BOOLEAN_TYPE":
					if (fieldValue) {
						addAttributeValue(entry, fieldName, fieldValue);
					}
					break;
				case "FLOAT_TYPE": // Handles any floating point decimal value as a double value
					if (fieldValue) {
						var doubleVal = 0.0;
						try {
							doubleVal = java.lang.Double.parseDouble(fieldValue);
						} catch (ex) {
							doubleVal = "Error parsing floating point value: " + fieldValue;
						}
						addAttributeValue(entry, fieldName, doubleVal);
					}
					break;
				case "INTEGER_TYPE":
					if (fieldValue) {
						var intValue = 0;
						try {
							intValue = system.toInt(fieldValue);
						} catch (ex) {
							intValue = "Error parsing integer value: " + fieldValue;
						}
						addAttributeValue(entry, fieldName, intValue);
					} else {
						entry[fieldName] = null;
					}
					break;
				case "ENUM_TYPE":
					if (field.enumValue) {
						if (typeof field.enumValue.name !== "undefined") {
							addAttributeValue(entry, fieldName, field.enumValue.name);
						}

						if (field.enumValue.index) {
							addAttributeValue(entry, fieldName + "_index", field.enumValue.index);
						}
					}
					break;
				case "MULTI_VALUE_ENUM":
					if (typeof field.multiEnumValue !== "undefined") {
						var enums = field.multiEnumValue.enumValue;
						if (typeof enums !== "undefined" && enums.length > 0) {
							for (var i = 0; i < enums.length; i++) {
								addAttributeValue(entry, fieldName, enums[i].name, false);
							}
						}
					}
					break;
				case "DATE_TYPE":
					if (fieldValue) {
						if (fieldValue && fieldValue.endsWith("Z")) {
							fieldValue = fieldValue.substr(0, fieldValue.length - 1);
						}
						var dateValue = system.parseDate(fieldValue,
							"yyyy-MM-dd'T'HH:mm:ss.SSS");

						if (dateValue == null) {
							logmsg("WARN", message["Unable to parse DATE_TYPE value for"] + " " + fieldName + ": " + fieldValue);
						}
						addAttributeValue(entry, fieldName, dateValue);
					}
					break;
				case "CURRENCY_TYPE":
					addAmount(entry, fieldName, "", field.baseAmount, field.baseCurrency);
					addAmount(entry, fieldName, "_localAmount", field.localAmount, field.localCurrency);
					break;
			}
		} catch (ex) {
			if (params.deBug) logmsg("DEBUG", "--!!--> Error parsing GRC field: " + toJson(field) + " - " + ex);
		}
	}
}

function addAttributeValue(entry, attName, attValue, replace) {
	if (typeof attName === "undefined" || attName == null) {
		return;
	}

	if (typeof replace === "undefined" || !"false".equalsIgnoreCase(replace)) {
		replace = true;
	}

	if (typeof attValue === "undefined" || attValue == null) {
		entry[attName] = entry.returnJavaNull;
	} else if (replace) {
		entry.setAttribute(attName, attValue);
	} else {
		entry.addAttributeValue(attName, attValue);
	}
}

function addAmount(entry, attName, attSuffix, attValue, currency) {
	if (typeof attName === "undefined" || attName == null) {
		return;
	}

	var doubleVal;
	try {
		doubleVal = java.lang.Double.parseDouble(attValue);
	} catch (ex) {
		doubleVal = "Error parsing amount: " + attValue + " - " + ex;
	}

	addAttributeValue(entry, attName + attSuffix, doubleVal);

	if (typeof currency !== "undefined" && typeof currency.isoCode !== "undefined") {
		addAttributeValue(entry, attName + attSuffix + "_currency", currency.isoCode);
	}
}

function nl(pad) {
	if (params.deBug) {
		return "\n											".substring(0, (pad * 4) + 1);
	} else {
		return "";
	}
}

function makeEnumJson(enumVal) {
	var json = new java.lang.StringBuffer();

	json.append(nl(6) + '{"index" : ' + enumVal.index + ',' +
		nl(6) + '"hidden" : ' + enumVal.hidden + ',' +
		nl(6) + '"id" : "' + enumVal.id + '",' +
		nl(6) + '"name" : "' + enumVal.name + '",' +
		nl(6) + '"localizedLabel" : "' + enumVal.localizedLabel + '"}');

	return json.toString();
}

function makeCurrencyJson(field, prop) {
	var json = new java.lang.StringBuffer();

	// The baseCurrency and localCurrency properties contain properties of
	// their own; special handling is performed here
	if (prop == "baseCurrency" || prop == "localCurrency") {
		var thisField = field[prop];

		json.append('"' + prop + '" :' +
			nl(6) + '{"isoCode" : "' + thisField.isoCode + '",' +
			nl(6) + '"name" : "' + thisField.name + '",' +
			nl(6) + '"symbol" : "' + thisField.symbol + '",' +
			nl(6) + '"precision" : ' + thisField.precision + ',' +
			nl(6) + '"isBaseCurrency" : ' + thisField.isBaseCurrency + ',' +
			nl(6) + '"isEnabled" : ' + thisField.isEnabled + ',' +
			nl(6) + '"id" : "' + thisField.id + '"}');

		return json.toString();
	} else {
		// Ensure that the localAmount has a localCurrency, which is
		// required for setting or updating a currency amount in OP. It
		// gets added here automatically since the currency field definition
		// does not specify any metadata for the ISO code.
		var isoCode = feedProps.currencyIsoCodes.get(field.id);

		if (prop == "localAmount" && isoCode !== null) {

			json.append('"' + prop + '" : ' + field[prop] + ',' +
				nl(4) + '"localCurrency" : ' +
				nl(6) + '{"isoCode" : "' + isoCode + '"},');

			return json.toString();
		} else {
			// all other currency properties are 'simple'
			return '"' + prop + '" : ' + field[prop];
		}
	}
}

function makeValueJson(field, prop) {
	var json = new java.lang.StringBuffer();
	var thisField = field[prop];
	if ("MULTI_VALUE_ENUM".equals(field.dataType)) {
		json.append(nl(4) + '"multiEnumValue" : {' +
			nl(5) + '"enumValue" : [');
		for (var i = 0; i < thisField.length; i++) {
			json.append(makeEnumJson(thisField[i]) + ",");
		}
		json.setLength(json.length() - 1);
		json.append(nl(5) + "]" + nl(4) + "}");
	} else if ("ENUM_TYPE".equals(field.dataType)) {
		json.append(nl(4) + '"enumValue" : ' + makeEnumJson(thisField));
	} else if ("CURRENCY_TYPE".equals(field.dataType)) {
		json.append(nl(4) + makeCurrencyJson(field, prop));
	} else {
		json.append(nl(4) + '"value" : ' + toJson(thisField));
	}

	return json.toString();
}

function makeFieldsJson(fields) {
	var json = new java.lang.StringBuffer();

	for (var i = 0; i < fields.length; i++) {
		var field = fields[i];
		json.append(nl(3) + "{" +
			nl(4) + '"dataType" : "' + field.dataType + '",' +
			nl(4) + '"id" : "' + field.id + '",' +
			nl(4) + '"name" : "' + field.name + '",'
		);
		for (var prop in field) {
			if (!"dataType".equals(prop) &&
				!"id".equals(prop) &&
				!"name".equals(prop)) {
				json.append(makeValueJson(field, prop) + ",")
			}
		}
		json.setLength(json.length() - 1);
		json.append(nl(3) + "},");
	}

	if (json.length() > 0) {
		json.setLength(json.length() - 1);
	}
	return json.toString();
}

function makeJson(jobj) {
	if (connector.getParam("object").startsWith("file")) {
		return toJson(jobj);
	}

	return toJson(jobj); // EH I have short-circuited the logic of this function

	var trueJSON = toJson(jobj);

	// EH the code below looks crappy to me

	var json = new java.lang.StringBuffer("{");
	for (var prop in jobj) {
		if (typeof jobj[prop] !== "object") {
			json.append(nl(1) + '"' + prop + '" : "' + jobj[prop] + '",');
		}
	}

	json.append(nl(1) + '"fields" : { ' + nl(2) + '"field" : [');

	json.append(makeFieldsJson(jobj.fields.field));

	json.append(nl(2) + "]" + nl(1) + "}" + nl(0) + "}");

	var thisJSON = json.toString();

	//logmsg()

	return thisJSON;
}

function isPrimaryParentIdValid(id) {
	var isValid = false;
	var typeDefnId = null;
	var reply = null;

	if (params.deBug) logmsg("DEBUG", "Verifying that the specified parent id is valid: " + id);

	if (!id || id === "" || params.invalidPrimaryParentIds.contains(id)) {
		return false;
	}
	if (params.validPrimaryParentIds.contains(id)) {
		return true;
	}

	// the id must be a number
	try {
		system.toInt(id);
	} catch (e0) {
		params.invalidPrimaryParentIds.add(id);
		return false;
	}

	// The specified id is not yet known to the connector; try getting it to ensure it exists
	try {
// _timer.start("OpenPages Connector - isPrimaryParentIdValid()" );
		reply = makeRequest({
			verb: "GET",
			url: "/contents/" + id,
			where: "isPrimaryParentIdValid"
		});
		typeDefnId = reply.typeDefinitionId;
	} catch (e1) {
		reply = null;
		if (params.deBug) logmsg("DEBUG", "Exception occurred; details:\n" + e1);
	}
// _timer.stop("OpenPages Connector - isPrimaryParentIdValid()" );

	if (reply === null || typeof reply.id === "undefined" || reply.id !== id) {
		isValid = false;
	}

	// Verify the object is a parent 'type' based on its typeDefinitionId and associations
	else {
		try {
// _timer.start("OpenPages Connector - isPrimaryParentIdValid()" );
			reply = makeRequest({
				verb: "GET",
				url: "/types/" + params.object + "/associations/parents",
				where: "isPrimaryParentIdValid"
			});
		} catch (e2) {
			reply = null;
			isValid = false;
			if (params.deBug) logmsg("DEBUG", "Exception occurred; details:\n" + e2);
		}
// _timer.stop("OpenPages Connector - isPrimaryParentIdValid()" );

		// The entry with the matching id must have a relationship of "Parent"
		for (var i = 0; reply !== null && i < reply.length; i++) {
			if (reply[i].id === typeDefnId && reply[i].relationship.trim().toLowerCase() === "parent") {
				isValid = true;
				break;
			}
		}
	}

	if (isValid === true) {
		params.validPrimaryParentIds.add(id);
	} else {
		params.invalidPrimaryParentIds.add(id);
	}

	return isValid;
}

// Send an email if mail has been configured
function sendEmailNotification(error) {
	var didSend = false;
	var alreadySent = mailSettings.notificationsSent.contains(error);

	if (mailSettings.smtpHost != "" && alreadySent === false) {
		didSend = system.sendMail(mailSettings.mailFrom, mailSettings.mailTo,
			mailSettings.mailSubject,
			"Additional instances of this error will not be reported via email for the " +
			"current scheduled run.\n\nReported Issue:\n\n" + error,
			null);

		// remember this error to avoid mailing duplicates for this assembly line run
		mailSettings.notificationsSent.add(error);
		java.lang.Thread.sleep(100); // avoids overwhelming the SMTP server

		if (didSend !== null) {
			logmsg("WARN", "Attempt to send email was not successful for message [" + error + "]\n\tReason: " + didSend);
		}
	}
}

// Ancient history for this component
//
//var version = "20140910 1730" // started
//var version = "20140923 1830" // Added paged reads and fixed bugs with Brian Laskey
//var version = "20141001 1235" // Started work on putEntry
//var version = "20141002 1828" // getting Types and Templates now
//var version = "20141003 1111" // added uri root parameter
//var version = "20141007 1030" // iterator and add mode
//var version = "20141008 1344" // update mode started
//var version = "20141009 1710" // update mode working
//var version = "20141013 1421" // fixed GRC object creation
//var version = "20141013 2321" // added delete mode
//var version = "20141014 1412" // connector uses Type setting if typeDefinitionId not mapped for add operation
//var version = "20150617 1439" // added logic to process parent type and parent location properties
//var version = "20150619 1044" // added logic to process primaryParentId and prevent orphaned incidents
//var version = "20150625 1731" // added try/catch's for makeRequest()'s that did not yet have them
//var version = "20150714 1243" // added form fields and logic for sending email notifications from connectors
//var version = "20150717 1520" // Corrected the REST api call to confirm the parent association
//var version = "20150730 1335" // Extended logic that processes date/time values to use another format string
//var version = "20150805 1718" // Converted over to using connector.properties file
//var version = "20150807 1503" // Re-worked WARN messages regarding properties for invalid primaryParentId to also send email notification
//var version = "20150812 1337" // Restored original date/time format string and adjusted the logic to format it
//var version = "20150826 1332" // Added dynamic derivation of primaryParentId using mapped properties for parent type and location
//var version = "20150904 1155" // Enhanced currency handling to take a value and its associated ISO code
//var version = "20151102 1410" // Added support for: BOOLEAN_TYPE, FLOAT_TYPE, MEDIUM_STRING_TYPE, LARGE_STRING_TYPE
//var version = "20160421 1710" //Added plave holder for the future change of ucf_integration
//var version = "20160801 1210" //Added logic segment that merge all citation parents' guidence value for ucf_integration - control
//var version = "20160812 1050";  //Added logic segment that retrive all control parents' information for ucf_integration - control
//var version = "20200527 1136";  //Replaced ConcurrentHashMaps with HashMaps and fixed Connect/Next from CE
//var version = "20200529 1403";  //Connector now returns new Resource ID in conn Entry for adds (putEntry) - can access in After Add Hook
//var version = "20200502 1351"; // Added support for writing files (word, excel, etc)
//var version = "20200602 1456"; // Handling file types correctly now when adding as attachments to OpenPages
//var version = "20200604 2046"; // Fixed bug in entrytoGrcObject thanks to Blade
//var version = "20200605 1638"; // putEntry returns new Resource ID
//var version = "20200609 1903"; // made putEntry store the entire newly created entry (response from add) in the last_conn variable
//var version = "20200610 2018"; // trying to add support for complex queries (i.e. PARENT or CHILD joins)
//var version = "20200615 1544"; // fixed putEntry for adding objectType file so default is word doc
//var version = "20200625 1249"; // Added params.refresh() to start of ensureInitialized() function
//var version = "20200625 1300"; // Changed addGrcSystemField to not null out the typeDefinitionId property of grcObj
//var version = "20200625 1309"; // parseReply() now ignores the body if the http.resultCode is 404
//var version = "20200625 1346"; // fixed double incrementing of this.index in resultSet.next function]]></parameter>
                <parameter name="shareSchema">true</parameter>
                <parameter name="smtpPort">25</parameter>
                <parameter name="url">@SUBSTITUTE{property.OpenPagesAssets:op.url}</parameter>
                <parameter name="user"/>
                <parameter name="username">@SUBSTITUTE{property.OpenPagesAssets:op.username}</parameter>
                <parameter name="view"/>
            </Configuration>
            <ComputeChanges>false</ComputeChanges>
            <Parser>
                <InheritFrom>[parent]</InheritFrom>
            </Parser>
            <AttributeMap name="Input">
                <InheritFrom>[parent]</InheritFrom>
            </AttributeMap>
            <AttributeMap name="Output">
                <InheritFrom>[parent]</InheritFrom>
            </AttributeMap>
            <DeltaSettings>
                <WhenToCommit>After every database operation</WhenToCommit>
                <RowLocking>SERIALIZABLE</RowLocking>
                <ChangeDetectionMode>DETECT_ALL</ChangeDetectionMode>
            </DeltaSettings>
            <Schema name="Input">
                <InheritFrom>[parent]</InheritFrom>
                <SchemaItem>
                    <Name>$grcObject</Name>
                    <NativeSyntax>JavaScript Object</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>$grcObjectJSON</Name>
                    <NativeSyntax>JSON</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>$grcObjectType</Name>
                    <NativeSyntax>String</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>Comment</Name>
                    <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>Created By</Name>
                    <NativeSyntax>Integer (read only)</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>Creation Date</Name>
                    <NativeSyntax>Date (read only)</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>Description</Name>
                    <NativeSyntax>String</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>GTS-AccountValidation:Child Validation Message</Name>
                    <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>GTS-AccountValidation:Revalidation Overdue</Name>
                    <NativeSyntax>String</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>GTS-AccountValidation:Team Member List</Name>
                    <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>GTS-AccountValidation:Validation Comments</Name>
                    <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>GTS-AccountValidation:Validation Completed By</Name>
                    <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>GTS-AccountValidation:Validation Completion Date</Name>
                    <NativeSyntax>Date</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>GTS-AccountValidation:Validation Due Date</Name>
                    <NativeSyntax>Date</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>GTS-AccountValidation:Validation Instructions</Name>
                    <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>GTS-AccountValidation:Validation Message</Name>
                    <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>GTS-AccountValidation:Validation Start Date</Name>
                    <NativeSyntax>Date</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>GTS-AccountValidation:Validation Status</Name>
                    <NativeSyntax>String</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>GTS-Pol-Shared:TCompareHelper</Name>
                    <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>GTS-Pol-Shared:TDocGenHelper</Name>
                    <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>GTS-Policy:Additional Ctl</Name>
                    <NativeSyntax>String (multi-valued)</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>GTS-Policy:Change Comment</Name>
                    <NativeSyntax>Large size String (limited to configured maximum)</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>GTS-Policy:Customer Rep</Name>
                    <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>GTS-Policy:DPE</Name>
                    <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>GTS-Policy:Quality Review Comment</Name>
                    <NativeSyntax>Medium size String (limited to 32000 characters)</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>GTS-Policy:Regulatory Ctl</Name>
                    <NativeSyntax>String (multi-valued)</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>GTS-Policy:TPolRef</Name>
                    <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>GTS-Policy:TRenewalHelper</Name>
                    <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>GTS-WF-Shared:TAssignee</Name>
                    <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>GTS-WF-Shared:TComment</Name>
                    <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>Last Modification Date</Name>
                    <NativeSyntax>Date (read only)</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>Last Modified By</Name>
                    <NativeSyntax>Integer (read only)</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>Location</Name>
                    <NativeSyntax>String (limited to 4000 characters) (read only)</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>Name</Name>
                    <NativeSyntax>String (limited to 4000 characters) (read only)</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>OPSS-Assert:Assertions</Name>
                    <NativeSyntax>String (multi-valued)</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>OPSS-Pol:Approval Date</Name>
                    <NativeSyntax>Date</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>OPSS-Pol:Approval Status</Name>
                    <NativeSyntax>String</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>OPSS-Pol:Approved By</Name>
                    <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>OPSS-Pol:AttestReq</Name>
                    <NativeSyntax>String</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>OPSS-Pol:Author</Name>
                    <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>OPSS-Pol:Change Significance</Name>
                    <NativeSyntax>String</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>OPSS-Pol:Common Name</Name>
                    <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>OPSS-Pol:CreatePolicy</Name>
                    <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>OPSS-Pol:Definitions LT</Name>
                    <NativeSyntax>Medium size String (limited to 32000 characters)</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>OPSS-Pol:Effective Date</Name>
                    <NativeSyntax>Date</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>OPSS-Pol:Expiration Date</Name>
                    <NativeSyntax>Date</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>OPSS-Pol:Footer</Name>
                    <NativeSyntax>Medium size String (limited to 32000 characters)</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>OPSS-Pol:Header</Name>
                    <NativeSyntax>Medium size String (limited to 32000 characters)</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>OPSS-Pol:Hold Until</Name>
                    <NativeSyntax>Date</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>OPSS-Pol:IssueDept</Name>
                    <NativeSyntax>String</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>OPSS-Pol:Legal Hold</Name>
                    <NativeSyntax>String</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>OPSS-Pol:Next Review Date</Name>
                    <NativeSyntax>Date</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>OPSS-Pol:OpenPolicyRevision</Name>
                    <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>OPSS-Pol:Owner</Name>
                    <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>OPSS-Pol:Policy In Revision</Name>
                    <NativeSyntax>String</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>OPSS-Pol:Published Date</Name>
                    <NativeSyntax>Date</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>OPSS-Pol:Publishing Details</Name>
                    <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>OPSS-Pol:Publishing Status</Name>
                    <NativeSyntax>String</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>OPSS-Pol:Purpose LT</Name>
                    <NativeSyntax>Medium size String (limited to 32000 characters)</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>OPSS-Pol:References LT</Name>
                    <NativeSyntax>Medium size String (limited to 32000 characters)</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>OPSS-Pol:ReopenPolicy</Name>
                    <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>OPSS-Pol:Retention Schedule</Name>
                    <NativeSyntax>String</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>OPSS-Pol:Retired Date</Name>
                    <NativeSyntax>Date</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>OPSS-Pol:RevDesc</Name>
                    <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>OPSS-Pol:Revision Type</Name>
                    <NativeSyntax>String</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>OPSS-Pol:Roles LT</Name>
                    <NativeSyntax>Medium size String (limited to 32000 characters)</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>OPSS-Pol:RunTrigger</Name>
                    <NativeSyntax>String</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>OPSS-Pol:Scope LT</Name>
                    <NativeSyntax>Medium size String (limited to 32000 characters)</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>OPSS-Pol:Statement LT</Name>
                    <NativeSyntax>Medium size String (limited to 32000 characters)</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>OPSS-Pol:Status</Name>
                    <NativeSyntax>String</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>OPSS-Pol:Type</Name>
                    <NativeSyntax>String</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>OPSS-Pol:Version</Name>
                    <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>OPSS-Pol:Version Date</Name>
                    <NativeSyntax>Date</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>OPSS-Pol:ViewPolicy</Name>
                    <NativeSyntax>String (limited to 4000 characters)</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>Orphan</Name>
                    <NativeSyntax>String (limited to 4000 characters) (read only)</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>Resource ID</Name>
                    <NativeSyntax>Integer (Id) (read only)</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>parentFolderId</Name>
                    <NativeSyntax>Integer (Id)</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>primaryParentId</Name>
                    <NativeSyntax>Integer (Id)</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>typeDefinitionId</Name>
                    <NativeSyntax>Integer (Id)</NativeSyntax>
                </SchemaItem>
            </Schema>
            <Schema name="Output">
                <InheritFrom>[parent]</InheritFrom>
            </Schema>
            <LinkCriteria>
                <InheritFrom>[parent]</InheritFrom>
            </LinkCriteria>
            <Hooks>
                <InheritFrom>[parent]</InheritFrom>
                <Hook name="default_fail">
                    <InheritFrom>/Scripts/Hook_Default_On_Error</InheritFrom>
                    <Name>default_fail</Name>
                    <Enabled>true</Enabled>
                </Hook>
                <Hook name="initialize_fail">
                    <InheritFrom>/Scripts/Hook_On_Error</InheritFrom>
                    <Name>initialize_fail</Name>
                    <Enabled>true</Enabled>
                </Hook>
            </Hooks>
            <CheckpointConfig/>
            <SandboxConfig/>
            <Reconnect>
                <InheritFrom>[parent]</InheritFrom>
                <parameter name="autoreconnect">false</parameter>
                <parameter name="numberOfRetries">10</parameter>
                <parameter name="retryDelay">5</parameter>
                <ReconnectRules/>
            </Reconnect>
            <Operations/>
            <PoolDefinition>
                <InheritFrom>[parent]</InheritFrom>
                <Enabled>false</Enabled>
                <MinPoolSize>0</MinPoolSize>
                <MaxPoolSize>0</MaxPoolSize>
                <PurgeInterval>0</PurgeInterval>
                <InitializeAttempts>1</InitializeAttempts>
                <InitializeSleepInterval>0</InitializeSleepInterval>
            </PoolDefinition>
            <PoolInstance/>
        </Connector>
        <Connector name="ePolicy_db">
            <InheritFrom>system:/Connectors/ibmdi.JDBC</InheritFrom>
            <ModTime>1598727971787</ModTime>
            <ConnectorMode>Iterator</ConnectorMode>
            <ConnectorState>Enabled</ConnectorState>
            <Configuration>
                <UserComment>fixing</UserComment>
                <InheritFrom>[parent]</InheritFrom>
                <ModTime>1598727971787</ModTime>
                <parameter name="custom.database">POLICYL</parameter>
                <parameter name="custom.form">1</parameter>
                <parameter name="custom.hostname">mopbzp174025.fr.dst.ibm.com</parameter>
                <parameter name="custom.port">50000</parameter>
                <parameter name="jdbcDriver">com.ibm.db2.jcc.DB2Driver</parameter>
                <parameter name="jdbcLogin">* missing setting *</parameter>
                <parameter encrypted="true" name="jdbcPassword">FFmKJQ8eWMfQZdumTL/BpcYhf6xhU/ppvzdjV2+MWJVnYu2hLThSd1oPeShSoTSkAi0h4e/d+4s22l98vQRfetH3yF7yAIhweo/h0ulR2Xjc8rcFoFQV50qHOk3tfX+Djx5w4dsMuVeGulg1Xa4zZYdKtwIjr1SipYx8JVVIcVA=</parameter>
                <parameter name="jdbcSchema">EPOLICY</parameter>
                <parameter name="jdbcSource">* missing setting *</parameter>
                <parameter name="jdbcTable">evidence</parameter>
            </Configuration>
            <Parser>
                <InheritFrom>[parent]</InheritFrom>
            </Parser>
            <AttributeMap name="Input">
                <InheritFrom>[parent]</InheritFrom>
            </AttributeMap>
            <AttributeMap name="Output">
                <InheritFrom>[parent]</InheritFrom>
            </AttributeMap>
            <DeltaSettings>
                <UniqueAttribute/>
                <WhenToCommit>After every database operation</WhenToCommit>
                <RowLocking>SERIALIZABLE</RowLocking>
                <ChangeDetectionMode>DETECT_ALL</ChangeDetectionMode>
            </DeltaSettings>
            <Schema name="Input">
                <InheritFrom>[parent]</InheritFrom>
            </Schema>
            <Schema name="Output">
                <InheritFrom>[parent]</InheritFrom>
                <SchemaItem>
                    <Name>BASE_RR</Name>
                    <Syntax>java.lang.String</Syntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>COMMENT</Name>
                </SchemaItem>
                <SchemaItem>
                    <Name>CUST_XYZ</Name>
                    <Syntax>java.lang.String</Syntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>DATA</Name>
                    <Syntax>[B</Syntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>DELAYED</Name>
                    <Syntax>java.lang.String</Syntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>DELETED_TS</Name>
                </SchemaItem>
                <SchemaItem>
                    <Name>ENVIRONMENT</Name>
                    <Syntax>java.lang.String</Syntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>EVIDENCE_TYPE_ID</Name>
                    <Syntax>java.lang.Integer</Syntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>EXCEPTION</Name>
                    <Syntax>java.lang.String</Syntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>EXTRA_TYPE</Name>
                    <Syntax>java.lang.Integer</Syntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>FILE_NAME</Name>
                    <Syntax>java.lang.String</Syntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>FORM</Name>
                    <Syntax>[B</Syntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>FORMAT</Name>
                    <Syntax>java.lang.Integer</Syntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>IBM</Name>
                    <Syntax>java.lang.String</Syntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>ID</Name>
                    <Syntax>java.lang.Integer</Syntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>IMPORTED_FLAG</Name>
                    <Syntax>java.lang.String</Syntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>IS_DELETED</Name>
                    <Syntax>java.lang.String</Syntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>LAST_EDITOR</Name>
                    <Syntax>java.lang.String</Syntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>LOCKED_BY</Name>
                    <Syntax>java.lang.String</Syntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>LOCKED_FLAG</Name>
                    <Syntax>java.lang.String</Syntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>LOCKED_TS</Name>
                </SchemaItem>
                <SchemaItem>
                    <Name>NAME</Name>
                    <Syntax>java.lang.String</Syntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>OWNER_ID</Name>
                    <Syntax>java.lang.Integer</Syntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>POLICY_ID</Name>
                    <Syntax>java.lang.Integer</Syntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>REF</Name>
                    <Syntax>java.lang.String</Syntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>REVISION</Name>
                    <Syntax>java.lang.Integer</Syntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>REVISION_COUNT</Name>
                    <Syntax>java.lang.Integer</Syntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>STATUS_ID</Name>
                    <Syntax>java.lang.Integer</Syntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>TEMPLATE_ID</Name>
                    <Syntax>java.lang.Integer</Syntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>TEMPLATE_TYPE_ID</Name>
                    <Syntax>java.lang.Integer</Syntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>TEMPLATE_VERSION</Name>
                    <Syntax>java.lang.String</Syntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>UPDATED_BY</Name>
                    <Syntax>java.lang.String</Syntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>UPDATED_TS</Name>
                    <Syntax>java.sql.Timestamp</Syntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>XDOCUMENT_ID</Name>
                    <Syntax>java.lang.Integer</Syntax>
                </SchemaItem>
            </Schema>
            <LinkCriteria>
                <InheritFrom>[parent]</InheritFrom>
            </LinkCriteria>
            <Hooks>
                <InheritFrom>[parent]</InheritFrom>
            </Hooks>
            <CheckpointConfig/>
            <SandboxConfig/>
            <Reconnect>
                <InheritFrom>[parent]</InheritFrom>
                <ReconnectRules/>
            </Reconnect>
            <Operations/>
            <PoolDefinition>
                <InheritFrom>[parent]</InheritFrom>
                <ModTime>1597233205823</ModTime>
                <Enabled>false</Enabled>
                <MinPoolSize>5</MinPoolSize>
                <MaxPoolSize>10</MaxPoolSize>
                <PurgeInterval>0</PurgeInterval>
                <InitializeAttempts>1</InitializeAttempts>
                <InitializeSleepInterval>0</InitializeSleepInterval>
            </PoolDefinition>
            <PoolInstance/>
        </Connector>
        <Connector name="ePolicy_db_IW">
            <InheritFrom>system:/Connectors/ibmdi.JDBC</InheritFrom>
            <ModTime>1599245371092</ModTime>
            <ConnectorMode>Iterator</ConnectorMode>
            <ConnectorState>Enabled</ConnectorState>
            <Configuration>
                <InheritFrom>[parent]</InheritFrom>
                <ModTime>1599245343199</ModTime>
                <parameter name="custom.database">POLICYL</parameter>
                <parameter name="custom.form">1</parameter>
                <parameter name="custom.hostname">mopbzp174025.fr.dst.ibm.com</parameter>
                <parameter name="custom.port">50000</parameter>
                <parameter name="jdbcDriver">com.ibm.db2.jcc.DB2Driver</parameter>
                <parameter name="jdbcLogin">db2inst1</parameter>
                <parameter name="jdbcPassword">Epolicy2ibm@123</parameter>
                <parameter name="jdbcSchema">ePolicy</parameter>
                <parameter name="jdbcSource">jdbc:db2://mopbzp174025.fr.dst.ibm.com:50000/POLICYL</parameter>
                <parameter name="jdbcTable">EVIDENCE</parameter>
            </Configuration>
            <Parser>
                <InheritFrom>[parent]</InheritFrom>
            </Parser>
            <AttributeMap name="Input">
                <InheritFrom>[parent]</InheritFrom>
            </AttributeMap>
            <AttributeMap name="Output">
                <InheritFrom>[parent]</InheritFrom>
            </AttributeMap>
            <DeltaSettings>
                <UniqueAttribute/>
                <WhenToCommit>After every database operation</WhenToCommit>
                <RowLocking>SERIALIZABLE</RowLocking>
                <ChangeDetectionMode>DETECT_ALL</ChangeDetectionMode>
            </DeltaSettings>
            <Schema name="Input">
                <InheritFrom>[parent]</InheritFrom>
                <ModTime>1599245371092</ModTime>
                <SchemaItem>
                    <Name>COMMENT</Name>
                </SchemaItem>
                <SchemaItem>
                    <Name>DATA</Name>
                    <Syntax>[B</Syntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>DELAYED</Name>
                    <Syntax>java.lang.String</Syntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>DELETED_TS</Name>
                    <NativeSyntax>TIMESTAMP</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>ENVIRONMENT</Name>
                    <NativeSyntax>VARCHAR</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>EVIDENCE_TYPE_ID</Name>
                    <Syntax>java.lang.Integer</Syntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>EXCEPTION</Name>
                    <Syntax>java.lang.String</Syntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>EXTRA_TYPE</Name>
                    <Syntax>java.lang.Integer</Syntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>FILE_NAME</Name>
                    <NativeSyntax>VARCHAR</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>FORM</Name>
                    <NativeSyntax>BLOB</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>FORMAT</Name>
                    <Syntax>java.lang.Integer</Syntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>ID</Name>
                    <Syntax>java.lang.Integer</Syntax>
                    <NativeSyntax>INTEGER</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>IMPORTED_FLAG</Name>
                    <NativeSyntax>VARCHAR</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>IS_DELETED</Name>
                    <NativeSyntax>CHAR</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>LOCKED_BY</Name>
                    <NativeSyntax>VARCHAR</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>LOCKED_FLAG</Name>
                    <NativeSyntax>CHAR</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>LOCKED_TS</Name>
                    <NativeSyntax>TIMESTAMP</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>NAME</Name>
                    <Syntax>java.lang.String</Syntax>
                    <NativeSyntax>VARCHAR</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>OWNER_ID</Name>
                    <NativeSyntax>INTEGER</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>POLICY_ID</Name>
                    <NativeSyntax>INTEGER</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>REVISION</Name>
                    <NativeSyntax>INTEGER</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>REVISION_COUNT</Name>
                    <NativeSyntax>INTEGER</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>STATUS_ID</Name>
                    <NativeSyntax>INTEGER</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>TEMPLATE_ID</Name>
                    <NativeSyntax>INTEGER</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>TEMPLATE_TYPE_ID</Name>
                    <NativeSyntax>INTEGER</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>TEMPLATE_VERSION</Name>
                    <NativeSyntax>CHAR</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>UPDATED_BY</Name>
                    <Syntax>java.lang.String</Syntax>
                    <NativeSyntax>VARCHAR</NativeSyntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>UPDATED_TS</Name>
                    <Syntax>java.sql.Timestamp</Syntax>
                    <NativeSyntax>TIMESTAMP</NativeSyntax>
                </SchemaItem>
            </Schema>
            <Schema name="Output">
                <InheritFrom>[parent]</InheritFrom>
                <ModTime>1599245371092</ModTime>
                <SchemaItem>
                    <Name>COMMENT</Name>
                </SchemaItem>
                <SchemaItem>
                    <Name>DATA</Name>
                    <Syntax>[B</Syntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>DELAYED</Name>
                    <Syntax>java.lang.String</Syntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>EVIDENCE_TYPE_ID</Name>
                    <Syntax>java.lang.Integer</Syntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>EXCEPTION</Name>
                    <Syntax>java.lang.String</Syntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>EXTRA_TYPE</Name>
                    <Syntax>java.lang.Integer</Syntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>FORMAT</Name>
                    <Syntax>java.lang.Integer</Syntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>ID</Name>
                    <Syntax>java.lang.Integer</Syntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>NAME</Name>
                    <Syntax>java.lang.String</Syntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>UPDATED_BY</Name>
                    <Syntax>java.lang.String</Syntax>
                </SchemaItem>
                <SchemaItem>
                    <Name>UPDATED_TS</Name>
                    <Syntax>java.sql.Timestamp</Syntax>
                </SchemaItem>
            </Schema>
            <LinkCriteria>
                <InheritFrom>[parent]</InheritFrom>
            </LinkCriteria>
            <Hooks>
                <InheritFrom>[parent]</InheritFrom>
            </Hooks>
            <CheckpointConfig/>
            <SandboxConfig/>
            <Reconnect>
                <InheritFrom>[parent]</InheritFrom>
                <ReconnectRules/>
            </Reconnect>
            <Operations/>
            <PoolDefinition>
                <InheritFrom>[parent]</InheritFrom>
                <Enabled>false</Enabled>
                <MinPoolSize>0</MinPoolSize>
                <MaxPoolSize>0</MaxPoolSize>
                <PurgeInterval>0</PurgeInterval>
                <InitializeAttempts>1</InitializeAttempts>
                <InitializeSleepInterval>0</InitializeSleepInterval>
            </PoolDefinition>
            <PoolInstance/>
        </Connector>
    </Folder>
    <Folder name="Parsers"/>
    <Folder name="Scripts">
        <Script name="ClauseControlObj">
            <ModTime>1607078896157</ModTime>
            <parameter name="enabled">true</parameter>
            <parameter name="includeFiles"/>
            <parameter name="script"><![CDATA[var ClauseControlObj = function(args) {
//	this.vrs = "20200701 1049"; // Initial version
	//this.vrs = "20200701 1817"; // Finding latest published policy template
	//this.vrs = "20200702 1538"; // Storing Templace Clauses in a map and providing getTemplateClause() method
	//this.vrs = "20200805 2241"; // added timings
	//this.vrs = "20200903 1456"; // added policyTemplateId() function
	//this.vrs = "20200904 1825"; // not reading in Clause Controls from Policy Template (for now)
	this.vrs = "20201110 1640"; // fixed passing in openPagesObj
	
	args = args || {};
	
	this.debug = args.debug || false;
	
	this.timer = typeof timer != "undefined" ? timer : {start: function() {}, stop: function() {}, timers: function() {return {} }};
	this.op = args.openPagesObj || new OpenPagesObj();
	this.validateClauseControls = args.validate || false;
	this.ccMap = new java.util.HashMap();
	this.clauseMap = new java.util.HashMap();
	this.templatePolicy = null;
	this.mandatoryClauses = [
							"Introduction", 
							"Scope", 
							"Processes used in this document",
							"Document structure",
							"Appendices"
							//"Technical Specifications"
							];
	

	this.log = function(lvl, msg, throwit) {
		throwit = throwit || false;
		if (typeof lvl == "undefined") {
			msg = "";
			lvl = "INFO";
		} else
		if (typeof msg == "undefined") {
			msg = lvl;
			lvl = "INFO";
		}
		
		log(lvl, "[ClauseControlObj] " + msg);
		if (throwit) throw "[ClauseControlObj] " + msg;
	}
	
	this.findClauseControl = function(code) {
		return this.ccMap.get(code);
	}
	
	this.getTemplateClause = function(clause) {
		return this.clauseMap.get(String(clause || "").toLowerCase());
	}
	
	this.policyTemplateId = function() {
		return this.templatePolicy.getString("Resource ID");
	}
	
	this.initialize = function() {
		this.log(" v" + this.vrs);
		
		var useTemplate = system.getTDIProperty("policy.template");
		if (useTemplate == null) {
			this.log("FATAL", "The policy.template property is not set!", true);
		}
		
		//if (this.readCache(useTemplate)) {
		//	return;
		//}

		this.timer.start("initializing ClauseControlObj");
		var templatePolicy = null;
		var lastVersion = '';
	
		var list = this.op.query("select * from [GTSLibPolicy]");
 		for(var temp in list)
		{
			//this.log(temp);
			// Commented out this as we need to use POLT-50 for testing
//			if("Published".equalsIgnoreCase(temp.getString("GTS-LibPolicy:Status")))
//			{
//				var version = temp.getString("GTS-LibPolicy:Version");
//				if(version > lastVersion)
//				{
//					templatePolicy = temp;
//					lastVersion = version;
//				}
//			}
		 // Hard-coding for now 
		 if(useTemplate.equalsIgnoreCase(temp.getString("Name"))){
		 	var version = temp.getString("GTS-LibPolicy:Version");
			if(version > lastVersion)
			 {
			  templatePolicy = temp;
			  lastVersion = version;
			}
		 } 
		}

//		templatePolicy = this.op.findOne("Name", useTemplate, {grcObjectType: "GTSLibPolicy"}); // Does not seem to work

		if(templatePolicy == null) {
			this.log("FATAL","Could not find published policy template in OpenPages",true);
		} else
		if(!"Published".equalsIgnoreCase(templatePolicy.getString("GTS-LibPolicy:Status"))) {
			this.log("FATAL","The specified Policy Template is not Published: " + useTemplate,true);
		}
		
		
		this.log("Found Template Policy: " + templatePolicy.name + " - " + templatePolicy["Resource ID"]);
		this.templatePolicy = templatePolicy;

		// If this is a migrate operation, then do not perform Template Clause Control validation
		if (!this.validateClauseControls) {
			this.log("NOT reading in Template Clause Controls...")
			this.timer.stop("initializing ClauseControlObj");
			
			return;
		}

		var duplicates = [];
		var templateClauses = this.op.findChildren("GTSLibPolicy",
											templatePolicy.getString("Resource ID"),
											"GTSLibClause");
		for (var tc in templateClauses) {
			this.log("Found Template Clause: " + tc.description);
			if (this.debug) this.log("----- Found Template Clause: " + tc.name + " - " + tc["Resource ID"] + " - " + tc.description);
			
			var description = tc.getString("description") || "*no_template_clause_description_found*";
			var p = description.indexOf(" ");
			var procedureIndex = -1;
			if (p > 0 && p < 4) {
				var indexStr = description.substring(0,p).trim();
				if (system.isValidInt(indexStr)) {
					procedureIndex = system.toInt(indexStr);
					description = description.substring(p+1).trim().toLowerCase();
				}
			}
			if (procedureIndex == -1) {
				if (description.substring(1,2) == ".") {
					procedureIndex = description.substring(0, 1);
					description = description.substring(2).trim().toLowerCase();
				} else {
					description = description.trim().toLowerCase();
				}
			}
			this.clauseMap.put(description, tc);
			
			var controlTopics = this.op.findChildren("GTSLibClause",
											tc.getString("Resource ID"),
											"GTSCtlTopic");
											
			for (var ct in controlTopics) {
				//this.log("	 Found Control Topic: " + ct);
				if (this.debug) this.log("		   Found Control Topic: " + ct.Name + " - " + ct["Resource ID"]);
				
				var templateClauseControls = this.op.findChildren("GTSCtlTopic",
															ct.getString("Resource ID"),
															"GTSLibClauseCtl");
				for (var tcc in templateClauseControls) {
					//this.log("				Found Template Clause Controls: " + tcc);
					if (this.debug) this.log("				  Found Template Clause Control: " + tcc.description);
					var tccId = tcc.getString("description");
					tcc.controlTopic = ct;
					tcc.templateClause = tc;
					tcc.templatePolicy = templatePolicy;
					
					var oldCC = this.ccMap.get(tccId);
					if (oldCC != null) {
						duplicates.push(tccId);
					}
					
					this.ccMap.put(tccId, tcc);
				}
			}
		}
		
		if (duplicates.length > 0) {
			this.log("Validation failed. Multiple Template Clause Controls found with same REF: " + duplicates.join(", "), true);
		}
		
		// Check that mandatory clauses are defined for the Policy Template
		var missingClauses = [];
		for (var clauseIndex in this.mandatoryClauses) {
			var mandatoryClause = this.mandatoryClauses[clauseIndex];
			
			var templateClause = this.getTemplateClause(mandatoryClause);
				
			if (templateClause == null) {
				missingClauses.push(mandatoryClause);
			}
		}
		if (missingClauses.length > 0) {
			this.timer.stop("initializing ClauseControlObj");
			this.log("FATAL", "The following mandatory clause(s) are missing from the Policy Template: " + missingClauses.join(", "), true);
		}
		
		//this.saveCache(useTemplate);
		
		this.timer.stop("initializing ClauseControlObj");
	}
	
	// ------ initialization code below
	
	this.initialize();
	
	return this;
}]]></parameter>
        </Script>
        <Script name="DeviationsMap">
            <ModTime>1608233671449</ModTime>
            <parameter name="includeFiles"/>
            <parameter name="script"><![CDATA[// DeviationMap is used to read in Clause Controls and compare with those in OpenPages, generating a HashMap with details
// about differences.
//
// The argument 'args' can hold the following properties:
//		- op - an initialized OpenPagesObj
//		- db - an initialized ePolicyObj
//		- id - (optional) the id of the Policy the deviation Map should be based on
//				if not passed, the deviation Map will be between ePolicy and the Policy Template info in OpenPages
//
var DeviationMap = function(args) {
//	this.vrs = "20200924 1249"; // Initial version
//	this.vrs = "20200928 1322"; // Fixed error in switching Ref columns for missing records - thanks to Blade
//	this.vrs = "20200929 1316"; // Added mapOfUpdates() method for updating CCs in OpenPages
//	this.vrs = "20201001 1508"; // Added name & id property to object in ccMap, devMap and return of mapOfUpdates() + duplicate ref handling + getCCType() function added
//	this.vrs = "20201005 1328"; // Stopped turning null values into 'null' string value
//	this.vrs = "20201006 1313"; // Improved cxhange storage (devMap)
//	this.vrs = "20201008 1502"; // Fixed to track all Clauses read for a Policy, including those with no changes to Clause Controls
//	this.vrs = "20201015 1345"; // Changed dev tracking to compare mapped ePolicy value (col3 & 4) with that of OpenPages
//	this.vrs = "20201015 1639"; // Fixed getCCType()
//	this.vrs = "20201019 1507"; // Change diff calculation to never update Col3 or Col4 from Template, but only from ePolicy, otherwise NA
//	this.vrs = "20201028 1317"; // Updated Migration Log column headers, as well as diff calculation logic
//	this.vrs = "20201031 1509"; // Corrected dev generation after introducing new mapping rules and workbook column header order
//	this.vrs = "20201105 1119"; // Fixed handling of Clause Controls with feedback from Blade	
//	this.vrs = "20201110 1258"; // Corrected R&R Col3 and Col4 to show mapped value in Migration Log
//	this.vrs = "20201110 1941"; // Removing rows from Migration Log workbook if no Condition set
//	this.vrs = "20201111 1102"; // Ensuring for RR types that if ePolicy CC is not found, values are NA for col3 and col4
//	this.vrs = "20201111 1152"; // Converting back bullet symbol from whatever UTF-8 encoding changes it to (REST call from OP)
//	this.vrs = "20201111 1258"; // Walked back previous change since OpenPages Connector now uses UTF-8 encoding
//	this.vrs = "20201124 1452"; // Added No Change entries to MigrationLog
//	this.vrs = "20201201 1346"; // Stopped doing mapping/control of ePolicy values
//	this.vrs = "20201214 2022"; // Corrected some local variable use in for-loops
//	this.vrs = "20201217 1406"; // Fixed a bug where epValue was being set from opObj
//	this.vrs = "20201217 1523"; // Affixed the New Rule for CC mapping EVERYWHERE now
//	this.vrs = "20201217 1650"; // Corrected Migration Log by replacing all whitespace and lowercasing before checking differences
//	this.vrs = "20201217 1726"; // Fixed replaceAll which needed backslash escaped
	this.vrs = "20201217 2034"; // Correctly comparing columns for Migration Log by removing newlines
	
	this.op = args.op || null;
	this.db = args.db || null;
	this.id = args.id || null;
	this.mappingTable = args.mappingTable || {};
	
	// Local properties
	this.opRefIndex = 0;
	this.epRefIndex = 1;
	this.ccTypes = {
		RV: {
			name: "Recommended Values",
			fieldNames: ["ePolicy Reference", // col1
						"OpenPages Reference",
						"Condition", 
						"ePolicy Agreed To Requirement", // col2
						"OpenPages Agreed To Requirement", 
						"ePolicy IBM Recommended Value", // col3
						"OpenPages IBM Recommended Value", 
						"ePolicy Customer Value", // col4
						"Migrated Customer Value" ],
			attributeNames: {},
			map: ["epObj.ref",
					"opObj.ref",
					"condition",
					"epObj.col2",
					"opObj.col2",
					"epObj.col3",
					"opObj.col3",
					"epObj.col4",
					"opObj.col4"],
			checkFields: [3,4,5,6,7,8]
		},
		RR: {
			name: "Roles & Responsibilities",
			fieldNames: ["ePolicy Reference", // col1
						"OpenPages Reference", 
						"Condition", 
						"ePolicy Base R&R", // col2
						"OpenPages Base R&R", 
						"ePolicy IBM R&R", // col3
						"Migrated IBM R&R",
						"ePolicy Customer R&R", // col4
						"Migrated Customer R&R"],
			attributeNames: {},
			map: ["epObj.ref",
					"opObj.ref",
					"condition",
					"epObj.col2",
					"opObj.col2",
					"epObj.col3",
					"opObj.col3",
					"epObj.col4",
					"opObj.col4"],
			checkFields: [3,4,5,6,7,8]
		}
	};
	
	this.epMap = {};
	this.epList = {};
	this.opMap = {};
	this.opClauseMap = new java.util.HashMap();
	this.opList = {};
	this.opCCTypeCount = {};
	this.devMap = null;
	this.workbook = null;
	this.devMap = {};
	this.diffs = {}; // For storing the difference between ePolicy and OpenPages for col3 and col4
	
	// Local log function
	this.log = function(lvl, msg, throwit) {
		throwit = throwit || false;
		
		if (typeof lvl == "undefined") {
			msg = "";
			lvl = "INFO";
		} else
		if (typeof msg == "undefined") {
			msg = lvl;
			lvl = "INFO";
		}
		
		log(lvl, "[DeviationMap] " + msg);
		
		if (throwit) throw "[DeviationMap] " + msg;
	}

	// Initialization method
	this.initialize = function() {
		this.log("v" + this.vrs);
		this.gatherControlClausesFromEPolicy();
		this.gatherControlClausesFromOpenPages();
		
		
		for (var ccType in this.ccTypes) {
			var fieldNames = this.ccTypes[ccType].fieldNames;
			var cnt = 1;
			for (var fld = 1; fld < fieldNames.length; fld++) {
				this.ccTypes[ccType].attributeNames[fieldNames[fld]] = "GTS-ClauseCtl:Col" + cnt++;
			}
		}
	} 
		
	// Collects Clause Controls from ePolicy
	this.gatherControlClausesFromEPolicy = function() {
		this.log("Gathering Clause Controls from ePolicy...");
		
		// Read Clause controls from epolicy for each type, RR and RV
		for (var ccType in this.ccTypes) {
			this.epList[ccType] = db.query("control_clause_" + ccType.toLowerCase(), CSD);
			this.epMap[ccType] = this.extractLatestClauseControlsForEPolicy(this.epList[ccType], ccType);
			
			this.log("Read " + this.epMap[ccType].size() + " " + this.ccTypes[ccType].name + " Clause Controls from ePolicy");
		}
	}	
	
	this.showJson = function(name, obj) {
		var props = new java.util.ArrayList();
		
		log(">> " + name);
		
		if (!obj) {
			log("    * undefined *");
			return;
		}
		
		for (var p in obj) {
			props.add(p)
		};
		var propList = props.toArray();
		java.util.Arrays.sort(propList);
		for (var prop in propList) {
			log( "   " + prop + ": " + obj[prop]);
		}
	}
	
	// Test the devObj
	this.lastRef = "";
	this.showDevObj = function(ref, devObj, epObj, opObj) {
		var err = "";
		
		this.log("-----------------------------------------");
		if (ref != this.lastRef) {
			log("=============== " + ref);
			this.lastRef = ref;
		}
		this.showJson("devObj", devObj);
		this.showJson("epObj", epObj);
		this.showJson("opObj", opObj);
		
		if (ref == "CL02-ST-CBR001") {
			err = "F R&R"
		} else 
		if (ref == "CL07-HR-RV001") {
			err = "H RV"
		} else
		if (ref == "CL08-MH-BRR005") {
			err = "cites erroneous text Please list them..."
		} else
		if (ref == "CL11-IC-BRR001") {
			err = "match with ePolicy, but listed as changes";
		} else
		if (ref == "CCL12-LA-BRR002") {
			err = "Col2 does not match ePolicy";
		} 
	}

	// Determine the type of the Control Clause based on the Entry or the Ref
	this.getCCType = function(args) {
		args = args || "";
		
		if (args instanceof com.ibm.di.entry.Entry) {
			var tableType = args.getString("GTS-ClauseCtl:Table Type");
			if (tableType) {
				return tableType;
			} else {
				args = args.getString("GTS-ClauseCtl:Col1")
			}
		} 
		
		var opEntry = this.opMap.RR.get(args);
		if (opEntry) {
			return "RR";
		}
		opEntry = this.opMap.RV.get(args);
		if (opEntry) {
			return "RV";
		}
		return null;
	}

	// Collects Clause Controls from OpenPages
	this.gatherControlClausesFromOpenPages = function(id) {
		id = id || this.id;
		var duplicates = {};
		
		this.log("Gathering Clause Controls from OpenPages...");

		// Find all Control Clauses for the Policy with Resource ID equal to the value of the 'id' argument
		var clauses = this.op.findChildren("Policy", id, "Procedure");
		
		timer.start("Collection Clause Controls from OpenPages");
		var start = java.lang.System.currentTimeMillis();
		
		for (var ccType in this.ccTypes) {
			this.opMap[ccType] = new java.util.HashMap();
			this.opCCTypeCount[ccType] = 0;
		}
		
		for (var clause in clauses) {
			var ccid = clause.getObject("Resource ID");
			var clauseName = clause.getString("Name");
			
			var clauseObj = {
				id: clause.getString("Resource ID"),
				name: clause.getString("Name"),
				desc: clause.getString("Description")
			};
			
			this.opClauseMap.put(clauseName, clauseObj);
			
			//log("Found: " + toJson(clauseObj));
			
			var controls = this.op.findChildren("Procedure", ccid, "GTSClauseCtl");
			for (var control in controls) {
				var ref = control.getString("GTS-ClauseCtl:Col1");
				var ccType = this.getCCType(control);
				var ccObj = {
					ref: ref,
					id: control.getString("Resource ID"),
					type: ccType,
					name: control.getString("Name"),
					col2: control.getString("GTS-ClauseCtl:Col2") || "",
					col3: control.getString("GTS-ClauseCtl:Col3")|| "",
					col4: control.getString("GTS-ClauseCtl:Col4") || "",
					location: control.getString("Location") || ""
				}
/*				
				if (ccObj.ref == "CL14-SD-CBR001") {
					log("Got it: " + toJson(ccObj) + "\n" + control);
				}
*/				

				var previouslyAdded = this.opMap[ccType].get(ccObj.ref);
				if (previouslyAdded != null) {
					if (!duplicates[ccObj.ref]) {
						duplicates[ccObj.ref] = [previouslyAdded.location];
					}
					duplicates[ccObj.ref].push(control.getString("Location"));
					//duplicates.push(ccObj.ref);
				}

				this.opMap[ccType].put(ccObj.ref, ccObj);
				this.opCCTypeCount[ccType]++;
			}
		}

		for (var ccType in this.ccTypes) {
			this.log("Read " + this.opCCTypeCount[ccType] + " " + this.ccTypes[ccType].name + " Clause Controls from OpenPages");
		}	

		var dups = [];
		for (var ref in duplicates) {
			dups.push("(REF: " + ref + ")<br/>\n" + duplicates[ref].join(" <br/>\n"));
		}		
		if (dups.length > 0) {
			this.log("ERROR", "Found multiple Template Clause Controls with the same REF): <br/>\n" + dups.join(" | <br/>\n"), true);
		}
		
		timer.stop("Collection Clause Controls from OpenPages");
		var end = java.lang.System.currentTimeMillis();
		log("\n\nTotal time to collect CCs from OpenPages: " + (end-start)/1000 + " seconds");
	}
	
	// Populate a new HashMap with only the latest Control Clauses
	this.extractLatestClauseControlsForEPolicy = function(ccList, ccType) {
		var addToMap = new java.util.HashMap();
		
		for (var cc in ccList) {
			var ref = cc.getString("REF");

			var prevRef = addToMap.get(ref);
			if (prevRef != null) {
				var thisRev = cc.getObject("REVISION");
				if (thisRev < prevRef.rev) {
					this.log("Skipping " + ref + " with revision: " + thisRev);
					continue;
				}
				var thisTS = cc.getObject("UPDATED_TS");
				if (thisTS < prevRef.ts) {
					this.log("Skipping " + ref + " with updated_ds: " + thisTS);
					continue;
				}
				addToMap.remove(ref);
			}
			var ccObj = {
				ref: ref,
				type: ccType,
				col2: cc.getString("BASE_RR") || cc.getString("REQUIREMENT") || "",
				col3: cc.getString("IBM") || cc.getString("REC_VALUE") || "",
				col4: cc.getString("CUST_XYZ") || ""
			};
/*
			// For RR types, apply map to Col 3 and Col 4 ("IBM" and "CUST_XYZ" fields from ePolicy)
			if (ccType == "RR") {
				ccObj.col3 = mapColumn(ccObj.col3);
			}
			ccObj.col4 = mapColumn(ccObj.col4);
*/			
			addToMap.put(ref, ccObj);
		}
	
		for (var ref in addToMap) {
			var ccObj = addToMap[ref];
		}
	
		return addToMap;
	}	

	// Generate the deviation map (this.devMap)
	// A deviation is one of the followingg
	//		- a CC in OpenPages is missing from ePolicy
	//		- a CC in ePolicy is missing from OpenPages
	//		- There is a difference between the values of specific fields in ePolicy and OpenPages
	//		- Values for Col 3 (for RR types) and Col 4 (for both) are not value. Must be P, A or NA.
	//		- Values for Col 3 and Col 4 for RV types both must be P, A or NA
	this.generateDeviationMap = function() {

		this.log("Detecting differences...");

		this.devMap = {
			RR: new java.util.HashMap(),
			RV: new java.util.HashMap()
		};
		
		this.clauseChanges = {
			RR: 0,
			RV: 0
		}
		
		var changeCnt = 0;
		
		for (var ccType in this.ccTypes) {
			// Note all CCs found in ePolicy, but not in OpenPages
			var epArray = this.epMap[ccType].keySet().toArray();
			java.util.Arrays.sort(epArray);
			for (var ref in epArray) {
				var epRef = ref;
				var opObj = this.opMap[ccType].get(ref);
				var epObj = this.epMap[ccType].get(ref);
				var devObj = null;

				var mappedRef = this.mappingTable[ref];
				if (mappedRef) {
					//epRef = mappedRef;
					opObj = opMap.get(epRef);
				}

				//epObj.ref = epRef; // Save the mapped ref (in case it was mapped in the above if-statement) in the epObj
				
				// Check if missing in OpenPages
				if (opObj == null) {
					var devObj = devObj || {ref: ref};
					devObj.Condition = "Missing in OpenPages";
					opObj = {};

					// If not found in OpenPages, include the check-fields from ePolicy for the Migration Log
					for (var i = 0; i < this.ccTypes[ccType].checkFields.length; i++) {
						var checkThisField = this.ccTypes[ccType].checkFields[i];
						var opValue = (eval(this.ccTypes[ccType].map[checkThisField]) || "");
						devObj[this.ccTypes[ccType].fieldNames[checkThisField]] = opValue || "";
						devObj[this.ccTypes[ccType].fieldNames[checkThisField] + 1] = ""; // Set the OpenPages field to blank
						i++;
					}

					this.devMap[ccType].put(ref, devObj);
				}
			}
			
			// Now look for all CCs found in OpenPages, discovering those missing in ePolicy, as well as differences in data
			// Mark differences as Updates for Openpages
			var keys = this.opMap[ccType].keySet().toArray();
			java.util.Arrays.sort(keys);
			
			for (var ref in keys) {
				var epObj = this.epMap[ccType].get(ref);
				var opObj = this.opMap[ccType].get(ref);
				var devObj = this.devMap[ccType].get(ref) || {ref: ref, update: true}; // DEFAULT update is true to catch No Changes
				var conditions = [];

				// If not found in ePolicy, then signal this in the deviation object (devObj)
				if (epObj == null) {
					//devObj = devObj || {ref: ref};
					conditions.push("Missing in ePolicy");

					for (var i = 0; i < this.ccTypes[ccType].checkFields.length; i++) {
						// If not found in ePolicy, include the check-fields from OpenPages for the Migration Log
						var checkThisField = this.ccTypes[ccType].checkFields[i];
						var opValue = (eval(this.ccTypes[ccType].map[checkThisField + 1]) || "");
						devObj[this.ccTypes[ccType].fieldNames[checkThisField]] = ""; // set the ePolicy field to blank
						devObj[this.ccTypes[ccType].fieldNames[checkThisField + 1]] = opValue; // set OP field to value
						i++;
					}
				} 
				
				// See if OpenPages CCs have invalid values for column 3 (for type RR) or column 4 (both)
				// For RV types both col 3 from OP and col 4 from ePolicy as-is
				var checkFields = { 
					col3: 6,
					col4: 8
				};
				
				// Check Col3 and Col4
				for (var field in checkFields) {
					var opValue = (String(opObj[field]) || "");
					var epValue = (epObj) ? String(epObj[field]) : "";
					
					var mappedValue = epValue;
					if (ccType == "RV" && field == "col3") {
						mappedValue = opValue;
					}

					// Mark changed fields with the pipe prefix (|)
					mappedValue = String(mappedValue);
					var changePrefix = "";
					if (opValue != mappedValue) {
						//devObj = devObj || {ref: ref};
						devObj["GTS-ClauseCtl:" + field] = mappedValue;
						devObj.update = true;
						this.clauseChanges[ccType]++;
					}

					var epValueNormalized = epValue.trim().toLowerCase().replaceAll("\\s+", "");
					var mappedValueNormalized = mappedValue.trim().toLowerCase().replaceAll("\\s+", "");
					if (epValueNormalized != mappedValueNormalized) {
						//devObj = devObj || {ref: ref};		
						changePrefix = "|";
						if (conditions.length == 0 || conditions[conditions.length-1] != "Clause Control Change") {
							conditions.push("Clause Control Change");
						}	
					}

					// If a devObj has been created, be sure and set the values for both ePolicy and OpenPages/Migrated columns
					// Set fields for the Migration Log
					devObj[changePrefix + this.ccTypes[ccType].fieldNames[checkFields[field]]] = mappedValue; // OP/Migrated value
					//devObj[changePrefix + this.ccTypes[ccType].fieldNames[checkFields[field]]] = opValue;
					devObj[changePrefix + this.ccTypes[ccType].fieldNames[checkFields[field]-1]] = epValue; // ePolicy value
				}

				// Look for differences in the Col2 field to check for both CC types
				if (opObj && epObj) {
//					for (var i = 0; i < this.ccTypes[ccType].checkFields.length; i++) {
					for (var i = 0; i < 2; i++) {
						var fieldIndex = this.ccTypes[ccType].checkFields[i];
						
						// Get which fields to compare based on the index into the checkFields list
						var epValue = (eval(this.ccTypes[ccType].map[fieldIndex]) || "");
						var epValueFixed = epValue.trim().toLowerCase().replaceAll("\\s+", "");
						var opValue = (eval(this.ccTypes[ccType].map[fieldIndex + 1]) || "");
						var opValueFixed = opValue.trim().toLowerCase().replaceAll("\\s+", "");
	
						// If a change was detected, record it in the deviation object
						var changePrefix = "";
						if (opValueFixed != epValueFixed) {
							devObj = devObj || {ref: ref};
							if (conditions.length == 0 || conditions[conditions.length-1] != "Clause Control Change") {
								conditions.push("Clause Control Change");
							}
							changePrefix = "|"
						}
						
						devObj[changePrefix + this.ccTypes[ccType].fieldNames[fieldIndex]] = epValue; // First is ePolicy field
						devObj[changePrefix + this.ccTypes[ccType].fieldNames[fieldIndex + 1]] = opValue; // Then OP field

						i++; // Skip the next field, since it was compared with this one.
					}
				}
				
				if (opObj != null) {
					// Add the RESOURCE ID and NAME to accomodate updating the CC in OpenPages in a later step
					devObj.id = opObj.id;
					devObj.name = opObj.name;
				}

				var oldDevObj = this.devMap[ccType].get(ref);
				if (oldDevObj) {
					this.log("WARN", "Found multiple instances of Clause Controls with REF: " + ref);
					// Move old changes to those newly detected
					for (var pname in oldDevObj) {
						devObj[pname] = oldDevObj[pname];
					}

					this.devMap[ccType].remove(ref);
				}

				devObj.Condition = conditions.join("\n");
				//this.showDevObj(ref, devObj, (epObj ? epObj : null), opObj);

				if (devObj.update) {
					// If no changes found, capture the No Changes condition
					if (!devObj.Condition) {
						devObj.Condition = "No changes";
						
						// Capture col3 and col4 from OpenPages
						for (var field in checkFields) {
							var opValue = (String(opObj[field]) || "");
							var epValue = (String(epObj[field]) || "");

							var mappedValue = epValue;
							if (ccType == "RV" && field == "col3") {
								mappedValue = opValue;
							}							

							if (typeof devObj["GTS-ClauseCtl:" + field] == "undefined") {
								devObj["GTS-ClauseCtl:" + field] = mappedValue;
							}
								
							// Set fields for the Migration Log
							if (typeof devObj[this.ccTypes[ccType].fieldNames[checkFields[field]]] == "undefined"
								&& typeof devObj["|" + this.ccTypes[ccType].fieldNames[checkFields[field]]] == "undefined") {
								devObj[this.ccTypes[ccType].fieldNames[checkFields[field]]] = mappedValue; // OP/Migrated value
							}
							if (typeof devObj[this.ccTypes[ccType].fieldNames[checkFields[field]-1]] == "undefined"
								&& typeof devObj["|" + this.ccTypes[ccType].fieldNames[checkFields[field]-1]] == "undefined") {
								devObj[this.ccTypes[ccType].fieldNames[checkFields[field]-1]] = epValue; // ePolicy value
							}	
						}
					}					

					// Save the original ePolicy value for all fields
					if (epObj) {
						for (var i = 3; i <= 4; i++) {
							devObj.epolicy = devObj.epolicy || system.newEntry();
							devObj.epolicy["GTS-ClauseCtl:Col" +i] = epObj["col" + i];
						}
					}

					this.devMap[ccType].put(ref, devObj);
				}
			}			
		}
		
		this.log(RJ("Detected differences - ", 35) 
					+ RJ("RR: " + this.devMap.RR.size(), 10)
					+ " RV: " + this.devMap.RV.size());
		this.log(RJ("...Clause Changes -", 35) 
					+ RJ(" RR: " + this.clauseChanges.RR, 10)
					+ " RV: " + this.clauseChanges.RV);
		this.log(RJ(" Individual columns changed", 35) 
					+ " RV:" + this.clauseChanges.RV);
		this.log(RJ(" ... columns changed", 35) 
					+ " RR: " + this.clauseChanges.RR);
		
		return this.devMap;
	}
	
	// Create the Excel workbook
	this.buildWorkbook = function(args) {
		args = args || {};
		if (typeof args == "string") args = {name: args};
		
		var workbookName = args.name || "_NOT_SPECIFIED_";

		// Create the ExcelSheet object
		this.workbook = new ExcelObj({
			sheetFileName: workbookName,
			columnNames: ""
		});
		
		this.log("Creating Migration Log for Clause Controls...");

		if (!this.devMap || !this.devMap.RR) {
			this.devMap = this.generateDeviationMap();
		}
		
		var sheetTypes = ["RR", "RV"];

		for (var i in sheetTypes) {
			ccType = sheetTypes[i];
			
			var entry = system.newEntry();

			// Sort the CC Refs		
			var refs = this.devMap[ccType].keySet().toArray();
			java.util.Arrays.sort(refs);
		
			for (var ref in refs) {
				var devObj = this.devMap[ccType].get(ref);
				
				if (!devObj.Condition) continue;
				
				var epObj = this.epMap[ccType].get(ref) || {ref: ""};
				var opObj = this.opMap[ccType].get(ref) || {ref: ""};
				
				entry.removeAllAttributes();
				
				// Copy all properties from devObj to the entry
				for (var fieldName in devObj) {
					entry[fieldName] = String(devObj[fieldName] || "");
				}
		
				// Make sure the ePolicy and OpenPages refs are set
				entry[this.ccTypes[ccType].fieldNames[0]] = epObj.ref;
				entry[this.ccTypes[ccType].fieldNames[1]] = opObj.ref;

				this.workbook.addRow(entry, this.ccTypes[ccType].name, this.ccTypes[ccType].fieldNames);
			}
		}	
		
		return this.workbook;
	}
	
	// Return the set of changes that must be applied to OpenPages Clause Controls based on
	// the differences detected.
	this.mapOfUpdates = function() {
		if (!this.devMap || !this.devMap.RR) {
			this.devMap = this.generateDeviationMap();
		}

		this.log("Determing updates to perform to Clause Controls in OpenPages...");

		// Prepare updates object with a property for cc (Control Clauses) and proc (Procedures/Clauses)
		var updates = {
			cc: new java.util.HashMap(),
			proc: new java.util.HashMap()
		}
		
		// First ensure there is an object stored for each Clause read
		var keys = this.opClauseMap.keySet().toArray();
		for (var clauseName in keys) {
			var clauseObj = this.opClauseMap[clauseName];
			var clauseUpdate = {changes: []};
			clauseUpdate.id = clauseObj.id;
			clauseUpdate.name = clauseObj.name;
			clauseUpdate.desc = clauseObj.desc;
			updates.proc[clauseName] = clauseUpdate;
		}
		
		// Now go through the various deviations found and store these
		for (var ccType in this.ccTypes) {
			// Sort the CC Refs		
			var refs = this.devMap[ccType].keySet().toArray();
			java.util.Arrays.sort(refs);

			for (var ref in refs) {
				var updateObj = null;
				var devObj = this.devMap[ccType].get(ref);
				// We only look for Clause Control Changes
				// NOW SAVING NO CHANGE ENTRIES TOO - if (!devObj.update || !devObj.id) {
				//if (devObj.Condition.equalsIgnoreCase("No changes") || !devObj.id) {
				if (!devObj.update || !devObj.id) {
					continue;
				}
				for (var fieldName in devObj) {
					if (fieldName.startsWith("GTS-ClauseCtl")) {
						updateObj = updateObj || {};
						updateObj[fieldName] = devObj[fieldName];
					}
				}
				
				// If a deviation was detected, save the updateObj
				if (updateObj != null && devObj.id) {
					updateObj.id = devObj.id;
					updateObj.name = devObj.name;
					updateObj.ref = ref;
					updates.cc.put(ref, updateObj);
					
					// Also, update the list changes made to the Clause (Procedure in OP)
					var clauseName = devObj.name;
					var p = clauseName.indexOf("-", 5);
					clauseName = clauseName.substring(p+1);
					clauseUpdate = updates.proc[clauseName];
					clauseUpdate.changes.push(updateObj);
				}
			}
		}	
		
		return updates;
	}

	
	// Initialization code below this point
	
	this.initialize();	

	return this; // Always return *this*
}]]></parameter>
        </Script>
        <Script name="ExcelObj">
            <ModTime>1604149145285</ModTime>
            <parameter name="includeFiles"/>
            <parameter name="script"><![CDATA[// The args properties are optional and include:
//
//		filenameTemplate: optional name (with subst-tokens) of the Excel sheet, in case it is written to disk
//    	sheetFileName: filepath for the Excel Sheet used by write() method, default is "$TDI_SOLDIR/_ExcelSheet.xlsx
//						NOTE: may contain eval tokens in curly braces - support javascript
//		columnsFileName: filepath to the text file with ordered names of Sheet columns, one per line
//	 OR columnNames: semicolon-separated list of field names (instead of file)
//		entry: Entry that the sheetFileName evaluation should use for eval tokens - i.e. {attribute-name}
//
var ExcelObj = function (args)
{
	//this.vrs = "20200602 1725"; // First version
	//this.vrs = "20200603 1345"; // Finally working
	//this.vrs = "20200603 2232"; // Corrected filename generation
	//this.vrs = "20200703 2000"; // .generate() can return ByteArray
	//this.vrs = "20200705 1408" // Removed POC_MVP/ as default path for files
	//this.vrs = "20200711 1839" // Added support for multiple entries with .addRow() and .writeSheet()
	//this.vrs = "20200712 1658"; // Added .getBytes() method
	//this.vrs = "20200810 1905"; // Removed debug code for sheetname
	//this.vrs = "20200815 1556"; // Removed hardcoded sheetname
	//this.vrs = "20200815 1556"; // Removed hardcoded sheetname
	//this.vrs = "2020921 1057"; // Added columnNames constructor argument
	//this.vrs = "20200925 1010"; // Changed name to ExcelObj and .writeSheet() to .write()
	this.vrs = "20201030 1557"; // Added feature to addRow so that Att Names starting with pipe (|) will be in bold font

	args = args || {};

	this.filenameTemplate = typeof(args) == "string" ? args : (args.fileName || "_ExcelWorkbook.xlsx");
	this.filename = "_ExcelWorkbook.xlsx";
	this.sheetname = args.sheetname || "Data";
	this.entry = args.entry || system.newEntry();
	this.map = new Mapper();
	this.columns = null;
	this.columnsFileName = args.columnsFileName || null;
	this.columnNames = args.columnNames || null;
	
	this.workbook = null;
	this.spreadsheet = {};
	this.rowCount = {} ;
	
	// Used for copying spreadsheets
	this.workbooks = {};
	this.sheets = {};
	this.rowIndex = {};
	
	// Local log function
	this.log = function(lvl, msg, throwit) {
		throwit = throwit || false;
		
		if (typeof lvl == "undefined") {
			msg = "";
			lvl = "INFO";
		} else
		if (typeof msg == "undefined") {
			msg = lvl;
			lvl = "INFO";
		}
		
		log(lvl, "[ExcelObj] " + msg);
		
		if (throwit) throw "[ExcelObj] " + msg;
	}
	
	// Write the workbook to a file
	this.write = function(useFileName) {
		useFileName = useFileName || this.filename;
		var fos = new java.io.FileOutputStream(new java.io.File(useFileName));
		this.workbook.write(fos);
		fos.close();
	}
	
	// Return the workbook as a byte array
	this.getBytes = function() {
		var fos = new java.io.ByteArrayOutputStream();
		this.workbook.write(fos);
		fos.close();
		
		return fos.toByteArray();
	}
	
	// Add an Entry as a row to this spreadsheet, using the field list specified
	this.addRow = function(entry, toSheetName, columns) {
		columns = columns || this.columns;
		toSheetName = toSheetName || this.sheetname;
		
		var row;
		if (this.workbook == null) {
			//Blank Document
			this.workbook = new org.apache.poi.xssf.usermodel.XSSFWorkbook();
			
			var boldFont = this.workbook.createFont();
	        boldFont.setBold(true);
	
	        this.headerStyle = this.workbook.createCellStyle();
	        this.headerStyle.setBorderBottom(org.apache.poi.ss.usermodel.BorderStyle.MEDIUM);
	        this.headerStyle.setBorderTop(org.apache.poi.ss.usermodel.BorderStyle.MEDIUM);
	        this.headerStyle.setBorderRight(org.apache.poi.ss.usermodel.BorderStyle.MEDIUM);
	        this.headerStyle.setBorderLeft(org.apache.poi.ss.usermodel.BorderStyle.MEDIUM);
	        this.headerStyle.setFillForegroundColor(200);
	        this.headerStyle.setFillPattern(org.apache.poi.ss.usermodel.FillPatternType.SOLID_FOREGROUND);
	        //headerStyle.setVerticalAlignment(org.apache.poi.ss.usermodel.VerticalAlignment.TOP);
	        this.headerStyle.setAlignment(org.apache.poi.ss.usermodel.HorizontalAlignment.CENTER);
	        this.headerStyle.setFont(boldFont);			

			this.cellStyle = this.workbook.createCellStyle();
			this.cellStyle.setWrapText(true);
	        this.cellStyle.setAlignment(org.apache.poi.ss.usermodel.HorizontalAlignment.LEFT);

			this.boldCellStyle = this.workbook.createCellStyle();
			this.boldCellStyle.setWrapText(true);
	        this.boldCellStyle.setAlignment(org.apache.poi.ss.usermodel.HorizontalAlignment.LEFT);
	        this.boldCellStyle.setFillForegroundColor(200);
	        this.boldCellStyle.setFillPattern(org.apache.poi.ss.usermodel.FillPatternType.SOLID_FOREGROUND);
	        this.boldCellStyle.setFont(boldFont);			
		}

		if (!this.spreadsheet[toSheetName]) {
			this.spreadsheet[toSheetName] = this.workbook.createSheet(toSheetName);
			this.rowCount[toSheetName] = 0;
		}

		if (this.rowCount[toSheetName] == 0) {
			row = this.spreadsheet[toSheetName].createRow(this.rowCount[toSheetName]);
			for (var cellNum = 0; cellNum < columns.length; cellNum++) {
				var name = columns[cellNum];
				var xlCell = row.createCell(cellNum);
				xlCell.setCellStyle(this.headerStyle);
				xlCell.setCellValue(name);
		        this.spreadsheet[toSheetName].autoSizeColumn(cellNum);
			}
			this.rowCount[toSheetName]++;
		}
		
		row = this.spreadsheet[toSheetName].createRow(this.rowCount[toSheetName]);
		for (var cellNum = 0; cellNum < columns.length; cellNum++) {
			var name = columns[cellNum];
			var bold = false;
			
			// First look if the attribute name is prepended with pipe (|) and if so, it's to be BOLDed
			var att = entry["|" + name];
			if (att == null) {
				att = entry[name];	
			}
			
			var value = null;
			if (att != null) {
				var attName = att.getName();

				// Pipe symbol prefix indicates Bold font
				if (attName.startsWith("|")) {
					bold = true;
				}
				var values = att.getValues();
				if (values.length == 1) {
					var value = values[0];
				} else {
					//row.setHeightInPoints((Math.max(1, values.length) * this.spreadsheet[toSheetName].getDefaultRowHeightInPoints()));
					var arr = [];
					for (var value in values) {
						arr.push(value.trim());
					}
					var value = arr.join("\n");
				}
			}	

			var xlCell = row.createCell(cellNum);
			if (bold) {
	 			xlCell.setCellStyle(this.boldCellStyle);
			} else {
	 			xlCell.setCellStyle(this.cellStyle);
			}
			xlCell.setCellValue(value);
		}

		this.rowCount[toSheetName]++;
	}
	
	// Initialize this object
	this.initialize = function() {
		this.log(" v" + this.vrs);
		
		if (this.columnsFileName) {
			var file = new java.io.File(this.columnsFileName) 
			if (!file.exists()) {
				this.log("FATAL", "Columns file name does not exist: " + this.columnsFileName, true);
			}
			
			this.columns = loadFileToArray(this.columnsFileName);
		} else 
		if (this.columnNames) {
			var sep = ",";
			if (this.columnNames.contains(";")) {
				sep = ";";
			}
			this.columns = system.splitString(this.columnNames, sep);
		}

		if (String(this.filenameTemplate).trim() != "") {
			this.filename = this.map.evaluate("Excel sheet filename", this.filenameTemplate, this.entry);
		}
	}	
	
	// Initialization code below here
	
	this.initialize();
	
	return this;
}]]></parameter>
        </Script>
        <Script name="Hook_Default_On_Error">
            <ModTime>1592419102898</ModTime>
            <parameter name="includeFiles"/>
            <parameter name="script"><![CDATA[log("FATAL", "Error reading from OpenPages: " + error.message);
throw error.getObject("Exception");]]></parameter>
        </Script>
        <Script name="Hook_On_Error">
            <ModTime>1592419102907</ModTime>
            <parameter name="includeFiles"/>
            <parameter name="script"><![CDATA[log("FATAL","error connecting to OpenPages: "+ error.message);
task.shutdown();]]></parameter>
        </Script>
        <Script name="JsonUtil">
            <ModTime>1597751448714</ModTime>
            <parameter name="includeFiles"/>
            <parameter name="script"><![CDATA[//////////////////////////////////////////////////////////////////////////////
//
//  Licensed Materials - Property of IBM
//
//  5725-D51
//
//  (C) Copyright IBM Corporation 2017.  All Rights Reserved.
//
//  US Government Users Restricted Rights - Use, duplication or
//  disclosure restricted by GSA ADP Schedule Contract with IBM Corp.
//
//////////////////////////////////////////////////////////////////////////////
var JsonUtil = function () {
    return {
        getJsonPropertyType : function(propValue) {
            var propType = typeof propValue;
            if (propType === "object") {
                // If object is type type and it has a child called "0", then this is an array
                try {
                    return propValue && propValue["0"] ? "array" : "object";
                } catch (e) {
                    return "string";
                }
            } else {
                return propType;
            }
        },
        visitJsonObject : function(obj, callback) {
            try {
                for (var propName in obj) {
                    var propValue = null;
                    try {
                        propValue = obj[propName];
                    } catch (e) {}
                    this.visitJsonProperty(propName, propValue, callback);
                }
            } catch (e) {}
        },
        visitJsonProperty : function(propName, propValue, callback) {
            var propType = this.getJsonPropertyType(propValue);
            if (propType === "object") {
                if (callback.jsonObjectStart) {
                    callback.jsonObjectStart.call(this, propName);
                }
                this.visitJsonObject(propValue, callback);
                if (callback.jsonObjectEnd) {
                    callback.jsonObjectEnd.call(this, propName);
                }
            } else if (propType === "array") {
                if (callback.jsonArrayStart) {
                    callback.jsonArrayStart.call(this, propName);
                }
                try {
                    for (var index in propValue) {
                        this.visitJsonProperty(null, propValue[index], callback);
                    }
                } catch (e) {}
                if (callback.jsonArrayEnd) {
                    callback.jsonArrayEnd.call(this, propName);
                }
            } else if (propType === "function") {
                if (callback.jsonFunction) {
                    callback.jsonFunction.call(this, propName, propValue);
                }
            } else if (propName) {
                if (callback.jsonProperty) {
                    callback.jsonProperty.call(this, propName, propType, propValue);
                }
            } else if (callback.jsonArrayElement) {
                callback.jsonArrayElement.call(this, propType, propValue);
            }
        },
        toJsonString : function(obj) {
            var jsonEntries = [];
            var jsonContextStack = [];
            var isArray = this.getJsonPropertyType(obj) === "array";
            function startEntry() {
                jsonContextStack.push(jsonEntries);
                jsonEntries = [];
            }
            function endEntry(entryName, entryIsArray) {
                if (jsonContextStack.length == 1 && isArray) {
                    entryName = null;
                }
                var entryJson = formatEntry(entryName, entryIsArray);
                jsonEntries = jsonContextStack.pop();
                jsonEntries.push(entryJson);
            }
            function formatEntry(entryName, isArray) {
                var entry = "";
                if (entryName) {
                    entry += "\"" + entryName + "\":";
                }
                entry += (isArray ? "[" : "{") + jsonEntries.join(",") + (isArray ? "]" : "}");
                return entry;
            }
            function formatPropValue(propType, propValue) {
                return propValue && propType === "string" ?
                "\"" + propValue.replace(/\n/g, "\\\\n")
                    .replace(/"/g, '\\\\"')
                    .replace(/'/g, '\\\'"')
                    .replace(/\\r/g, "\\\\r")
                    .replace(/\\t/g, "\\\\t")
                    .replace(/\\b/g, "\\\\b")
                    .replace(/\\f/g, "\\\\f") + "\"" :
                    propValue;
            }
            this.visitJsonObject(obj, {
                jsonObjectStart : function() {
                    startEntry();
                },
                jsonObjectEnd : function(objectName) {
                    endEntry(objectName, false);
                },
                jsonArrayStart : function() {
                    startEntry();
                },
                jsonArrayEnd : function(arrayName) {
                    endEntry(arrayName, true);
                },
                jsonArrayElement : function(propType, propValue) {
                    return jsonEntries.push(this.formatPropValue(propType, propValue));
                },
                jsonProperty : function(propName, propType, propValue) {
                    return jsonEntries.push("\"" + propName + "\":" + this.formatPropValue(propType, propValue));
                }
            });
            return formatEntry(null, isArray);
        }
    }
};]]></parameter>
        </Script>
        <Script name="MailObj">
            <ModTime>1608111910937</ModTime>
            <parameter name="includeFiles"/>
            <parameter name="script"><![CDATA[// MailObj is used to send emails
//
// The argument 'args' can hold the following properties:
//		o hostname 	- SMTP hostname
//		o port		- SMTP port (default is 25)
//		o ssl		- true/false if SSL is enabled (default = true)
//		o username	- username credential for SMTP server
//		o password 	- password credential for SMTP server
//
// Main method is: send()
//    where attachments is either a string or bytearray, or an array of either
//
var MailObj = function(args) {
//	this.vrs = "20201014 1225"; // Initial version
//	this.vrs = "20201215 1854"; // MailObj now prints Sending to <toAddress>...
	this.vrs = "20201216 1044"; // Logging 'Sending email...' message before attempting to connect
	
	this.hostname = args.hostname || "* NOT SPECIFIED *";
	this.port = args.port || 25;
	this.ssl = (typeof args.ssl == "undefined") ? true : !String(args.ssl).equalsIgnoreCase("false");
	this.username = args.username || "* NOT SPECIFIED *";
	this.password = args.password || "* NOT SPECIFIED *";
	
	// Method to send an email
	// Valid args properties are:
	//    o to			- to address
	//	  o from		- from address
	//	  o subject		- subject line
	//	  o body		- body, either text or a filepath
	//	  o contentType	- content type of the body, default is 'text'
	//	  o attachments	- optional filepath or array of filepaths to attach to email
	this.send = function(args) {
		var toAddress = args.toAddress || args.to || "* NOT SPECIFIED *";
		if (!(toAddress instanceof Array)) {
			toAddress = [toAddress];
		}
		var fromAddress = args.fromAddress || args.from || "* NOT SPECIFIED *";
		var subject = args.subject || "* NOT SPECIFIED *";
		var body = args.body || "* NOT SPECIFIED *";
		var contentType = args.contentType || args.contenttype || null;
		var attachments = args.attachments || args.attachment || [];
		if (!(attachments instanceof Array) || attachments.toString().startsWith("[B@")) {
			attachments = [attachments];
		}
		
		this.log("@@@@@ Sending mail to  " + toAddress + ": " + subject + "...");
		    		
		// Get system properties
		var properties = java.lang.System.getProperties();
		
		// Setup mail server
		properties.setProperty("mail.smtp.host", this.hostname);
		properties.setProperty("mail.smtp.port", String(this.port));
		properties.setProperty("mail.smtp.ssl.enable", this.ssl);
		properties.setProperty("mail.smtp.auth", "true");
		properties.setProperty("mail.smtp.socketFactory.port", String(this.port));
		properties.setProperty("mail.smtp.socketFactory.class", "javax.net.ssl.SSLSocketFactory");
		var session = javax.mail.Session.getInstance(properties);
		
		// Used to debug SMTP issues
		//session.setDebug(true);
		try {
		    // Create a default MimeMessage object.
		    var message = new javax.mail.internet.MimeMessage(session);
		    // Set From: header field of the header.
		    message.setFrom(new javax.mail.internet.InternetAddress(fromAddress));
		    // Set To: header field of the header.
		    for (var i = 0; i < toAddress.length; i++) {
			    message.addRecipient(javax.mail.Message.RecipientType.TO, new javax.mail.internet.InternetAddress(toAddress[i]));
		    }
		    // Set Subject: header field
		    message.setSubject(subject);

		    // Now set the actual message
		    // If there are attachments, then a bit more work
		    if (attachments.length == 0) {
			    if (contentType) {
				    message.setContent(this.loadBody(body), contentType);
			    } else {
				    message.setText(this.loadBody(body));
			    }
		    } else {
		    	var messageBodyPart = new javax.mail.internet.MimeBodyPart();
			    if (contentType) {
				    messageBodyPart.setContent(this.loadBody(body), contentType);
			    } else {
				    messageBodyPart.setText(this.loadBody(body));
			    }
			    var multiPart = new javax.mail.internet.MimeMultipart();
		    	multiPart.addBodyPart(messageBodyPart);
			    
			    for (var i = 0; i < attachments.length; i++) {
			    	var thisAtt = attachments[i];
			    	var source = new javax.activation.FileDataSource(thisAtt);
			    	messageBodyPart = new javax.mail.internet.MimeBodyPart();
			    	messageBodyPart.setDataHandler(new javax.activation.DataHandler(source));
			    	messageBodyPart.setFileName(thisAtt);
			    	multiPart.addBodyPart(messageBodyPart);
			    }
			    
			    message.setContent(multiPart);
		    }
		    message.saveChanges();      // don't forget this
		    
		    var tr = session.getTransport("smtp");
		    tr.connect(this.hostname, this.username, this.password);
		    tr.sendMessage(message, message.getAllRecipients());
			tr.close();

		    this.log("Sent message successfully!");
		} catch ( mex) {
		    this.log("WARN", "Error sending mail - " + mex);
		}		
	}
	
	// If body passed is a filename, then load the file and return it.
	// Otherwise return the body argument value
	this.loadBody = function(body) {
		var file = new java.io.File(body);
		if (file.exists()) {
			file = system.openFileForInput(body);
			var buf = new java.lang.StringBuilder();
			var line = null;
			while ((line = file.readLine()) != null) {
				buf.append(line + "\n");
			}
			file.close();
			return buf.toString();
		}
		
		return body;
	}
	
	// Local log function
	this.log = function(lvl, msg, throwit) {
		throwit = throwit || false;
		
		if (typeof lvl == "undefined") {
			msg = "";
			lvl = "INFO";
		} else
		if (typeof msg == "undefined") {
			msg = lvl;
			lvl = "INFO";
		}
		
		log(lvl, "[MailObj] " + msg);
		
		if (throwit) throw "[MailObj] " + msg;
	}

	// Initialization method
	this.initialize = function() {
		this.log("v" + this.vrs);
	} 

	
	// Initialization code below this point
	
	this.initialize();	

	return this; // Always return *this*
}]]></parameter>
        </Script>
        <Script name="Map_SOXAccount_JSON">
            <ModTime>1600854395155</ModTime>
            <parameter name="includeFiles"/>
            <parameter name="script"><![CDATA[{
    "Account Alias": "GTS-Account:AccAlias",
    "Account ID": "Name",
    "Account Name": "Description",
    "Account Regulated": "GTS-Account:AccRegulated",
    "Account Status": "GTS-Account:Status",
    "BAM ID": "GTS-Account:BAMID",
    "Client Risk Review Period": "GTS-Account:CltRskReviewPeriod",
    "Country": "GTS-Account:AccCountry",
    "Current Contract End Date": "GTS-Account:CContractEndDate",
    "Geography": "GTS-Account:AccGeo",
    "Industry": "GTS-Account:AccIndustry",
    "Market": "GTS-Account:AccMarket",
    "Restricted": "GTS-Account:Restricted",
    "Sector": "GTS-Account:AccSector",
    "Steady State Date": "GTS-Account:SteadyStateDate",
    "Transformation Date": "GTS-Account:TransformationDate",
    "Transition Date": "GTS-Account:TransitionDate",
    "Type": "GTS-Account:Type",
    "Type of Restriction": "GTS-Account:TypeofRestriction"
}]]></parameter>
        </Script>
        <Script name="Mapper">
            <ModTime>1599070374421</ModTime>
            <parameter name="includeFiles"/>
            <parameter name="script"><![CDATA[var Mapper = function (filePath)
{
	//this.vrs = "20200602 20:03"; // First version
	//this.vrs = "20200603 1301"; // Updated to handle templating (e.g. WordDoc object)
	//this.vrs = "20200603 1354"; // Added version log output
	//this.vrs = "20200623 1443"; // Added map() support for an array of Entries
	//this.vrs = "20200627 1205"; // Fixed evaluate to handle non-string map results
	//this.vrs = "20200703 1907";  // triming attribute names
	//this.vrs = "20200803 1624";  // triming mapping rules
	//this.vrs = "20200804 1501";  // triming mapping rules
	//this.vrs = "20200817 1243";  // Fixed evaluateItem which only return string values
	//this.vrs = "20200827 1459";  // Removed debug log output from map() when passed entry is null
	this.vrs = "20200902 2012";  // Updated to handle multi-valued map assignments
	
	this.filePath = filePath || "";
	this.rules = [];
	
	this.log = function(lvl, msg) {
		if (typeof lvl == "undefined") {
			msg = "";
			lvl = "INFO";
		} else
		if (typeof msg == "undefined") {
			msg = lvl;
			lvl = "INFO";
		}
		
		log(lvl, "[Mapper] " + msg);
	}
	
	this.initialize = function() {
		this.log(" v" + this.vrs);
		
		if (this.filePath != "") {
			var rulesArray = loadFileToArray(filePath);
			var rules = java.util.ArrayList();
			
			// Now to correct for multi-line mapping scripts

			var ruleIndex = 0;			
			while (ruleIndex < rulesArray.length) {
				var rule = rulesArray[ruleIndex++];
				// If this line continues, then read the next one
				while (rule.endsWith("\\") && ruleIndex < rulesArray.length) {
					rule = rule.substring(0, rule.length-1) + "\n" + rulesArray[ruleIndex++];
				}
				rules.add(rule);
			}			
			
			this.rules = rules.toArray();
		}
	}
	
	// Local eval function that limits access to privileged script beans (like main and session)
	this.eval = function(evalStr, entry) {
		//this.prepareGlobalState();
		var exceptn = null;
		try {
			var result = eval(evalStr);
			return result;
		} catch (ex) {
			exceptn = ex;
		} finally {
			//this.restoreGlobalState();
		}
		
		if (exceptn != null) {
			throw exceptn;
		}
	}

	
	this.evaluateItem = function(attrName, evalStr, entryOrArray) {
		var entries = entryOrArray;
		if (entryOrArray instanceof com.ibm.di.entry.Entry) {
			entries = [entryOrArray];
		}
		
		var evalError = "";
		//check if it's an attribute in the entry
		for (i = 0; i < entries.length; i++) {
			var entry = entries[i];
			if (entry == null) {
				//log("WARN", "Entry #" + i + " passed to map() is null");
				continue;
			} else
			if (entry && entry[evalStr]) {
				return entry[evalStr]; // TODO does this handle multi-values now?
			} else {
				try {
					evalValue = this.eval(evalStr, entry);
				} catch (e) {
					evalValue = null;
				}
	
				if (evalValue != null) {
					return evalValue;
				} else {
					// We only want to return null at this point IF we have checked all entries in the array
					if (i >= entries.length) {
						return null;				
					}
	/*
						this.addMappingError("evaluateItem(" + evalStr + ") for "
												+ attrName
												+ " returned null. " 
												+ evalError, 
											 entry.getString(srcUniqueId));
	*/										 
				}
			}
		}
	}


	this.evaluate = function(attrName, rule, entryOrArray) {
		var elem = [];
		var eval = false;
		var evalStr;
		var bracketDepth = 0;
		var rule = rule.replaceAll("\n", "_NEWLINE_");
		var st = new java.util.StringTokenizer(rule, "{}", true);
		var bracketDepth = 0;
		while (st.hasMoreTokens()) {
			var token = st.nextToken();
			if (token == "{") {
				if (bracketDepth++ == 0) {
					eval = true;
					evalStr = "";
				} else {
					evalStr += "{";
				}
			} else if (token == "}") {
				if (--bracketDepth == 0) {
					eval = false;
					var evalValue = this.evaluateItem(attrName, evalStr, entryOrArray);
					if (typeof evalValue != "undefined" && evalValue != null) {
						elem.push(evalValue);
					}
				} else {
					evalStr += "}";
				}
			} else if (eval) {
				evalStr += token;
			} else {
				elem.push(token);
			}
		}

		if (bracketDepth > 0) {
			var errmsg = "Assignment of " 
							+ attrName 
							+ " is missing a closing curly brace: " 
							+ rule;
			this.log("ERROR", errmsg);
			throw errmsg;
		}

		if (elem.length == 1) {
			var item = elem[0];
			if (typeof item == "string") {
				return item.replaceAll("_NEWLINE_", "\n");
			} else {
				return item;
			}
		} else 
		if (elem.length == 0) {
			return null;
		} else {
			return elem.join("").replaceAll("_NEWLINE_", "\n");
		}
	}

	this.map = function(entryOrArray, useRule) {
		var entries = entryOrArray;
		if (entryOrArray instanceof com.ibm.di.entry.Entry) {
			entries = [entryOrArray];
		}
		
		// First check if useRule is passed, in which case simply return this mapping result
		if (typeof useRule != "undefined") {
			var rule = useRule;
			var p = rule.indexOf("=");
			if (p < 0) { continue; }
			
			var name = rule.substring(0, p).trim();
			rule = rule.substring(p+1);
			
			return {name: name, value: this.evaluate(name, rule, entryOrArray)};
		}
		
		// Otherwise apply rules to map the entire entryOrArray, returning a mappedEntry
		var mappedEntry = system.newEntry();
		
		for (var i = 0; i < this.rules.length; i++) {
			var rule = String(this.rules[i]).trim();
			var p = rule.indexOf("=");
			if (p < 0) { continue; }
			
			var name = rule.substring(0, p);
			rule = rule.substring(p+1);
			
			var evalValue = this.evaluate(name, rule, entryOrArray);
			if (evalValue != null) {
				mappedEntry[name] = evalValue;
			}
		}
		
		return mappedEntry;
	}

	// Initialization code below here

	this.initialize();
	
	return this;
}]]></parameter>
        </Script>
        <Script name="OpenPagesObj">
            <ModTime>1608128303131</ModTime>
            <parameter name="includeFiles"/>
            <parameter name="script"><![CDATA[var OpenPagesObj = function(opconnector) {
	//this.vrs = "20200603 1354"; // Initial version
	//this.vrs = "20200605 1404"; // add() returns newly created object in Entry form
	//this.vrs = "20200609 18:57"; // added queryReply function which handles both Entry and JS Object argument
	//this.vrs = "20200609 18:57"; // made add() function accept JS Object as argument
	//this.vrs = "20200610 2019"; // added find(), saveParams(), restoreParams() and findAccount
	//this.vrs = "20200617 2110"; // fixed problem with add() method. Adding file does not return object from OP call
	//this.vrs = "20200625 1225"; // corrected error in selectEntries() - defined default value for objectType
	//this.vrs = "20200626 1543"; // improved saveParams and restoreParams
	//this.vrs = "20200629 1603"; // restoreParams when debug is true
	//this.vrs = "20200630 1204"; // Added findParents() and findChildren() methods
	
	//this.vrs = "20200701 1908"; // .add() method Supports 'parentId'
	//this.vrs = "20200729 1840"; // Started on .modify{}
	//this.vrs = "20200731 1706"; // .add() correctly returns new object
	//this.vrs = "20200731 2335"; // completed .update() method (renamed from .modify)
	//this.vrs = "20200802 1545"; // corrected .update() and now it also calls .add if entry not found to modify
	//this.vrs = "20200805 2241"; // added timings
	//this.vrs = "20200922 1244"; // added performTransition() function
	//this.vrs = "20200923 1409"; // made addParent() obey debug setting
	//this.vrs = "20201002 1045"; // added debug to performTransition() and update()
	//this.vrs = "20201009 1502"; // change transition timeout to 20 min
	//this.vrs = "20201016 1602"; // trying to make update() faster, although less flexible - may need to enhance modEntry() in Connector
	//this.vrs = "20201020 1520"; // fixed find() to send objectType as arg to query().
	//this.vrs = "20201021 1148"; // changing findKin() to use URIs instead of JOIN query
	this.vrs = "20201204 1209"; // Fixed writeableEntry() to only add Attributes found in passed Entry
	
	this.ctr = null;
	this.opconnector = opconnector || null;
	this.savedParams = [];
	this.typesById = null;
	this.typesByName = null;
	this.fieldDefinitions = new java.util.HashMap();
	//this.tempEntry = null; // Doesnt work since methods call each other - would need a pool. Not worth the effort
	
	this.transitionTimeoutMillis = system.getTDIProperty("transition.timeout.millis") || 240 * 60 * 1000; // 4 hours in msecs
	this.transitionSleepTimeMillis = system.getTDIProperty("transition.sleep.time.millis") || 3 * 1000; // 3 sec in msecs
	
	this.timer = typeof timer != "undefined" ? timer : {start: function() {}, stop: function() {}, timers: function() {return {} }};
	
	this.log = function(lvl, msg, throwit) {
		throwit = throwit || false;
		if (typeof lvl == "undefined") {
			msg = "";
			lvl = "INFO";
		} else
		if (typeof msg == "undefined") {
			msg = lvl;
			lvl = "INFO";
		}
		
		msg = String(msg).replace("java.lang.IllegalArgumentException: ", "");
		
		log(lvl, "[OpenPagesObj] " + msg);
		if (throwit) throw "[OpenPagesObj] " + msg;
	}
	
	// Call the Iterator mode selectEntries(), passing an optional query
	this.selectEntries = function(objectType, query) {
		this.timer.start("querying OpenPagesObj");
		objectType = objectType || this.ctr.getParam("object");
		query = query || null;
		
		this.saveParams();
		
		if (query != null) {
			this.ctr.setParam("query", query);
		}
		
		this.ctr.setParam("object", objectType);
		
		var cmdEntry = system.newEntry();
		cmdEntry.operation = "select";
		try {
			this.ctr.queryReply(cmdEntry);
		} catch (ex) {
			this.log("ERROR", "Error searching - " + ex, true);
		}	
		
		this.restoreParams();
		this.timer.stop("querying OpenPagesObj");
	}
	
	// Return the next entry from the selected result set of selectEntries()
	this.getNextEntry = function() {
		try {
			return this.ctr.getNextEntry();
		} catch (ex) {
			this.log("ERROR", "Error reading - " + ex, true);
		}	
	}
	
	// Search function
	this.find = function(fieldName, fieldValue, args) {
		args = args || {};
		if (typeof args == "string") { // Just passed in the object type
			var objectType = args;
		} else {
			var objectType = args.objectType || this.ctr.getParam("object");
		}
		
		if (fieldName.equalsIgnoreCase("Resource ID")) {
			var responseEntry = this.makeRequest({
													path: "/contents/" + fieldValue,
													method: "GET"
												});
			if (responseEntry == null) return null;
			return [responseEntry];
		} else {
			var query = "select * from [" + objectType + "] where [" + objectType + "].[" + fieldName + "]=" + this.quotes(fieldValue);
			
			return this.query(objectType, query);
		}
	}
	
	// This local find() returns either one Entry or null
	this.findOne = function(attName, attValue, args) {
		args = args || {};
		
		var objList = this.find(attName, attValue, args);
		var obj = objList.length == 0 ? null : objList[objList.length-1];
		if (obj == null) {
			//this.log("WARN", "Unable to find object with " + attName + ": " + attValue);
			return null;
		}
		
		return obj;
	}

	// Find an account, searching for either Name or GTS-Account:AccAlias
	this.findAccount = function(accountName, args) {
		args = args || {};
		var res = this.find("Name", accountName, args);
		if (res.length == 0) {
			res = this.find("GTS-Account:AccAlias", accountName, args);
		}
		return res;
	}
	
	// Quote a value if it is a string
	this.quotes = function(value) {
		if (typeof value == "string") {
			return "'" + value + "'";
		} else {
			return value;
		}
	}
	
	// Request the Connector for the object definitions
	this.getTypes = function() {
		if (this.typesById == null || this.typesByName == null) {
			var result = this.queryReply({operation: "get_types"});
			var types = result.getObject("types");
			this.typesById = types.typesById;
			this.typesByName = types.typesByName;
		}
	}
	
	// Returns fields defintions for an Object Type Name
	this.getFieldDefinitions = function(objectType) {
		//this.timer.start("getting field defs for OpenPagesObj");
		var objectTypeLC = objectType.toLowerCase(); // Since this is how fieldDefinitions are keyed in the OP Connector
		
		if (this.fieldDefinitions.get(objectTypeLC) == null) {
			var entry = this.distillEntry({objectType: objectType});
			entry.operation = "get_fielddefinitions";
			var result = this.queryReply(entry);
			var fieldDef = result.getObject("field_definitions").get(objectTypeLC);
			this.fieldDefinitions.put(objectTypeLC, fieldDef);
			//this.timer.stop("getting field defs for OpenPagesObj");
			return fieldDef;
		}

		//this.timer.stop("getting field defs for OpenPagesObj");
		return this.fieldDefinitions.get(objectTypeLC)
	}

	// Return types based on Object Type Id
	this.getTypeById = function(typeId) {
		if (this.typesById == null) {
			this.getTypes();
		}
		return this.typesById.get(typeId);
	}
	
	// Return types based on Object Type Name
	this.getTypeByName = function(objectType) {
		if (this.typesByName == null) {
			this.getTypes();
		}
		return this.typesByName.get(objectType);
	}
	
	// Returns the type for either a type id or an object name
	this.getType = function(idOrName) {
		if (typeof idOrName == "number" ||
			(typeof idOrName == "string" && system.isValidInt(idOrName))) {
			var id = system.toInt(String(idOrName));
			return this.getTypeById(id);
		} else {
			return this.getTypeByName(idOrName);
		}
	}
	
	// Return list of all fields for an object type
	this.getFieldList = function(idOrName) {
		var fieldListMaxLength = 40;
		
		var type = this.getType(idOrName);
		var fieldDefs = this.getFieldDefinitions(type.name);
		//var fieldNames = fieldDefs.keySet().toArray();
		//java.util.Arrays.sort(fieldNames);
		
		var fieldList = new java.util.ArrayList();
		var foundId = false;
		var foundName = false;
		for (var name in fieldDefs) {
			if (name.startsWith("$")) continue;
			
			var fieldDef = fieldDefs.get(name)
			fieldList.add("[" + type.name + "].[" + fieldDef.name + "]");

			if ("Resource ID".equalsIgnoreCase(fieldDef.name)) {
				foundId = true;
			} else
			if ("Name".equalsIgnoreCase(fieldDef.name)) {
				foundName = true;
			}
			
			if (fieldListMaxLength-- <= 0) {
				break;
			}
		}
		
		if (!foundId) {
			fieldList.add("[" + type.name + "].[Resource ID]");
		}
		if (!foundName) {
			fieldList.add("[" + type.name + "].[Name]");
		}
		
		return fieldList.toArray();
	}
	
	// Find parents
	this.findParents = function(mainType, resourceID, kinType) {
		if (typeof kinType == "undefined") {
			this.log("ERROR", "findParents() must be passed the type of parent as the second parameter", true);
			return list.toArray();
		}
		return this.findKin(mainType, resourceID, kinType, "parents");
		//return this.findKin(mainType, resourceID, kinType, "PARENT");
	}
	
	// Find children
	this.findChildren = function(mainType, resourceID, kinType) {
		if (typeof kinType == "undefined") {
			this.log("ERROR", "findChildren() must be passed the type of child as the second parameter", true);
			return list.toArray();
		}
		return this.findKin(mainType, resourceID, kinType, "children");
//		return this.findKin(mainType, resourceID, kinType, "CHILD");
	}
	
	// Return Associations
	this.getAssociations = function(resourceID, kinType, childOrParent) {
		childOrParent = childOrParent || "PARENT";

		var responseEntry = this.makeRequest({
			path: "/grc/api/contents/" + resourceID + "/associations/" + childOrParent,
			method: "GET"
		});
		
		var kinTypeId = this.getType(kinType).id;
		var list = responseEntry.getObject("entryArray");
		var returnList = new java.util.ArrayList();
		for (var entry in list) {
			var objType = entry.getString("$grcObjectType");
			if (!kinType || objType == kinTypeId) {
				returnList.add(entry);
			}
		}
		
		return returnList.toArray();
	}
	
	// Find kin (children or parents) for the mainType passed
	this.findKinNew = function(mainType, resourceID, kinType, childOrParent) {
		childOrParent = childOrParent || "PARENT";
		
		if (typeof kinType == "undefined") {
			this.log("ERROR", "findKin() must be passed the type of kin (e.g. SOXAccount, Policy, etc) as the second parameter", true);
			return list.toArray();
		}
	
		var kinList = new java.util.ArrayList();
		var assocList = this.getAssociations(resourceID, kinType, childOrParent);
		for (var kin in assocList) {
			var kin = this.findOne("Resource ID", kin.getString("Resource ID"));
			if (kin) {
				kinList.add(kin);
			}
		}
		
		return kinList.toArray();
	}
	
	// Find kin (children or parents) for the mainType passed
	this.findKin = function(mainType, resourceID, kinType, childOrParent) {
		childOrParent = childOrParent || "PARENT";
		
		if (typeof kinType == "undefined") {
			this.log("ERROR", "findKin() must be passed the type of kin (e.g. SOXAccount, Policy, etc) as the second parameter", true);
			return list.toArray();
		}
		
		var fieldList = this.getFieldList(kinType);

		var query = "select " + fieldList.join(", \n")
				+ "\n from [" + kinType + "]"
				+ " join [" + mainType + "] on " + childOrParent.toUpperCase() + "([" + kinType + "])"
				+ " where [" + mainType + "].[Resource ID]='" + resourceID + "';"
		//this.log("Query:\n" + query);
		
		var entries = this.query(kinType, query);
		
		return entries;
	}
	
	// Return an Array with entries based on a query
	this.query = function(objectType, query) {
		if (typeof query == "undefined") {
			query = objectType;
			objectType = this.ctr.getParam("object");
		}
		var list = new java.util.ArrayList();
		
		this.saveParams();
		
		this.ctr.setParam("query", query);
		var p = query.toLowerCase().indexOf(" from ");
		if (p > 0) {
			p = query.indexOf("[", p+6);
			var p2 = query.indexOf("]", p+1);
			var objType = query.substring(p+1, p2);
			this.ctr.setParam("object", objType);
		}
		this.selectEntries(objectType, query);
		
		var entry;
		while ((entry = this.getNextEntry()) != null) {
			list.add(entry);
		}
		
		this.restoreParams();
		return list.toArray();
	}
	
	// Add a new parent association to an object
	this.addParent = function(args) {
		if (args.debug) return;
		
		this.saveParams();
		
		// use queryReply of OP Connector to add the parent
		var requestEntry = system.newEntry();
		requestEntry.operation = "add_parent";
		for (propName in args) {
			if (typeof args[propName] == "undefined" || args[propName] == null) {
				this.log("ERROR", "addParent() - null/invalid argument property passed: " + propName);
			}
			requestEntry[propName] = args[propName];
		}

		var response = null;
		try {
			response = this.ctr.queryReply(requestEntry);
		} catch (ex) {
			this.log("ERROR", "Error adding parent - " + ex, true);
		}	
		
		this.restoreParams();
	}
	
	// Set the status of a Policy
	this.setStatus = function(objectResourceId, objectType, statusField, newStatus, objectEntry) {
		if (typeof objectEntry == "undefined") {
			var objAndStatus = this.getObjectAndStatus({
				resourceId: objectResourceId,
				objectType: objectType,
				statusField: statusField
			});
			objectEntry = objAndStatus.objectEntry;
		}
		
		var currentStatus = objectEntry.getString(statusField);
		
		if (currentStatus == newStatus) {
			return;
		}
		
		var entry = system.newEntry();
		entry["Resource ID"] = objectResourceId;
		entry.name = objectEntry.name;
		entry.description = objectEntry.description;
		entry[statusField] = newStatus;
		
		this.update(entry, {objectType: objectType});
	}

	// Make a request to OpenPages by specifying the path, method and body
	this.makeRequest = function(args) {
		args = args || {};
		
		if (typeof args == "string") {
			args = {path: args};	
		}

		this.saveParams();
		
		var requestEntry = system.newEntry();

		var path = args.path || "* NOT SPECIFIED *";
		var method = args.method || "GET";
		var resourceId = args.resourceId || "* NOT SPECIFIED *";
		var body = args.body || {me: "* NOT SPECIFIED *"};
		var debug = args.debug || false;
		
		requestEntry.operation = "make_request";
		requestEntry.path = path;
		requestEntry.method = method;
		requestEntry.body = body || null;
		
		if (debug) {
			this.log("DEBUG", "::makeRequest() args: " + toJson(args) + " " + method + " " + path + " " + requestEntry.toJSON());
		}	
		var responseEntry = null;
		try {
			responseEntry = this.ctr.queryReply(requestEntry);
		} catch (ex) {
			this.log("ERROR", "Error making REST request - " + ex, true);
		}
		
		if (debug) {
			this.log("DEBUG", "::makeRequest() got response: " + responseEntry.toJSON() + "\nbody: " + responseEntry.getString("http.bodyAsString"));
		}	

		this.restoreParams();

		return responseEntry;
	}

	// Invokes a Workflow Action/Transition for a Policy, waiting for it to complete and the
	// Policy Status to be set to resultingStatus
	this.performTransition = function(args) {
		args = args || {};
		
		var objectResourceId = args.resourceId || "*NOT SPECIFIED*";
		var objectType = args.objectType || "*NOT SPECIFIED*";
		var workflowName = args.workflowName || "*NOT SPECIFIED*";
		var transitionName = args.transitionName || "*NOT SPECIFIED*";
		var statusField = args.statusField || "*NOT SPECIFIED*";
		var resultingStatus = args.resultingStatus  || "";
		var debug = args.debug || false;

		if (debug) {
			return;
		}
		
		var opName = "Workflow Action: " + workflowName + " > " + transitionName;
		this.timer.start(opName);
		
		// Make sure the object exists and that the statusField is readable		
		var objAndStatus = this.getObjectAndStatus({
			resourceId: objectResourceId,
			objectType: objectType,
			statusField: statusField
		});
		var currentStatus = objAndStatus.status;
		var objectEntry = objAndStatus.objectEntry;

		this.log("Invoking " + opName);
					
		var alName = task.getParam("alName") || task.getShortName();
		task.setParam("alName", alName + " >> " + opName);

		var responseEntry = this.makeRequest({
			path: "/grc/ext/custom/workflow/transition/process",
			method: "POST",
			body: {
				resourceId: objectResourceId,
				workflowName: workflowName,
				transitionName: transitionName
			}
		});
		
		// Now wait for the object Status to be set to resultingStatus, indicating the transition has completed
		var status = "";
		var timeoutMillis = java.lang.System.currentTimeMillis() + this.transitionTimeoutMillis;
		do {
			task.sleep(this.transitionSleepTimeMillis); // sleep for a bit
			
			objectEntry = this.findOne("Resource ID", objectResourceId, {objectType: objectType})

			if (objectEntry == null) {
				status = "Unknown";
			} else {
				status = objectEntry.getString(statusField);
			}
					
			//this.log("...got " + statusField + ": " + status + " - " + objectEntry.toJSON());
		} while (status != resultingStatus && resultingStatus != "" && java.lang.System.currentTimeMillis() < timeoutMillis);
		
		task.setParam("alName", alName);
		
		this.timer.stop(opName);
		this.log(opName + " completed.")

		return status;
	}
	
	// Read in the Object and its status field
	this.getObjectAndStatus = function(args) {
		args = args || {};
		var objAndStatus = {};
		
		var objectResourceId = args.resourceId || "*NOT SPECIFIED*";
		var objectType = args.objectType || "*NOT SPECIFIED*";
		var statusField = args.statusField || "*NOT SPECIFIED*";
		var debug = args.debug || false;

		if (debug) {
			return;
		}

		objAndStatus.objectEntry = this.findOne("Resource ID", objectResourceId, {objectType: objectType});
		if (objAndStatus.objectEntry == null) {
			this.log("ERROR", "Could not find "
								+ objectType
								+ " with Resource ID: "
								+ objectResourceId,
					 true); // Throw exception
		}
		
		objAndStatus.status = objAndStatus.objectEntry.getString(statusField);
		if (objAndStatus.status == null) {
			this.log("ERROR", "Cannot read field '"
								+ statusField
								+ " to determine current status of "
								+ objectType
								+ " with Resource ID: "
								+ objectResourceId,
					 true);
		}

		return objAndStatus
		;
	}
		
	// Add an object to OpenPages
	// Parameters:
	//     newObject - 	Is either an Entry, a JS Object (with Attributes for properties) or JSON
	//					This is the object to add.
	//					It can contain any of these optional, special attributes:
	//					$grcObjectType - overrides the Object Type parameter of the Connector - type created
	//					primaryParentType - type of OP Object of the Parent
	//					primaryParentId - Resource ID of the parent for this new object
	//		args	-	Optional second parameter which is either a String, in which it is the type of
	//					object to be written (like $grcObjectType attribute for newObject)
	//					Or, it is a JS Object with can hold any of the following properties:
	//						objectType - sets the type of object to create (like $grcObjectType above)
	//						parentType - defines the type of the parent object
	//						parentId - the Resource ID of the parent of this new object
	this.add = function(newObject, args) {
		args = args || {};
		
		this.timer.start("adding OpenPagesObj");
		if (typeof args == "string") {
			args = { objectType: args }; 
		}
		
		var debug = args.debug || false;
		var objectType, parentType, parentID;
		
		// If entry passed is a JS Object, then convert to an Entry. If its a string, the assume its JSON
		var entry = this.distillEntry(newObject);
		
		var objectType = args.objectType || entry.getString("$grcObjectType") || this.ctr.getParam("object");
		var parentType = args.parentType || entry.getString("parentType") || this.ctr.getParam("parentType");
		var parentID = args.primaryParentId || args.parentID || args.parentId
							|| entry.getObject("primaryParentId") 
							|| entry.getObject("parentId");
		if (typeof parentID == "string") {
			parentID = parentID.trim();
		}
		
		this.saveParams();

		entry["$grcObjectType"] = objectType;
		this.ctr.setParam("object" , objectType);
		
		if (parentType) {
			log("Setting parent type to: " + parentType);
			this.ctr.setParam("parentType", parentType);
		}
		
		if (parentID) {
			try {
				log("Setting primary parent Id as: " + parentID)
				var parentID = system.toInt(parentID);
				entry["primaryParentId"] = parentID;
			} catch (ex) {
				this.log("ERROR", "parentID must be a number and reference the Resource Id of the parent object", true);
			}
		}
		
		if (debug) {
			entry["Resource ID"] = "42";
			this.restoreParams();
			this.timer.stop("adding OpenPagesObj");
			return entry;
		}
		
		try {
			this.ctr.putEntry(entry);
		} catch (ex) {
			this.log("ERROR", "Error adding new - " + ex, true);
		}
		
		// get newly created object 
		var requestEntry = system.newEntry();
		requestEntry.operation = "get_conn";

		var newObjectEntry = null;
		try {
			newObjectEntry = this.ctr.queryReply(requestEntry);
		} catch (ex) {
			this.log("ERROR", "Error re-reading new - " + ex, true);
		}

		this.restoreParams();
		
		// re-read to get full object
		newObjectEntry = this.find("Resource ID" , newObjectEntry.getString("Resource ID") , args)[0];
		
		this.timer.stop("adding OpenPagesObj");
		return newObjectEntry;
	}
	
	
	// Update an object to OpenPages, which means if no Resource ID is passed, it becomes an Add operation, otheriwse a Modify
	// Parameters:
	//     modObject - 	Is either an Entry, a JS Object (with Attributes for properties) or JSON
	//					This is the object to add.
	//					It can contain any of these optional, special attributes:
	//					$grcObjectType - overrides the Object Type parameter of the Connector - type created
	//					primaryParentType - type of OP Object of the Parent
	//					primaryParentId - Resource ID of the parent for this new object
	//		args	-	Optional second parameter which is either a String, in which it is the type of
	//					object to be written (like $grcObjectType attribute for newObject)
	//					Or, it is a JS Object with can hold any of the following properties:
	//						objectType - sets the type of object to create (like $grcObjectType above)
	//						parentType - defines the type of the parent object
	//						parentId - the Resource ID of the parent of this new object
	//						linkCriteria - the Link Criteria (name & value properties, optionally match as well) used to find the entry to modify
	//									   NOTE: if Resource ID is part of the entry, this is not used.
	this.update = function(passedEntry, args) {
		args = args || {};
		
		//this.timer.start("updating OpenPagesObj");
		if (typeof args == "string") {
			args = { objectType: args }; 
		}
		
		var debug = args.debug || false;
		var objectType, parentType, parentID;
		
		// If entry passed is a JS Object, then convert to an Entry. If its a string, the assume its JSON
		var entry = this.distillEntry(passedEntry);
		
		var objectType = args.objectType || entry.getString("$grcObjectType") || this.ctr.getParam("object");
		var parentType = args.parentType || entry.getString("parentType") || this.ctr.getParam("parentType");
		var parentID = String(args.primaryParentId || args.parentID || args.parentId
							|| entry.getObject("primaryParentId") 
							|| entry.getObject("parentId")).trim();
		var linkCriteria = args.linkCriteria || args.linkcriteria || args.link_criteria;
		var resourceID = args.ID || args.id || args.Id || entry.getString("Resource ID");

		var searchCrit = system.newSearchCriteria();
		if (resourceID != null) {
			// Set the internal params.current property in the OpenPages Connector
			var requestEntry = system.newEntry();
			requestEntry.operation = "set_current";
			//entry["Resource ID"] = resourceID;
			requestEntry.current = entry;
			searchCrit.addCriteria("Resource ID", searchCrit.EXACT, resourceID);
	
			//this.ctr.queryReply(requestEntry);
		} else 
		if (linkCriteria) {
			searchCrit.addCriteria(linkCriteria.name, searchCrit.EXACT, linkCriteria.value);
		}
		
		this.saveParams();

		entry["$grcObjectType"] = objectType;
		this.ctr.setParam("object" , objectType);

		if (debug) {
			this.restoreParams();
			//this.timer.stop("updating OpenPagesObj");
			return entry;
		}
		
		try {
			this.ctr.modEntry(entry, searchCrit);
		} catch (ex) {
			this.log("ERROR", "Error modifying - " + ex, true);
		}
				
		// re-read to get full object
		var list = this.find("Resource ID" , passedEntry.getString("Resource ID") , args);
		if (list.length == 0) {
			this.log("ERROR", "Call to update() failed to find the entry being updated - " + passedEntry.getString("Resource ID"));
		}
		
		//this.timer.stop("updating OpenPagesObj");
		return list[0];
	}
	
	// Distills an Entry object from either an Entry, a JS Object or JSON
	this.distillEntry = function(newObject) {
		if (typeof newObject == "string") {
			var entry = com.ibm.di.entry.Entry.toJSON(newObject);
		} else
		if (!(newObject instanceof com.ibm.di.entry.Entry)) {
			if (typeof newObject == "object") {
				var entry = this.jsObj2Entry(newObject, system.newEntry());
			} else {
				this.log("ERROR", "Unable to handle entry passed to add() function: " + entry);
			}
		} else {
			var entry = newObject;
		}
		
		return entry;
	}
	
	// Return a new Entry with the writeable attributes from the passed entry
	this.writeableEntry = function(entry, objectType) {
		objectType = objectType || entry.getString("$grcObjectType");
		var newEntry = system.newEntry();
		
		var fieldDefs = this.getFieldDefinitions(objectType);
		for (var field in fieldDefs) {
			var thisField = fieldDefs[field];
			if (typeof thisField == "object" && thisField.readOnly == false) {
				if (newEntry[thisField.name] == null && entry[thisField.name] != null) {
					newEntry[thisField.name] = entry[thisField.name];
				}
			}
		}
		
		return newEntry;
	}
	
	// List of params to save/restore
	this.paramsList = ["url", "username", "password", "object", "parentType", "parentLoc", "query"];
	
	// Save parameters for the OP Connector
	this.saveParams = function() {
		var params = {};
		for (var i = 0; i < this.paramsList.length; i++) {
			var pname = this.paramsList[i];
			params[pname] = this.ctr.getParam(pname);
		}
		this.savedParams.push(params);
	}
	
	// Restore saved parameters for the OP Connector
	this.restoreParams = function() {
		if (this.savedParams.length == 0) {
			return;
		}
		
		var params = this.savedParams.pop();
		this.savedParams = this.savedParams.slice(0, this.savedParams.length);
		
		for (var i = 0; i < this.paramsList.length; i++) {
			var pname = this.paramsList[i];
			this.ctr.setParam(pname, params[pname]);
		}
	}
	
	// Call the queryReply function which is used to handle all sorts of requests:
	// Although for compliance sake, the function accepts an Entry as its argument.
	// Note that you can also pass a JS object with properties. These properties are
	// turned into attributes in a requestEntry that is set up and passed to the
	// underlying CI method queryReply() which expects an Entry.
	// 
	// Setting the operation attribute controls behavior:
	//
	//	'get_conn'		Returns the last conn Entry. The conn Entry contains
	//					the newly created object after an add() operation, 
	//					including its Resource ID.
	this.queryReply = function(arg) {
		arg = arg || {};
		
		if (arg instanceof com.ibm.di.entry.Entry) {
			var requestEntry = arg;
		} else {
			var requestEntry = system.newEntry();

			if (typeof arg == "object") {
				requestEntry = this.jsObj2Entry(arg, requestEntry);
			}			
		}
		
		var responseEntry = null;
		try {
			responseEntry = this.ctr.queryReply(requestEntry);
		} catch (ex) {
			this.log("ERROR", "(queryReply) Error making REST request - " + ex, true);
		}	
		
		return responseEntry;
	}
	
	// Turns a JS Object into an Entry with Attributes for the objects properties
	this.jsObj2Entry = function(jsObj, useEntry) {
		useEntry = useEntry || system.newEntry();
		useEntry.removeAllAttributes();
		
		for (var pname in jsObj) {
			if (pname.startsWith("_")) {
				useEntry[pname.substring(1)] = jsObj[pname];
			} else {
				useEntry[pname] = jsObj[pname];
			}
		}
		
		return useEntry;
	}
	
	// Load and initialize ePolicy_db Connector from Resources > Connectors
	this.initialize = function() {
		this.log(" v" + this.vrs);
		
		this.timer.start("initializing OpenPagesObj");
		if (this.opconnector != null) {
			this.ctr = opconnector;
		} else {
			this.ctr = system.getConnector("OpenPages Connector");
			
			if (this.ctr == null) {
				this.log("ERROR", "Could not find Resources/Connectors/OpenPages Connector", true);
			} 
			
			try {
				this.ctr.initialize(null);
			} catch(ex) {
				this.log("ERROR", "Error initializing - " + ex, true);
			}
		}
		this.timer.stop("initializing OpenPagesObj");
	}
	
	
	// Initialization code below here
	
	this.initialize();
	
	return this;
}]]></parameter>
        </Script>
        <Script name="RequestObj">
            <ModTime>1606211301119</ModTime>
            <parameter name="includeFiles"/>
            <parameter name="script"><![CDATA[var RequestObj = function(requestEntryOrID) {
	//this.vrs = "20200806 1755"; // initial version
	//this.vrs = "20200820 1915"; // getting ePolicy connection details
	//this.vrs = "20200823 1357"; // added toString()
	//this.vrs = "20201010 1355"; // fixed handling of mappingTable
	//this.vrs = "20201029 1726"; // storing http.method in requestDetails
	//this.vrs = "20201119 1615"; // added requestDB functionality. This is a folder path from the POC_MVP
	this.vrs = "20201124 1047"; // added requestDB functionality. This is a folder path from the POC_MVP
    
    this.arg = requestEntryOrID;
    this.requestEntry = null;
    
    this.requestDetails = {};
    // These properties are now in 'props'
	//    this.auth; // Authorization header
	//    this.base; // Full HTTP base, f.ex. /validate
	//    this.operation; // Just the path without forward-slash, f.ex. validate
	//    this.body; // HTTP body passed in the request
	
	this.requestDBFolders = {
		validate: {
			newFolder: "new",
			successFolder: "success",
			failedFolder: "failed"
		},
		migrate: {
			newFolder: "new",
			successFolder: "success",
			failedFolder: "failed"
		}
	}
    
	this.log = function(lvl, msg, throwit) {
		throwit = throwit || false;
		if (typeof lvl == "undefined") {
			msg = "";
			lvl = "INFO";
		} else
		if (typeof msg == "undefined") {
			msg = lvl;
			lvl = "INFO";
		}
		
		log(lvl, "[RequestObj] " + msg);
		if (throwit) throw "[RequestObj] " + msg;
	}

	this.operation = function() {
		if (!this.requestDetails || !this.requestDetails.operation) {
			return "Invalid Request - processing failed";
		}
		return this.requestDetails.operation;
	}
	
	this.accounts = function() {
		return this.requestDetails.accounts;
	}
	
	this.ePolicy = function() {
		return this.requestDetails.ePolicy;
	}
	
	this.opUserEmail = function() {
		return this.requestDetails.opUserEmail;
	}
	
	this.mappingTable = function() {
		return this.requestDetails.mappingTable;
	}

	this.debug = function() {
		return this.requestDetails.debug;
	}	
	
	this.skippingClauseControls = function() {
		return this.requestDetails.skippingClauseControls;
	}	
	
	this.parseRequest = function() {
		var entry = this.requestEntry;
		
		this.requestDetails = {};
		this.requestDetails.auth = entry.getString("http.Authorization");
		this.requestDetails.base = entry.getString("http.base");
		var path = this.requestDetails.base.trim().toLowerCase();
		if (path.startsWith("/")) {
			path = path.substring(1);
		}
		this.requestDetails.operation = path;
		this.requestDetails.body = entry.getString("http.bodyAsString") || "";
		this.requestDetails.method = entry.getString("http.method");
 
 		if (this.requestDetails.method != "POST") {
 			return;
 		}
/*
 		if (this.requestID == null) {
			this.requestID = this.newRequestID();
 		}
*/		
		this.log("===> Processing " + this.requestDetails.operation + " for Request ID: " + this.requestID);
			
		// Now parse the HTTP body and assign to local settings
		try {
			var obj = fromJson(this.requestDetails.body);
			for (var pname in obj) {
				this.requestDetails[pname] = obj[pname];
			}
			this.requestDetails.accounts = obj.accounts;
			this.requestDetails.mappingTable = obj.mappingTable || obj.mappingtable;
			this.requestDetails.opUserEmail = obj.opUserEmail || obj.opuseremail;
			this.requestDetails.ePolicy = obj.epolicy || obj.ePolicy || obj.Epolicy || {};
			this.requestDetails.debug = obj.debug || false;
			this.requestDetails.skippingClauseControls = obj.skippingClauseControls
													|| obj.skippingclausecontrols
													|| obj.skipClauseControls
													|| obj.skipclausecontrols
													|| false;
		
			this.saveRequest(this.requestDetails.body);
		} catch (ex) {
			var errmsg = "Error process Request " + this.requestID + " - " + ex;
			this.log("ERROR", errmsg);
			throw errmsg;
		}
	}
	
	// Returns the Request DB path for the passed operation and status
	this.requestDBPath = function(operation, status) {
		var path = "POC_MVP/requestDB/" + operation + "/" + status.toLowerCase() + "/" + this.requestID + ".json";
		return path;
	}
	
	// Save the request. If this is a migrate and request already exists under requestDB/validate/success then OK, otherwise error
	this.saveRequest = function(requestJson) {
		if (this.operation() == "migrate") {
			// In case of Migration, the request must already be under requestDB/validate/success
			var vPath = this.requestDBPath("validate", "success");
			var file = new java.io.File(vPath);
		
			if (!file.exists()) {
				// If it's not found there, this is an error
				this.log("ERROR", "saveRequest() - Cannot Migrate unknown Request ID " + this.requestID);
				system.exitFlow();
			}
			
			this.log("Moving Request("+ this.requestID + ") from " + vPath + " to prepare to Migrate");

			this.moveRequest("validate", "success", "migrate", "new");
		} else {
			var vPath = this.requestDBPath(this.operation(), "new");
			
			this.log("Saving Request("+ this.requestID + ") to " + vPath);
			
			var file = system.openFileForOutput(vPath);;
			file.write(requestJson);
			file.close();
		}
	}
	
	// Saves the Request as successful
	this.saveSuccess = function() {
		var operation = this.operation();
		this.moveRequest(operation, "new", operation, "success");
	}
	
	// Saves the Request as failed
	this.saveFailure = function() {
		var operation = this.operation();
		this.moveRequest(operation, "new", operation, "failed");
	}
	
	// Load a previously successfully validated request
	this.loadRequest = function(fromOperation, fromStatus) {
		var filePath = this.requestDBPath(fromOperation, fromStatus);
		var file = new java.io.File(filePath);
		
		if (!file.exists()) {
			this.log("ERROR", "Cannot find Validated Request " + this.requestID);
		}
		
		var buf = new java.lang.StringBuilder();
		file = system.openFileForInput(filePath);
		var line;
		while ((line = file.readLine()) != null) {
			buf.append(line + "\n");
		}
		file.close();
		
		this.requestEntry = system.newEntry();
		this.requestEntry["http.bodyAsString"] = buf.toString();
		this.requestEntry["http.Authorization"] = "arf";
		this.requestEntry["http.method"] = "POST";
		this.requestEntry["http.base"] = "/migrate";
	}
	
	// Moves a request JSON between requestDB folders
	this.moveRequest = function(fromOperation, fromStatus, toOperation, toStatus) {
		var requestID = this.requestID;
		var fromPath = this.requestDBPath(fromOperation, fromStatus);	
		var toPath = this.requestDBPath(toOperation, toStatus);;	
		
		var fromFile = new java.io.File(fromPath);
		if (!fromFile.exists()) {
			this.log("ERROR", "moveRequest(" + requestID + ") - Cannot find Request to move: " + fromFile);
			system.exitFlow();
		}
		
		var toFile = new java.io.File(toPath);
		if (toFile.exists()) {
			this.log("WARN", "Request already exists: " + toFile);
		} else 
		if (!fromFile.renameTo(toFile)) {
			this.log("ERROR", "Unable to move Request from " + fromPath + " to " + toPath);
			system.exitFlow();
		}
	}
	
	// Generate the random part of a Request ID
	this.randomPart = function(len) {
		len = len || 5;
		var charStr = "ABCDEFGHIJKLMNOP0123456789";
		var chars = charStr.split();
		var buf = new java.lang.StringBuilder();
		
		while (buf.length() < len) {
			var ndx = Math.floor(Math.random() * chars.length);
			buf.append(chars[ndx]);
		}
		
		return buf.toString();
	}
	
	// Creates requestDB folders if not already present
	this.setupRequestDB = function() {
		var path = ["POC_MVP", "requestDB"];
		for (var propName in this.requestDBFolders) {
			var subPath = path.slice(0);
			subPath.push(propName);
			for (var subPropName in this.requestDBFolders[propName]) {
				var finalPath = subPath.slice(0);
				finalPath.push(this.requestDBFolders[propName][subPropName]);
				
				var file = new java.io.File(finalPath.join("/"));
				if (!file.exists()) {
					file.mkdirs();
				}
			}
		}
	}
	
	// Return a new Request ID
	this.newRequestID = function() {
		var id = system.formatDate(new Date, "yyMMdd") + this.randomPart(10);
		return id;
	}

	this.processRequest = function() {
		if (!"POST".equalsIgnoreCase(this.requestDetails.method)) {
			throw "Bad Request - unsupported HTTP verb: " + String(this.requestDetails.method).toUpperCase();
		}
				
		switch (this.operation()) {
			case "validate":
				this.validate();
				break;
			case "migrate":
				this.migrate();
				break;
			default: 
				throw "Bad Requst - Invalid Path: " + path;
		}
	}
	
	this.authenticated = function(auth) {
		auth = auth || "";
		if (auth == "" || auth == null) {
			return false;
		}
		
		return true;
	}
	
	this.setResult = function(args){
		var code 					= args.resultCode || args.resultcode || "200";
		work["http.resultCode"] = code;
		work["http.resultMsg"] 		= args.resultMsg || args.resultmsg || "Ok";
		work["http.Content-Type"] 	= args.contentType || args.contenttype || "application/json";
		work["http.body"] 			= args.body || '{"message" : "No results"}';
		
		switch (code){
			case "200": 
				log("Request completed successfully");
				break;
			default:
				log("ERROR",
					work.getString("http.resultMsg")
					+ " (" + work.getString("http.resultCode") + ")"
					+ " return body: " + work.getString("http.body"));
		}
		 
	}
	
	this.validate = function() {
		this.setResult({
			resultCode: "200",
			resultMsg: "Ok - Migration completed successfully",
			body: loadFileToString("POC_MVP/mockup/validate.json")
		});
	}
	
	this.migrate = function() {
		this.setResult({
			resultCode: "200",
			resultMsg: "Ok - Migration completed successfully",
			body: loadFileToString("POC_MVP/mockup/migrate.json")
		});
	}
	
	// Turn the request to the a string
	this.stringify = function() {
		var msg = [];
		for (var p in this) {
			if (p == "requestDBFolders") continue;
			
			var i = this[p];
			if (i.toString().contains("Function")) {
				continue;
			} else 
			if (typeof i == "object" && i.join && typeof i.length == "number"){	
				msg.push(p + ": [0.." + i.length-1 + "] " + i.toString());
			} else
			if (typeof i == "object") {
				try {
					msg.push(p + ": " + toJson(i));
				} catch(ex) {
					msg.push(p + ": " + makeJson(i));
				}	
			} else {
				msg.push(p + ": " + i);
			}
		}
		return "Contents:\n|     " + msg.join("\n|     ");
	}
	
	this.initialize = function() {
		this.log("v" + this.vrs);

		if (this.arg instanceof com.ibm.di.entry.Entry) {
			this.requestEntry = this.arg;
			this.requestID = this.requestEntry.getString("RequestID") || this.newRequestID();
		} else {
			// Otherwise it is a Request ID
			this.requestID = this.arg;
			this.loadRequest("validate", "success");
			//this.moveRequest("validate", "success", "migrate", "new");
		} 

		this.setupRequestDB();
		this.parseRequest();
	}
	
	
	// ------ initialization code below
	
	this.initialize();
	
	return this;
}]]></parameter>
        </Script>
        <Script name="SCP">
            <ModTime>1596458004335</ModTime>
            <parameter name="includeFiles"/>
            <parameter name="script"><![CDATA[var SCP = function (hostname, username, password, hostkey, cmdPath)
{
//	this.vrs = "20200508 1553"; // making it support linux as well
//	this.vrs = "20200511 1248"; // works for linux (scp) & windows (winscp)
//	this.vrs = "20200511 1348"; // made it work for windows again
	this.vrs = "20200519 1247"; // updated scp for Centos based on Shikhas recommendation
	
	this.cmdPath = cmdPath || null;
	this.hostname = hostname;
	this.username = username;
	this.password = password;
	this.hostkey = hostkey;
	this.os = java.lang.System.getProperty("os.name").toLowerCase();
	
	this.isLinux = function() {
		return this.os == "linux";
	} 
	
	this.log = function(lvl, msg) {
		if (typeof lvl == "undefined") {
			msg = "";
			lvl = "INFO";
		} else
		if (typeof msg == "undefined") {
			msg = lvl;
			lvl = "INFO";
		}
		
		log(lvl, "[SCP] " + msg);
	}
	
	this.put = function (filepath, tofolder)
	{
		if (this.os == "linux") {
			var args = [
						"-i",
						"POC_MVP/id_rsa",
						filepath, 
						this.username + "@" + this.hostname + ":" + tofolder
						];
			log(" --> executing command: scp " + args.join(" "));
			var exstmt = system.shellCommand("scp", args);
		} else {
			var cmdfilepath = this.createCommandFile(filepath, tofolder);
			var batchFilepath = this.createBatchFile(cmdfilepath);		
			var exstmt = system.shellCommand(batchFilepath);
		}
		if(exstmt.getExitValue() != 0)
		{
			var errmsg = "Error executing command line: " 
							+ exstmt.getExitValue() + " - "
							+ exstmt.getError() + " - "
							+ exstmt.getOutputBuffer();
			log("ERROR", errmsg);
			throw errmsg;
		}
	}
	
	this.createCommandFile = function(filepath, tofolder) 
	{
		var fileName = "POC_MVP/scp.txt";
		var file = system.openFileForOutput(fileName);
		
		file.write("option confirm off");
		file.newLine();
		file.write("open sftp://"
					+ this.username
					+ ":" + this.password
					+ "@" + this.hostname
					+ ' -hostkey="' + this.hostkey + '"');
		file.newLine();
		file.write("put "
					+ (new java.io.File(filepath).getAbsolutePath())
					+ " " + tofolder);
		file.newLine();
		file.write("exit");
		file.newLine();
		
		file.close();	
		return (new java.io.File(fileName)).getAbsolutePath();	
	}
	
	this.createBatchFile = function(cmdfilepath) 
	{
		var fileName = "POC_MVP/winscp.bat";
		var file = system.openFileForOutput(fileName);
		file.write('"' + this.cmdPath + '"'
					+ " /ini=nul /script="
					+ '"' + cmdfilepath + '"');
		file.newLine();
		file.close();
		return (new java.io.File(fileName)).getAbsolutePath();
	}
	

	// Initialization code below
	this.log("SCP v" + this.vrs);
	
	if (!this.cmdPath) {
		if (this.os == "linux") {
			this.cmdPath = "scp";
		} else {
			this.cmdPath = "C:\\Program Files (x86)\\WinSCP\\WinSCP.com";
		}
	}
	
	
		
	return this;
}]]></parameter>
        </Script>
        <Script name="Script_Lib">
            <ModTime>1607074163971</ModTime>
            <parameter name="includeFiles"/>
            <parameter name="script"><![CDATA[//vrs = '20200403 1647'; //First version
//vrs = '20200508 1439'; // Added output to std out
//vrs = "20200605 1419"; // Added loadFileToByteArray
//vrs = "20200805 2244"; // Added padding functions
//vrs = "20200819 2024"; // log() now accumulates errors and includes AL name if set as param 'alName'
//vrs = "20200824 1937"; // Put else between ERROR and WARN in log(), Fixed reply()
//vrs = "20200826 1442"; // Add own formatDate()
//vrs = "20200827 1346"; // Making formatDate return Timezone for java.sql.Timestamp
//vrs = "20200921 1055"; // Added invalidValue() function
//vrs = "20201002 1256"; // Moved mapStatus to ePolicy2OP_define functions Script
//vrs = "20201009 1658"; // Added throwit argument to log() function
//vrs = "20201023 2224"; // Fixed formatDate to handle non java.sql.Timestamp types
//vrs = "20201118 1614"; // Added copyOfEntry()
vrs = "20201124 1257"; // Added encrypt() and decrypt()

var _OS = java.lang.System.getProperty("os.name");

// Globally used log function. It can also collect error messages if _errors or _warnings are defined
// Note that it also prepends messages with the AL Name, to aid in threaded logging.
function log(level, message, throwit) {
	if (typeof level == "undefined") {
		message = "";
		level = "INFO";
	} else
	if (typeof message == "undefined") {
		message = level;
		level = "INFO";
	}
	throwit = throwit || false;
	
	message = String(message).replace("java.lang.IllegalArgumentException: ", "");
	
	var alName = task.getParam("alName");
	var useALName = (alName == null) ? "" : "<" + alName + "> ";
	
	java.lang.System.out.println(level + " : " + useALName + message);
	task.logmsg(level, useALName + message);
	
	if ((level == "ERROR" || level == "FATAL")
		&& typeof _errors != "undefined" 
		&& _errors instanceof Array) {
		_errors.push(message);
	}else
	if (level == "WARN"
		&& typeof _warnings != "undefined" 
		&& _warnings instanceof Array) {
		_warnings.push(message);
	}

	if ((level == "ERROR" || level == "FATAL") && throwit) {
		system.exitFlow();
	}
}

log("[Script_Lib] v" + vrs);

// Check _errors length to see if any errors were logged
function errorsCollected() {
	if (typeof _errors == "undefined") {
		throw "No errors collected."
	} else {
		return _errors.length;
	}
}

// Find the first Exception thrown
function rootException(ex) {
	if (ex instanceof java.lang.Exception) {
	}

	while (ex.getCause() != null) {
   		ex = ex.getCause();
	}

	return ex;
}

// Return the first error logged
function rootCause() {
	if (typeof _errors == "undefined") {
		throw "No errors collected."
	} else {
		var err = _errors[0];
		if (!err) {
			if (!"OK".equalsIgnoreCase(error.getString("status"))) {
				err = error.message + " - " + error.exception;
			} else {
				err = " -- "
			}
		}
		return err;
	}
}

// Return true if an error has been logged
function inError() {
	if (typeof _errors == "undefined") {
		throw "No errors collected."
	} else {
		return _errors.length > 0;
	}
}

// If an error has been logged, exit the Flow
function exitOnErrors() {
	if (typeof _errors == "undefined") {
		throw "No errors collected."
	} else {
		if (_errors.length > 0) {
			system.exitFlow();
		} else {
			return;
		}
	}
}

// Remove all logged errors
function resetErrors() {
	if (typeof _errors == "undefined") {
		throw "No errors collected."
	} else {
		_errors = [];
	}
}

// Return the array of errors, or empty array
function allErrors() {
	if (typeof _errors == "undefined") {
		throw "No errors collected."
	} else {
		return _errors || [];
	}
}


// Returns a new Entry which is a copy of the one passed
function copyOfEntry(entry) {
	var newEntry = system.newEntry();
	newEntry.merge(entry);
	return newEntry;
}

// These global variables are used by the padding functions below
_gblPadStr = ["", ""];
for (_i = 0; _i < 50; _i++) {
	_gblPadStr[0] += "  ";
	_gblPadStr[1] += " .";
}

// Array used for Hex conversions
_hexChars = "0123456789ABCDEF";

//
// function LJ( str, len )				// left-justifies str in a string with length = len
// function RJ( str, len )				// right-justifies str in a string with length = len
// function CJ( str, len )				// center-justifies str in a string with length = len

// Pad out a string to the right - e.g. left-justify str in len spaces
//
function LJ(str, len, lineCnt) 
{
	lineCnt = lineCnt || 0;
	var usePad = _gblPadStr[lineCnt++ % 2];	
	str = String(str); // Cast to JS String object, just in case
	if (len <= str.length)
		return str
	else {
		var padlen = len - str.length;
		var padding = usePad.substring(usePad.length-padlen); 
		return (str + padding);
	}
}


// Pad out a string to the left with spaces - e.g. right-justify str in len spaces
//
function RJ( str, len, lineCnt ) 
{
	lineCnt = lineCnt || 0;
	var usePad = _gblPadStr[lineCnt++ % 2];	
	var str = String(str); // Cast to JS String object, just in case
	if (len <= str.length)
		return str
	else {
		var padlen = len - str.length;
		var padding = usePad.substring(0,padlen); 
		return (padding + str);
	}
}


// Pad out a string on both sides to length (parameter = len) - e.g. centers str in len spaces
//
function CJ( str, len, lineCnt ) 
{
	lineCnt = lineCnt || 0;
	var usePad = _gblPadStr[lineCnt++ % 2];	
	var str = String(str); // Cast to JS String object, just in case
	if ( len <= str.length )
		return str
	else
	{
		var _rightPad = Math.floor((len-str.length) / 2);
		var _leftPad = (len-str.length) - _rightPad;
		return padR( "", _leftPad, usePad ) + str + padR( "", _rightPad );
	}
}

// Return true if value passed does not match any in the array (second argument)
function invalidValue(val, valArray, caseInsensitive) {
	caseInsensitive = caseInsensitive || false;
	if (!(valArray instanceof Array)) {
		valArray = [valArray];
	}
	
	for (var i = 0; i < valArray.length; i++) {
		if (caseInsensitive) {
			if (String(val).equalsIgnoreCase(valArray[i])) {
				return false;
			}	
		} else
		if (val == valArray[i]) {
			return false;
		}
	}
	
	return true;
}

// Own toJson() function
function makeJson(obj, lvl) {
	lvl = lvl || 0;
	var lines = [];
	var pad = "                                  ".substring(0, lvl*4);
	if (typeof obj != "object" || obj == null) {
		log(pad + obj);
	} else {
		for (var propName in obj) {
			var subobj = obj[propName];
			if (subobj instanceof Array) {
				log(pad + "  " + propName + ": [");
				for (var i = 0; i < subobj.length; i++) {
					lines.push(makeJson(subobj[i], lvl+1));
				}
				log(pad + "]");
			} else
			if (typeof subobj == "object") {
				log(pad + "  " + propName + ": {");
				lines.push(makeJson(subobj, lvl+1));
				log(pad + "  }")
			} else {
				log(pad + "  " + propName + ": " + subobj);
			}
		}
	}
	return lines.join("\n");
}

// Own formateDate() that can handle java.sql.Timestamp specifically, as it has nanoseconds
function formatDate(dt, mask) {
	mask = String(mask || "yyyy-MM-dd-HH.mm.ss.SSSSSS").trim();
	
	if (dt instanceof com.ibm.di.entry.Attribute) {
		dt = dt.getValue(0);
	}
	
	var dateStr = system.formatDate(dt, mask)
	if (!dt instanceof java.sql.Timestamp) {
		return dateStr;
	}
	
	// For java.sql.Timestamp, include nanoseconds
	var numOfS = 0;
	if (mask.contains("S")) {
		var p = mask.indexOf("S");
		var lastP = mask.lastIndexOf("S");
		numOfS = (lastP - p) + 1;
		var lastDot = mask.lastIndexOf(".");
		if (lastDot = p-1) {
			p = lastDot;
		}
		mask = mask.substring(0, p)
				+ " " + mask.substring(p+numOfS+1).trim();
		dateStr = system.formatDate(dt, mask);
	}
	
	var withTZ;
	var withoutTZ;
	var TZ;

	if (mask.endsWith("z")) {
		var p = mask.indexOf(" z");
		withTZ = dateStr;
		withoutTZ = system.formatDate(dt, mask.substring(0, p).trim());
	} else {
		withTZ = dateStr;
		withoutTZ = dateStr;
	}

	var rest = "";
	
	if (dt instanceof java.sql.Timestamp) {
		var nanos = dt.getNanos();
		rest = String(nanos/1000);
		rest = (rest + "00000000000000000").substring(0, numOfS);
		if (rest) {
			rest = "." + rest;
		}
	}		
	return String(withoutTZ.trim() + rest + " " + withTZ.substring(withoutTZ.length).trim()).trim();
}

// Split filename into name and extension
function getFilenameParts(name) {
	var parts = {
		filename: name,
		extension: "txt"
	}

	var p = name.lastIndexOf(".");

	if (p > 0 && p >= (name.length-5)) {
		parts.extension = name.substring(p+1);
		parts.filename = name.substring(0, p);
	} 

	return parts;
}

// Read file into an Entry object
function fileToEntry(filePath)
{
	var entry = system.newEntry();
	var file = system.openFileForInput(filePath);
	var line;
	while((line = file.readLine()) != null)
	{
		line = line.trim();
		if(line == "")
		{
			continue;
		}
		entry[line] = true;
	}
	file.close();
	return entry;
}

function fileToAttribute(filePath, attributeName)
{
	var attribute = system.newAttribute(attributeName);
	var file = system.openFileForInput(filePath);
	var line;
	while((line = file.readLine()) != null)
	{
		line = line.trim();
		if(line == "")
		{
			continue;
		}
		attribute.addValue(line);
	}
	file.close();
	return attribute;
}

function encrypt(txt) {
	var encrypted = null;
	try {
		//  getRsaEncrypted( plainText,  ksPath,  ksPassword,  certificateAlias)
		encrypted = system.getRsaEncrypted(txt, 'testserver.jks', 'server', 'server')
	} catch (ex) {
		log("ERROR", "Error encrypting string - " + ex);
	}
	return encrypted;
}

function decrypt(hash) {
	var decrypted = null;
	try {
		// getRsaDecrypted( plainText,  ksPath,  ksPassword,  certificateAlias, certificatePassword)
		decrypted = system.getRsaDecrypted(hash, 'testserver.jks', 'server', 'server', 'server')
	} catch (ex) {
		log("ERROR", "Error decrypting hash - " + ex);
	}
	return decrypted;
}

function stackTrace(ex) {
	var sw
	var pw
	if (ex == null) {
		return ""
	}
	try {
		sw = java.io.StringWriter();
		pw = java.io.PrintWriter(sw);
		ex.printStackTrace(pw);
		pw.close();
	} catch (ex2) {
		var sw = ex
	}
	return sw.toString();
}

function loadFileToByteArray(filepath) {
	var file = new java.io.File(filepath);
	var fis = new java.io.FileInputStream(file);
	var bytes = java.util.Arrays.copyOf("".getBytes(), file.length());
	fis.read(bytes); //read file into bytes[]
	fis.close();
	return bytes;
}

function loadFileToString(filepath) {
	var sb = new java.lang.StringBuilder();
	var file = system.openFileForInput(filepath);
	var line;
	while ((line = file.readLine()) != null) {
		sb.append(line + "\n");
	}
	return sb.toString();
}

function loadFileToArray(filepath, delimiter) {
	delimiter = delimiter || "\n";
	
	var sb = new java.lang.StringBuilder();
	var file = system.openFileForInput(filepath);
	var line;
	while ((line = file.readLine()) != null) {
		sb.append(line + "\n");
	}
	var str = sb.toString();
	return system.splitString(str, delimiter)
}]]></parameter>
        </Script>
        <Script name="Timer">
            <ModTime>1597860482083</ModTime>
            <parameter name="includeFiles"/>
            <parameter name="script"><![CDATA[var Timer = function() {
	this.vrs = "20200804 1048"; // initial version
	this._timers = {};
	this._times = {};
	
	this.log = function(lvl, msg) {
		if (typeof lvl == "undefined") {
			msg = "";
			lvl = "INFO";
		} else
		if (typeof msg == "undefined") {
			msg = lvl;
			lvl = "INFO";
		}
		
		log(lvl, "[Timer] " + msg);
	}
	
	this.initialize = function() {
		this.log(" v" + this.vrs);
	}	
	
	// ------- Timing functions
	
	this.start = function(name) {
		if (this._times[name]) {
			this.log("WARN", "Restarting timer for " + name);
		}
		this._times[name] = java.lang.System.currentTimeMillis();
	}
	
	this.stop = function(name) {
		if (typeof this._times[name] != "number") {
			this.log("WARN", "No start time found for " + name);
		} else {
			var diff = java.lang.System.currentTimeMillis() - this._times[name];
			var newVal = (this._timers[name] || 0) + diff;
			this._timers[name] = newVal;
		}
		
		delete this._times[name];
	}
	
	this.timers = function() {
		var t;
		var stillOpen = [];
		for (t in this._times) {
			stillOpen.push(t);
		}
		if (stillOpen.length > 0) {
			log("WARN", "The following timers are still open: " + stillOpen.join(", "));
		}
		return this._timers;
	}
		
	// ------- Initialization code below
	
	this.initialize();
	
	return this;
}]]></parameter>
        </Script>
        <Script name="WordDoc">
            <ModTime>1602249884939</ModTime>
            <parameter name="includeFiles"/>
            <parameter name="script"><![CDATA[var WordDoc = function (filenameTemplate)
{
	//this.vrs = "20200602 1725"; // First version
	//this.vrs = "20200603 1345"; // Updated to handle templating
	this.vrs = "20200603 2232"; // Corrected filename generation

	this.filenameTemplate = filenameTemplate;
	this.map = new Mapper();
	 
	this.log = function(lvl, msg) {
		if (typeof lvl == "undefined") {
			msg = "";
			lvl = "INFO";
		} else
		if (typeof msg == "undefined") {
			msg = lvl;
			lvl = "INFO";
		}
		 
		log(lvl, "[WordDoc] " + msg);
	}
	
	// 
	
	// Generate a Word Doc based on a file template
	this.generate = function(entry) {
		// Get filename
		filename = this.map.evaluate("Word doc filename", this.filenameTemplate, entry);
		this.log("Generating Word doc: " + filename);
		
		//Blank Document
		var document = new org.apache.poi.xwpf.usermodel.XWPFDocument();
		  
		//Write the Document in file system
		//fos = new java.io.ByteArrayOutputStream();
		fos = new java.io.FileOutputStream(new java.io.File("POC_MVP/" + filename));

		// First create the Abstract
		var paragraph = document.createParagraph();
		var run = paragraph.createRun();
		run.setBold(true);
		run.setFontSize(12);
		
		var contents = entry.getString("contents");
		var lines = system.splitString(contents, "\n");
		
		for (var line in lines) {
			run.setText(line);
			run.addBreak();
		}

		document.write(fos);
		fos.close();
		
		if (fos instanceof java.io.ByteArrayOutputStream) {
			return fos.toByteArray();
		}
	}
	
	this.initialize = function() {
		this.log(" v" + this.vrs);
	}	
	
	// Initialization code below here
	
	this.initialize();
	
	return this;
}]]></parameter>
        </Script>
        <Script name="ccUpdateObj">
            <ModTime>1607982102566</ModTime>
            <parameter name="includeFiles"/>
            <parameter name="script"><![CDATA[// Object used to multi-thread updates to Clause Controls
//
var ccUpdateObj = function() {
	this.vrs = "20201015 1533"; // Initial version
	this.vrs = "20201211 1427"; // Upped maxALs to 30
	
	// Array of ALs
	this.maxALs = system.getTDIProperty("max.concurrent.cc.updates") || 5;
	this.als = java.util.concurrent.ConcurrentHashMap();
	this.opCtrObjs = [];
	this.updateCount = {success: 0, failed: 0};
	
	// Local log function
	this.log = function(lvl, msg, throwit) {
		throwit = throwit || false;
		
		if (typeof lvl == "undefined") {
			msg = "";
			lvl = "INFO";
		} else
		if (typeof msg == "undefined") {
			msg = lvl;
			lvl = "INFO";
		}
		
		log(lvl, "[ccUpdateObj] " + msg);
		
		if (throwit) throw "[ccUpdateObj] " + msg;
	}
	
	// Register a new request to start an update thread
	this.update = function(entry) {
		while (this.runningALs() >= this.maxALs) {
			task.sleep(50);
		}	
		
		var ref = entry.getString("GTS-ClauseCtl:Col1");
		
		var iwe = system.newEntry();
		iwe.entry = entry;
		iwe.opCtrObj = this.nextFreeOpCtrObj();

		var alName = task.getShortName() + " - " + ref;
		
		tcb = system.newTCB()
		tcb.setInitialWorkEntry(iwe);
		tcb.setTaskName(alName);
		
		vect = new java.util.Vector();
		vect.add(tcb);
		vect.add(task.getLog());
		
		this.log("Starting AL for " + ref + " with " + entry.getString("GTS-ClauseCtl:Col1"));
		var al = main.startAL("Migrate_ePolicy_CC_Update", vect);
		al.setParam("alName", alName);
		
		this.als.put(ref, al);

		do {
			var step = al.getCurrentStep();
		} while (step < 5);	
	}
	
	// Return the first available OpenPages Connector obj
	this.nextFreeOpCtrObj = function() {
		do {
			for (var i in this.opCtrObjs) {
				var thisObj = this.opCtrObjs[i];
				if (!thisObj.inUse) {
					thisObj.inUse = true;
					return thisObj;
				}
			}
			task.sleep(50);
		} while (true);
	}
	
	// Check all ALs in flight, removing those that have completed
	this.runningALs = function() {
		var running = 0;
		var refs = this.als.keySet();
		var deleteALs = [];
		for (var ref in refs) {
			var al = this.als.get(ref);
			
			step = al.getCurrentStep();
			
			if (step == 16) { // If completed, the mark as available
				// Remove from the HashMap of ALs
				//this.als.remove(ref);

				// Get result and any errors
				var result = al.getResult();
				var error = al.getStats().getError();
				if (error) {
					_errors.push(error.toString());
					this.updateCount.failed++;
					throw "**** STOPPING EVERYTHING WITH: " + error.toString();
				} else {
					this.updateCount.success++;
				}
				
				deleteALs.push(ref);
			} else {
				running++;
			}
		}
		
		for (var i in deleteALs) {
			var alref = deleteALs[i];
			this.als.remove(alref);
		}
		
		return running;
	}
	
	// Waits for all ALs to complete, collecting details from them
	this.getResults = function() {
		while (this.runningALs() > 0) {
			task.sleep(100);
		}
		return this.updateCount;
	}

	// Initialization method
	this.initialize = function() {
		this.log("v" + this.vrs);
		
		for (var i = 0; i < this.maxALs; i++) {
			var ctr = system.getConnector("OpenPages Connector");
			ctr.initialize(null);
			this.opCtrObjs.push({
				ctr: ctr,
				inUse: false
			});
		}
	} 
			
	// Initialization code below this point
	
	this.initialize();	

	return this; // Always return *this*
}]]></parameter>
        </Script>
        <Script name="ePolicyObj">
            <ModTime>1607688207340</ModTime>
            <parameter name="includeFiles"/>
            <parameter name="script"><![CDATA[var ePolicyObj = function(args) {
	//this.vrs = "20200603 2008"; // Initial version
	//this.vrs = "20200630 1522"; // Beefed up .query() method to accept existing Array of entries
	//this.vrs = "20200805 2241"; // added timings
	this.vrs = "20200820 1646"; // Added args to Constructor for setting ePolicy db parameters

	this.args = args || {};
	this.ctr = null;
	this.map = new Mapper();

	this.timer = typeof timer != "undefined" ? timer : {start: function() {}, stop: function() {}, timers: function() {return {} }};
	
	this.log = function(lvl, msg, throwit) {
		throwit = throwit || false;
		if (typeof lvl == "undefined") {
			msg = "";
			lvl = "INFO";
		} else
		if (typeof msg == "undefined") {
			msg = lvl;
			lvl = "INFO";
		}
		
		log(lvl, "[ePolicyDB] " + msg);
		if (throwit) throw "[ePolicyDB] " + msg;
	}
	
	// Load and initialize ePolicy_db Connector from Resources > Connectors
	this.initialize = function() {
		this.log(" v" + this.vrs);
   
		this.timer.start("initializing ePolicyObj");
		this.ctr = system.getConnector("ePolicy_db");
		if (this.ctr == null) this.log("ERROR", "Could not find Resources/Connectors/ePolicy_db Connector", true);
		if(this.args.hostName){
			this.ctr.setParam("jdbcLogin" , this.args.userName || this.args.username);
			this.ctr.setParam("jdbcPassword" , this.args.password);
			var source = "jdbc:db2://" 
							+ (this.args.hostName || this.args.hostname) 
							+ ":" + this.args.port 
							+ "/" + this.args.database ;
			this.ctr.setParam("jdbcSource" , source);
		}
		this.ctr.initialize(null);
		this.timer.stop("initializing ePolicyObj");
	}
	
	// Add single quotes around value if of type string
	this.quote = function(value) {
		if (typeof value == "string") {
			return "'" + value + "'"
		} else {
			return value;
		}
	}
	
	// Find an Account based on an Column
	this.find = function(tableName, columnName, searchValue, operator) {
		this.timer.start("finding ePolicyObj");
		
		operator = operator || "=";
		
		if (searchValue instanceof com.ibm.di.entry.Attribute) {
			searchValue = searchValue.getValue(0);
		}
		
		var select = "select * from " + tableName
						+ " where " + columnName 
						+ operator + this.quote(searchValue);
		
		this.timer.stop("finding ePolicyObj");
		return this.select(select);
	}
	
	// Perform a select and return the Array of Entries
	this.select = function(select) {
		this.timer.start("selecting ePolicyObj");
		var result = this.ctr.execSQLSelect(select);
		if (result) {
			this.timer.stop("selecting ePolicyObj");
			this.log("ERROR", "Error making selection: " + select + " - " + result, true);
		}
		
		var list = new java.util.ArrayList();
		var entry;
		while ((entry = this.ctr.getNextSQLSelectEntry()) != null) {
			list.add(entry);
		}
		
		this.timer.stop("selecting ePolicyObj");
		return list.toArray();
	}
	
	
	//Read query from file , apply evaluation and perfrom select
	
	this.query = function(queryName , entry, addToResult){
		addToResult = addToResult || new java.util.ArrayList().toArray();
		
		this.timer.start("querying ePolicyObj");

		var select = loadFileToString("POC_MVP/query_" + queryName + ".txt" );
		select = this.map.evaluate("epolicydb.query" , select , entry);
		var resultArray = this.select(select);
		
		if (addToResult.length > 0) {
			var result = new java.util.ArrayList();
			for (var entry in resultArray) {
				result.add(entry);
			}
			for (var entry in addToResult) {
				result.add(entry);
			}
			resultArray = result.toArray();
		}
		
		this.timer.stop("querying ePolicyObj");
		return resultArray;
	}
	// Initialization code below here
	
	this.initialize();
	
	return this;
}]]></parameter>
        </Script>
        <Script name="fileTypes">
            <ModTime>1596542035703</ModTime>
            <parameter name="includeFiles"/>
            <parameter name="script"><![CDATA[{
    "fileTypes": {
        "fileType": [{
            "fileExtension": "html",
            "mimeType": "text/html",
            "id": "1"
        }, {
            "fileExtension": "htm",
            "mimeType": "text/html", 
            "id": "2"
        }, { 
            "fileExtension": "txt",
            "mimeType": "text/plain",
            "id": "9"
        }, {
            "fileExtension": "rtf",
            "mimeType": "text/richtext",
            "id": "13"
        }, {
            "fileExtension": "bmp",
            "mimeType": "image/bmp",
            "id": "35"
        }, {
            "fileExtension": "gif",
            "mimeType": "image/gif",
            "id": "37"
        }, {
            "fileExtension": "jpe",
            "mimeType": "image/jpeg",
            "id": "38"
        }, {
            "fileExtension": "jpg",
            "mimeType": "image/jpeg",
            "id": "39"
        }, {
            "fileExtension": "jpeg",
            "mimeType": "image/jpeg",
            "id": "40"
        }, {
            "fileExtension": "png",
            "mimeType": "image/png",
            "id": "41"
        }, {
            "fileExtension": "tiff",
            "mimeType": "image/tiff",
            "id": "42"
        }, {
            "fileExtension": "tif",
            "mimeType": "image/tiff",
            "id": "43"
        }, {
            "fileExtension": "pdf",
            "mimeType": "application/pdf",
            "id": "44"
        }, {
            "fileExtension": "xls",
            "mimeType": "application/vnd.ms-excel",
            "id": "46"
        }, {
            "fileExtension": "xlw",
            "mimeType": "application/vnd.ms-excel",
            "id": "47"
        }, {
            "fileExtension": "xla",
            "mimeType": "application/vnd.ms-excel",
            "id": "48"
        }, {
            "fileExtension": "xlt",
            "mimeType": "application/vnd.ms-excel",
            "id": "49"
        }, {
            "fileExtension": "xlam",
            "mimeType": "application/vnd.ms-excel.addin.macroEnabled.12",
            "id": "50"
        }, {
            "fileExtension": "xlsb",
            "mimeType": "application/vnd.ms-excel.sheet.binary.macroEnabled.12",
            "id": "51"
        }, {
            "fileExtension": "xlsm",
            "mimeType": "application/vnd.ms-excel.sheet.macroEnabled.12",
            "id": "52"
        }, {
            "fileExtension": "xlsx",
            "mimeType": "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
            "id": "53"
        }, {
            "fileExtension": "xltm",
            "mimeType": "application/vnd.ms-excel.template.macroEnabled.12",
            "id": "54"
        }, {
            "fileExtension": "xltx",
            "mimeType": "application/vnd.openxmlformats-officedocument.spreadsheetml.template",
            "id": "55"
        }, {
            "fileExtension": "ppt",
            "mimeType": "application/vnd.ms-powerpoint",
            "id": "56"
        }, {
            "fileExtension": "pot",
            "mimeType": "application/vnd.ms-powerpoint",
            "id": "57"
        }, {
            "fileExtension": "ppa",
            "mimeType": "application/vnd.ms-powerpoint",
            "id": "58"
        }, {
            "fileExtension": "pps",
            "mimeType": "application/vnd.ms-powerpoint",
            "id": "59"
        }, {
            "fileExtension": "potm",
            "mimeType": "application/vnd.ms-powerpoint.template.macroEnabled.12",
            "id": "60"
        }, {
            "fileExtension": "potx",
            "mimeType": "application/vnd.openxmlformats-officedocument.presentationml.template",
            "id": "61"
        }, {
            "fileExtension": "ppam",
            "mimeType": "application/vnd.ms-powerpoint.addin.macroEnabled.12",
            "id": "62"
        }, {
            "fileExtension": "ppsm",
            "mimeType": "application/vnd.ms-powerpoint.slideshow.macroEnabled.12",
            "id": "63"
        }, {
            "fileExtension": "ppsx",
            "mimeType": "application/vnd.openxmlformats-officedocument.presentationml.slideshow",
            "id": "64"
        }, {
            "fileExtension": "pptm",
            "mimeType": "application/vnd.ms-powerpoint.presentation.macroEnabled.12",
            "id": "65"
        }, {
            "fileExtension": "pptx",
            "mimeType": "application/vnd.openxmlformats-officedocument.presentationml.presentation",
            "id": "66"
        }, {
            "fileExtension": "sldm",
            "mimeType": "application/vnd.ms-powerpoint.slide.macroEnabled.12",
            "id": "67"
        }, {
            "fileExtension": "sldx",
            "mimeType": "application/vnd.openxmlformatsofficedocument.presentationml.slide",
            "id": "68"
        }, {
            "fileExtension": "mpp",
            "mimeType": "application/vnd.ms-project",
            "id": "69"
        }, {
            "fileExtension": "doc",
            "mimeType": "application/msword",
            "id": "70"
        }, {
            "fileExtension": "dot",
            "mimeType": "application/msword",
            "id": "71"
        }, {
            "fileExtension": "docm",
            "mimeType": "application/vnd.ms-word.document.macroEnabled.12",
            "id": "72"
        }, {
            "fileExtension": "docx",
            "mimeType": "application/vnd.openxmlformats-officedocument.wordprocessingml.document",
            "id": "73"
        }, {
            "fileExtension": "dotm",
            "mimeType": "application/vnd.ms-word.template.macroEnabled.12",
            "id": "74"
        }, {
            "fileExtension": "dotx",
            "mimeType": "application/vnd.openxmlformats-officedocument.wordprocessingml.template",
            "id": "75"
        }, {
            "fileExtension": "eml",
            "mimeType": "message/rfc822",
            "id": "76"
        }, {
            "fileExtension": "msg",
            "mimeType": "message/rfc822",
            "id": "77"
        }, {
            "fileExtension": "zip",
            "mimeType": "application/octet-stream",
            "id": "102"
        }, {
            "fileExtension": "gz",
            "mimeType": "application/octet-stream",
            "id": "103"
        }, {
            "fileExtension": "gzip",
            "mimeType": "application/octet-stream",
            "id": "104"
        }, {
            "fileExtension": "mdb",
            "mimeType": "application/x-msaccess",
            "id": "105"
        }, {
            "fileExtension": "mp3",
            "mimeType": "audio/mpeg",
            "id": "135"
        }, {
            "fileExtension": "wmv",
            "mimeType": "video/x-ms-wmv",
            "id": "142"
        }, {
            "fileExtension": "xps",
            "mimeType": "application/vnd.ms-xpsdocument",
            "id": "145"
        }, {
            "fileExtension": "vsd",
            "mimeType": "application/ms-visio",
            "id": "151"
        }]
    }
}]]></parameter>
        </Script>
    </Folder>
    <JavaLibraries/>
    <JavaProperties/>
    <Folder name="Includes"/>
    <Folder name="Config">
        <LogConfig name="Logging"/>
        <InstanceProperties name="AutoStart">
            <AutoStart/>
        </InstanceProperties>
        <TombstonesConfig name="Tombstones">
            <ModTime>1588765300562</ModTime>
            <parameter name="AssemblyLines">false</parameter>
            <parameter name="Configuration">false</parameter>
        </TombstonesConfig>
        <SolutionInterface name="SolutionInterface">
            <ModTime>1588765357552</ModTime>
            <InstanceID>POC_MVP</InstanceID>
            <enabled>true</enabled>
        </SolutionInterface>
        <Container name="SystemStore">
            <ParameterList name="Default"/>
        </Container>
    </Folder>
    <Folder name="Functions"/>
    <Folder name="AttributeMaps"/>
    <Properties name="Properties">
        <Stores>
            <PropertyStore name="Solution-Properties">
                <Parser/>
                <RawConnector>
                    <InheritFrom>system:/Connectors/ibmdi.Properties</InheritFrom>
                    <parameter name="collectionType">Solution-Properties</parameter>
                </RawConnector>
                <Key>key</Key>
                <Value>value</Value>
                <ReadOnly>false</ReadOnly>
                <InitialLoad>true</InitialLoad>
                <CacheTimeout>0</CacheTimeout>
            </PropertyStore>
            <PropertyStore name="Global-Properties">
                <Parser/>
                <RawConnector>
                    <InheritFrom>system:/Connectors/ibmdi.Properties</InheritFrom>
                    <parameter name="collectionType">Global-Properties</parameter>
                </RawConnector>
                <Key>key</Key>
                <Value>value</Value>
                <ReadOnly>false</ReadOnly>
                <InitialLoad>true</InitialLoad>
                <CacheTimeout>0</CacheTimeout>
            </PropertyStore>
            <PropertyStore name="System-Properties">
                <Parser/>
                <RawConnector>
                    <InheritFrom>system:/Connectors/ibmdi.Properties</InheritFrom>
                    <parameter name="collectionType">System-Properties</parameter>
                </RawConnector>
                <Key>key</Key>
                <Value>value</Value>
                <ReadOnly>false</ReadOnly>
                <InitialLoad>true</InitialLoad>
                <CacheTimeout>0</CacheTimeout>
            </PropertyStore>
            <PropertyStore name="Java-Properties">
                <Parser/>
                <RawConnector>
                    <InheritFrom>system:/Connectors/ibmdi.Properties</InheritFrom>
                    <parameter name="collection">@SUBSTITUTE{config.$directory}/POC_MVP.properties</parameter>
                    <parameter name="collectionType">Java-Properties</parameter>
                </RawConnector>
                <Key>key</Key>
                <Value>value</Value>
                <ReadOnly>false</ReadOnly>
                <InitialLoad>true</InitialLoad>
                <CacheTimeout>0</CacheTimeout>
            </PropertyStore>
            <PropertyStore name="OpenPagesAssets">
                <ModTime>1618399293676</ModTime>
                <Parser/>
                <RawConnector>
                    <InheritFrom>system:/Connectors/ibmdi.Properties</InheritFrom>
                    <parameter name="autorewrite">true</parameter>
                    <parameter name="collection">OpenPagesAssets/OpenPagesAssets.properties</parameter>
                    <parameter name="collectionType">Default</parameter>
                    <parameter name="keyAlias"/>
                </RawConnector>
                <Key>key</Key>
                <Value>value</Value>
                <ReadOnly>false</ReadOnly>
                <InitialLoad>true</InitialLoad>
                <CacheTimeout>0</CacheTimeout>
            </PropertyStore>
        </Stores>
    </Properties>
    <Folder name="Schedules">
        <Scheduler name="Export Risks">
            <ModTime>1592419103031</ModTime>
            <parameter name="StartTimes">* * * 0 1 0</parameter>
            <parameter name="assemblyLine">Risk_2_csv</parameter>
            <parameter name="enabled">true</parameter>
        </Scheduler>
        <Scheduler name="Migrate ePolicy Service">
            <ModTime>1606842501773</ModTime>
            <parameter name="SchedulerType">1</parameter>
            <parameter name="StartTimes">* * * * 0 0</parameter>
            <parameter name="WithinSeconds">60</parameter>
            <parameter name="assemblyLine">Migrate_ePolicy_Service</parameter>
            <parameter name="enabled">true</parameter>
        </Scheduler>
    </Folder>
    <Folder name="Sequences"/>
</MetamergeConfig>